'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[52],{1519:function(r,C,a){a.r(C);var c={};a.r(c);a.d(c,"SensitivityCommandHandler",function(){return De});var b=a(0),e=a(15),f=a(88),d=a(896),h=a(198),l=a(564);class k{constructor(Zb,Vc,Nc=null){this.id=Zb.Id;Nc||(Nc="");this.hsj=Nc;this.sensitivityLabel=Zb}}Object(b.a)(k,"AutoPolicyLabelData",null,[]);class u{constructor(Zb,Vc){this.EN=Zb;this.displayName=Vc}}Object(b.a)(u,"PolicyLabelRequestState",null,[]);class v{constructor(){this.wWd=
this.tHd=""}}Object(b.a)(v,"PolicyStrings",null,[]);var x=a(156),w=a(6),m=a(166),t=a(14),z=a(49),y=a(32);class D{static get aBd(){return D.uLi}}D.uLi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(b.a)(D,"JustificationDialogHtml",null,[]);class H extends x.a{constructor(Zb,Vc){super(!1,!1,H.ow);this.rta=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.I0b=null;this.G0b=!1;this.s1b=Zb;this.wF=Vc;this.Qg=this.R7g();this.Ac=1;this.ef=H.id;this.Qc(1,CommonUIStrings.l_DialogChange);this.JM(1,!1);this.R2(0)}C0d(){if(H.ow)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(f.a)(this,this.q0f,"reactJustificationDialogHandler"),this.Cdf(this.G0b));else{const Zb={};for(let Vc=0;Vc<this.rta.length;Vc++)Zb[H.rPd+Vc]=!1;Zb[H.KTb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(f.a)(this,this.tLi,"justificationDialogHandler"),Zb);this.buj();z.a.addHandler($get(H.KTb),t.a.input,Object(f.a)(this,this.V5j,"textAreaHandler"))}}validate(){if(H.ow)return this.jwg(this.I0b);const Zb=$get(H.KTb);return Zb.disabled?!0:this.jwg(Zb.value)}jwg(Zb){const Vc=
2>Zb.length,Nc=500<Zb.length,ld=RegExp("[{|}|;|\\\\]").test(Zb);Zb=""===y.a.xzc(Zb);return!Vc&&!Nc&&!ld&&!Zb}tLi(Zb,Vc){let Nc="";if(1===Zb)for(let ld=0;ld<this.rta.length;ld++)if(Vc[H.rPd+ld]){Nc=ld===this.rta.length-1?Vc[H.KTb]:this.rta[ld];break}this.wF(Zb,this.s1b,Nc)}q0f(Zb){let Vc="";1===Zb&&this.I0b&&(Vc=this.I0b);this.wF(Zb,this.s1b,Vc)}O8i(Zb){this.I0b=Zb;Zb=this.validate();this.G0b!==Zb&&(this.G0b=Zb,this.CXa(CommonUIStrings.l_SensitivityJustificationTitle,Object(f.a)(this,this.q0f,"reactJustificationDialogHandler"),
this.Cdf(this.G0b)))}Cdf(Zb){return{["id"]:this.ef,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Zb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(f.a)(this,this.O8i,"onJustificationUpdated")}}V5j(Zb){Zb.target&&this.JM(1,this.validate())}R7g(){return x.a.lq(H.aBd,w.AFrameworkApplication.sC,m.getImageClass(H.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.rta[0],this.rta[1],this.rta[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}buj(){const Zb=document.getElementsByName(H.ZNi);for(let Vc=0;Vc<Zb.length;Vc++)z.a.addHandler(Zb[Vc],
t.a.focus,Object(f.a)(this,this.UZf,"radioButtonFocusHandler")),z.a.addHandler(Zb[Vc],t.a.click,Object(f.a)(this,this.UZf,"radioButtonFocusHandler"))}UZf(Zb){if(Zb=Zb.target){Zb.checked=!0;var Vc=$get(H.KTb);Zb.id===H.rPd+(this.rta.length-1)?(Vc.disabled=!1,Sys.UI.DomElement.setVisible(Vc,!0),Vc.focus()):(Vc.disabled=!0,Zb.focus());this.JM(1,this.validate())}}static get ow(){return w.AFrameworkApplication.sa.Qa.$w&&w.AFrameworkApplication.sa.Qa.Lyd}}H.aBd=D.aBd;H.ZNi="ListRadioBox";H.rPd="radiobox";
H.KTb="txtJustification";H.iconName="Info_32x32x32";H.id="JustificationDialog";Object(b.a)(H,"JustificationDialog",x.a,[]);class F extends x.a{constructor(Zb,Vc,Nc){super(!1,!1,!0);if(Zb&&Nc){var ld={["id"]:"MandatoryLabellingDialog"};this.gGg=Nc;this.MUc=Vc;if(!w.AFrameworkApplication.fa.ra("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.MUc&&""!==this.MUc)ld.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.MUc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Vc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Vc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Zb});ld.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Vc};Zb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:ld};ld.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
ld.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(f.a)(this,this.mUi,"mandatoryLabellingDialogHandler"),Zb)}else e.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}mUi(Zb,Vc){1===Zb&&Vc.selectedLabel&&(Zb=Vc.selectedLabel,""!==Zb&&this.gGg(Zb))}}Object(b.a)(F,"MandatoryLabellingDialog",x.a,[]);class G{constructor(){this.Xnb=!!w.AFrameworkApplication.sa&&
w.AFrameworkApplication.sa.Qa.$w}wph(Zb,Vc,Nc){this.Xnb&&new F(Zb,Vc,Nc)}static get instance(){return G.Oa||(G.Oa=new G)}}G.Oa=null;Object(b.a)(G,"MandatoryLabellingDialogFactory",null,[649]);class L{}L.O2j="sbProtectForm14";L.Q2j="SBStatusBarMarkAsReadOnly14";L.iNi="Info_16x16x32";L.fvb="QuickSearchCompletedToday_16x16x32";L.UPd="CommonControlCheckboxCheck_16";L.gpg="On";L.visible="Visible";L.fVh="ImageIsVisible";L.lF="SourceControlId";L.menuItemId="MenuItemId";L.menu="Menu";L.a4c="AppLockId";L.value=
"Value";L.Qi="LabelText";L.alt="Alt";L.Ulf="Image16by16";L.fna="Image16by16Class";L.N2j="SBProtectForm_16";L.P2j="SBStatusBarMarkAsReadOnly_16";L.icon="Icon";L.iconColor="IconColor";L.customTooltip="CustomTooltip";L.vrj="MipTagDynamicFillWithOutline_20";L.wrj="MipTagLockDynamicFillWithOutline_20";L.urj="MipTagErrorOutline_20";L.xrj="MipTagQuestionOutline_20";L.zIc="transparent";L.lbk="UILocation";Object(b.a)(L,"PolicyConstants",null,[]);class M extends x.a{constructor(Zb,Vc,Nc){super(!1,!1,M.ow);
this.s1b=Zb;this.l_a=Vc;this.wF=Nc;this.Ac=1;this.ef=M.id;this.R2(1);this.R2(0)}$0d(){const Zb={["id"]:"UserDefinedPermissionsDialog"};M.ow&&this.initializeAndShow("Defined Permissions",Object(f.a)(this,this.gik,"userDefinedPermissionsDialogHandler"),Zb)}gik(Zb){1!==Zb&&this.wF(Zb,this.s1b,"",this.l_a)}static get ow(){return w.AFrameworkApplication.sa.Qa.$w&&w.AFrameworkApplication.sa.Qa.Lyd}}M.id="UserDefinedPermissionsDialog";Object(b.a)(M,"UserDefinedPermissionsDialog",x.a,[]);var O=a(596),B=a(385),
E=a(324),I=a(578),S=a(103),J=a(128),K=a(573),R=a(570),Z=a(140),P=a(436),V=a(147),Ea=a(93),oa=a(161),ea=a(340),aa=a(84),ia=a(111),ya=a(27),za=a(70),la=a(63);class xa{constructor(Zb,Vc,Nc,ld){this.job=this.pHa=null;this.Qie=this.HTc=this.ZTc=this.$nb=this.Xje=this.Ale=this.wPc=!1;this.XYa=this.Qha=this.Iia=this.ssa=this.l_a=this.np=this.w4=this.yf=null;this.zFg=this.qNc=0;this.Jfe=this.VTc=this.CNc=this.kXc=null;this.Na=Zb;this.Wf=Vc;this.Ra=Nc;this.eh=ld;this.Pob={};this.xoe={};this.Ble={};this.omc=
Nc.ra("WacApplyManualPolicyLabelIsEnabled");this.eh.value.ize(Object(f.a)(this,this.IOd,"processAutoSensitivityLabel"));this.eh.value.g3c(Object(f.a)(this,this.IOd,"processAutoSensitivityLabel"));this.eh.value.F4b(Object(f.a)(this,this.Tdj,"onUpdateLabelInfo"));w.AFrameworkApplication.sa&&w.AFrameworkApplication.sa.hYg(Object(f.a)(this,this.ltj,"refreshDocumentPolicyLabelsOnModeChange"));Nc.ra("SupportsPolicies")&&Nc.Va("AppliedPolicyId")&&(this.pHa=Nc.Va("IrmPolicyTitle"),this.job=Nc.Va("IrmPolicyDescription"));
this.QDg=this.Ra.Ae("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.RDg=this.Ra.Ae("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get T$a(){return w.AFrameworkApplication.T$a||!!this.VTc&&this.VTc()}Ih(){this.Na.Hc(ya.a.tLd,ia.a.frame,Object(f.a)(this,this.Ccc,"documentLabelPaneHandler"));this.Na.pf(ya.a.bfb,ia.a.frame,Object(f.a)(this,this.bfb,"queryPolicyLabel"),96);this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.Hc(ya.a.UTf,
ia.a.frame,Object(f.a)(this,this.Ccc,"documentLabelPaneHandler")),this.Na.pf(ya.a.mNb,ia.a.frame,Object(f.a)(this,this.mNb,"queryPolicyShortLabel"),96));this.Na.Hc(ya.a.kXa,ia.a.frame,Object(f.a)(this,this.kXa,"toggleSensitivity"));this.Na.Hc(ya.a.jCa,ia.a.frame,Object(f.a)(this,this.jCa,"populateSensitivityFlyout"));this.Na.Hc(ya.a.setSensitivity,ia.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Na.pf(ya.a.cfb,ia.a.frame,Object(f.a)(this,this.cfb,"querySensitivity"),96);this.Na.Hc(ya.a.A9,
ia.a.frame,Object(f.a)(this,this.A9,"querySensitivityToggleButton"));this.Na.Hc(ya.a.z9,ia.a.frame,Object(f.a)(this,this.z9,"querySensitivitySubFlyout"));this.nrb(ya.a.kXa)||this.Na.nhb(ya.a.kXa,4);this.nrb(ya.a.jCa)||this.Na.nhb(ya.a.jCa,4);this.nrb(ya.a.setSensitivity)||this.Na.nhb(ya.a.setSensitivity,4);this.nrb(ya.a.A9)||this.Na.nhb(ya.a.A9,4);this.nrb(ya.a.z9)||this.Na.nhb(ya.a.z9,4);this.Wf.updateCommandUI();w.AFrameworkApplication.fa&&Z.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&
this.eh.value.Xyj(Object(f.a)(this,this.r2f,"registerActionsHandler"))}r2f(){this.Ih()}zUb(){this.Na.fB(ya.a.tLd,ia.a.frame,Object(f.a)(this,this.Ccc,"documentLabelPaneHandler"));this.Na.fB(ya.a.bfb,ia.a.frame,Object(f.a)(this,this.bfb,"queryPolicyLabel"));this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.fB(ya.a.UTf,ia.a.frame,Object(f.a)(this,this.Ccc,"documentLabelPaneHandler")),this.Na.fB(ya.a.mNb,ia.a.frame,Object(f.a)(this,this.mNb,"queryPolicyShortLabel")));
this.Na.fB(ya.a.kXa,ia.a.frame,Object(f.a)(this,this.kXa,"toggleSensitivity"));this.Na.fB(ya.a.jCa,ia.a.frame,Object(f.a)(this,this.jCa,"populateSensitivityFlyout"));this.Na.fB(ya.a.setSensitivity,ia.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Na.fB(ya.a.cfb,ia.a.frame,Object(f.a)(this,this.cfb,"querySensitivity"));this.Na.fB(ya.a.A9,ia.a.frame,Object(f.a)(this,this.A9,"querySensitivityToggleButton"));this.Na.fB(ya.a.z9,ia.a.frame,Object(f.a)(this,this.z9,"querySensitivitySubFlyout"))}kXa(){return 32}e8e(Zb){const Vc=
"mandatoryLabelling_"+Zb.Id;this.Ble[Vc]=Zb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Vc,["label"]:Zb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Zb.Tooltip}}LQa(){return this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}Mxd(){return this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}R9h(){const Zb=[],Vc=this.w4;for(let ld in Vc){var Nc=Vc[ld];const yd=this.np[ld];if(yd&&yd.Enabled&&!yd.HasUserDefinedPermissions)if(Nc.count){const sd=
{["sections"]:[],["shouldAutoOpen"]:!1},ic={["id"]:"mandatoryLabelling_flyoutMenuSection_"+yd.Id,["controls"]:[]};for(let Ic of Nc)(Nc=this.np[Ic])&&Nc.Enabled&&!Nc.HasUserDefinedPermissions&&Array.add(ic.controls,this.e8e(Nc));Array.add(sd.sections,ic);Array.add(Zb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+yd.Id,["label"]:yd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:sd})}else Array.add(Zb,this.e8e(yd))}return Zb}jCa(Zb,Vc,Nc,ld,yd){if(1===
Nc||!this.eh.value.Kja(!0))return 32;yd.MenuItems=Object.assign(new K.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(yd.MenuItems.MenuSectionList,this.zd(!this.isReactRibbonEnabled()));this.yf.CustomUrl&&Array.add(yd.MenuItems.MenuSectionList,this.lph(this.isReactRibbonEnabled()?this.yf.CustomUrl:y.a.dg(this.yf.CustomUrl)));this.isReactRibbonEnabled()||(yd.PopulationXML=E.q(yd.MenuItems));return 32}cfb(Zb,Vc,Nc,ld,yd){if(1===Nc||!yd||!this.omc)return 32;this.yf=this.eh.value.Pn;
if(this.eh.value.Kja(!0)&&(yd[L.visible]=!0,this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.Xje||(J.a("MipLabelsAvailable"),this.Xje=!0):J.a("MipLabelsAvailable"),this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.yf&&this.yf.AreLabelsAvailable&&(Zb=aa.a.instance.Dc("Common.ISystemInitiatedFeedback")))){const sd=xa.Gh(this.yf.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";
Zb.execute(ic=>{ic.logActivity(sd,null)})}return 32}A9(Zb,Vc,Nc,ld,yd){if(1===Nc||!yd)return 32;let sd,ic;yd[L.gpg]=!!(sd=yd[L.menuItemId])&&!!(ic=this.Pob[sd])&&ic===this.yf.AppliedPolicyId;return 32}z9(Zb,Vc,Nc,ld,yd){if(1===Nc||!yd)return 32;let sd,ic,Ic;Zb=!!(sd=yd[L.lF])&&!!(ic=this.Pob[sd])&&!!(Ic=this.w4[ic])&&Ic.contains(this.yf.AppliedPolicyId);yd[L.fVh]=Zb;yd[L.gpg]=Zb;return 32}setSensitivity(Zb,Vc,Nc,ld,yd){if(1===Nc||!yd)return 32;Zb=this.Pob[yd[L.lF]];Vc=this.mbk(yd[L.lbk]);Nc=new za.a;
Nc.name="SensitivityPickerLocation";Nc.int64=Vc;J.a("SensitivityPickerUsage",void 0,void 0,[Nc]);return this.yqa(Zb,yd,2)}Vmc(){return!!w.AFrameworkApplication.sa&&1===w.AFrameworkApplication.sa.mode}ltj(){this.HTc&&!this.Vmc()&&(this.HTc=!1,this.eh.value.ktj())}eqg(){this.yf.DefaultLabelId&&this.yf.MandatoryLabelingEnforced?this.wPc||this.Vmc()?this.yf.AppliedPolicyId?this.qgd(""):(this.eh.value.dHi(this.eh.value.GHb)||this.Vmc())&&this.JXe():this.jdg():this.yf.DefaultLabelId?this.jdg():this.yf.MandatoryLabelingEnforced&&
(this.yf.AppliedPolicyId?this.qgd(""):this.JXe())}zsf(){return this.yf.MandatoryLabelingEnforced?this.yf&&this.yf.AreLabelsAvailable?this.Ra.ra("TestOverrideIsReactDialogEnabled")||this.Wf&&this.Wf.Qa&&this.Wf.Qa.$w?!0:(e.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(e.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(e.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),
!1)}JXe(){!this.zsf()||w.AFrameworkApplication.R7||this.Ale||(this.Ale=w.AFrameworkApplication.R7=!0,e.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.eh.value.o_f("",1),this.eh.value.T1c(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.kUi()}))}qgd(Zb){this.zsf()&&w.AFrameworkApplication.R7&&(w.AFrameworkApplication.R7=
!1,e.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.eh.value.URd(),this.eh.value.o_f(Zb,2))}kUi(){G.instance.wph(this.R9h(),this.yf.CustomUrl,Object(f.a)(this,this.lUi,"mandatoryLabellingDialogCallback"))}lUi(Zb){this.qgd(this.Ble[Zb])}mEe(){return this.Ra.ra("CoAuthForProtectedFilesEnabled")&&this.Ra.ra("SupportsOfficeClientCoauthoring")&&this.Ra.ra("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.Jfe&&this.T$a}yqa(Zb,Vc,Nc,ld=null){this.eh.value.aqj(Nc);
let yd=32,sd=!1,ic=!0;const Ic=2===Nc||8===Nc||16===Nc,kd=Zb===this.yf.AppliedPolicyId;if(this.CNc&&this.CNc(Zb,Ic))e.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",Nc),this.Wf.updateCommandUI();else if(Vc&&L.a4c in Vc&&this.eh.value.WOj(Vc[L.a4c]),Zb)if(this.eh.value.Juf()||this.mEe()&&this.ZTc)e.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
Nc),this.Wf.updateCommandUI(),Ic&&this.v5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.Ra.ra("HasDocumentEditRights"))if(this.eh.value.lbh(Zb))if(!this.LQa()&&this.np[Zb]&&this.np[Zb].HasUserDefinedPermissions&&!kd)e.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",Nc),1!==Nc&&4!==Nc&&this.X_g();else if(Ic&&this.yf.MandatoryLabelingEnforced&&kd)e.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",Nc),this.v5b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Ic&&this.Ra.ra("WacLabelingJustificationDialogIsEnabled")&&this.yf.RequiredDowngradeJustification&&(kd||this.np[Zb].RequiredDowngradeJustification)&&(this.LQa()?!this.Qie&&!ld:!this.l_a))return e.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
Nc),this.C0d(Zb),yd;if(this.LQa()&&this.np[Zb].HasUserDefinedPermissions&&!kd)return e.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",Nc),this.$0d(Zb,ld),yd;if(this.mEe()&&!this.Jfe())this.qNc<this.QDg?(e.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.qNc,Nc),this.ZTc=!0,this.qNc++,la.Task.delay(this.RDg).continueWith(()=>{this.ZTc=!1;this.yqa(Zb,Vc,Nc)})):(e.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",Nc),sd=1!==Nc,ic=!1,yd=8);else{if(this.HFi(Zb)&&(e.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",Nc),1===Nc||8===Nc||4===Nc))return yd;e.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",Nc);this.setPolicyLabel(kd?"":Zb,this.LQa()?ld:this.l_a,"",Nc);return yd}}else e.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",Nc),this.Wf.updateCommandUI(),Ic&&this.v5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else e.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",Nc),this.Wf.updateCommandUI(),Ic&&this.v5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else e.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",Nc),this.Wf.updateCommandUI(),sd=Ic,ic=!1,yd=8;this.eh.value.HPd(0,Nc,sd,ic);return yd}k2a(Zb,Vc,Nc=null,ld=!1){S.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.Ra.ra("SupportsOfficeClientCoauthoring")&&this.Ra.ra("CoAuthForProtectedFilesIsEnabled")?(this.$nb=!1,(this.yf=this.eh.value.Pn)&&!this.yf.AppliedPolicyId?this.$nb=!0:this.yf&&
this.yf.PolicyLabelAssignmentMethod&&(this.$nb=oa.e(this.yf.PolicyLabelAssignmentMethod)===oa.e("standard"))):this.$nb=ld;Zb=xa.Gh(Zb)?null:this.np[Zb];(Vc=xa.Gh(Vc)?null:this.np[Vc])?this.Iia=new k(Vc,!0,Nc):(this.eh.value.gga(29),this.Qha=null);Zb?this.ssa=new k(Zb,!1):this.XYa=null;this.IOd(null,null);return 32}c2g(Zb){""!==this.yf.AppliedPolicyId?this.eh.value.HPd(14,16,!0):this.yqa(Zb,null,16)}Ydg(){this.np={};if(this.yf=this.eh.value.Pn)for(const Zb of this.yf.SensitivityLabels)this.np[Zb.Id]=
Zb}HFi(Zb){if(this.w4&&Zb in this.w4){Zb=this.w4[Zb];for(let Vc of Zb)if((Zb=this.np[Vc])&&Zb.Enabled)return!0}return!1}Eeg(){this.w4={};if(this.yf=this.eh.value.Pn){for(const Zb of this.yf.SensitivityLabels)Zb.ParentId||(this.w4[Zb.Id]=new h.a);for(const Zb of this.yf.SensitivityLabels){if(this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RemoveDisabledLabelsFromChildLabel",!1)){if(!(Zb.ParentId&&Zb.ParentId in this.w4&&Zb.Enabled))continue}else if(!(Zb.ParentId&&Zb.ParentId in this.w4))continue;
this.w4[Zb.ParentId].add(Zb.Id)}}}GZf(){this.yf=this.eh.value.Pn;const Zb=this.omc&&this.isReactRibbonEnabled()&&this.eh.value.Kja();xa.LAc(Zb)}Htj(Zb){this.CNc=Zb}Auj(Zb){this.VTc=Zb}jdg(){if(this.Ra.ra("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Vmc())this.HTc=!0;else if(!this.wPc)if(this.wPc=!0,this.yf=this.eh.value.Pn,this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.yf&&this.yf.DefaultLabelId)if(!this.yf.AppliedPolicyId)e.ULS.sendTraceTag(509732190,
306,50,"Default labeling triggered. DefaultLabelType: {0}",this.yf.DefaultLabelType),this.yqa(this.yf.DefaultLabelId,null,1);else if(l.a.hh().equals(this.yf.DefaultLabelType,"documentLibraryDefault")){const Zb=this.np[this.yf.AppliedPolicyId],Vc=this.np[this.yf.DefaultLabelId];this.yf.AppliedPolicyId!==this.yf.DefaultLabelId&&l.a.hh().equals(this.yf.PolicyLabelAssignmentMethod,"standard")&&Zb.Order<Vc.Order&&(e.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",
this.yf.DefaultLabelType),this.yqa(this.yf.DefaultLabelId,null,1))}}else this.yf&&this.yf.DefaultLabelId&&!this.yf.AppliedPolicyId&&(e.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.yf.DefaultLabelId),this.yqa(this.yf.DefaultLabelId,null,1))}IOd(){if(!this.eh.value.Juf()){var Zb=this.np[this.yf.AppliedPolicyId];this.$nb&&this.ssa&&this.XYa!==this.ssa.id&&(!Zb||Zb.Order<this.ssa.sensitivityLabel.Order)&&(Zb=this.yqa(this.ssa.id,{},4),32!==Zb?e.ULS.sendTraceTag(50868813,
306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Zb):(this.XYa=this.ssa.id,this.Qha&&(Zb=this.np[this.Qha])&&Zb.Order<=this.ssa.sensitivityLabel.Order&&(this.eh.value.gga(29),this.Qha=null)));Zb=this.np[this.eh.value.Pn.AppliedPolicyId];if(this.Iia&&this.Qha!==this.Iia.id&&(!Zb||Zb.Order<this.Iia.sensitivityLabel.Order)){const Vc=this.Iia.id;this.eh.value.gga(29);this.eh.value.X3b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,
this.qic(this.Iia.sensitivityLabel))+" "+this.Iia.hsj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.yqa(Vc,{},8)});this.Qha=this.Iia.id}this.Iia=this.ssa=null}}setPolicyLabel(Zb,Vc,Nc,ld=2){this.LQa()?Vc&&(this.Qie=!0):this.l_a=Vc;this.eh.value.setPolicyLabel(Zb);this.Wf.updateCommandUI();Nc=new u(ld,this.qic(this.np[Zb]));this.eh.value.IYd(Zb,this.LQa()?Vc:this.l_a,Nc)}kkh(Zb,Vc,Nc,ld){1===Zb&&this.setPolicyLabel(Vc,ld,Nc)}jkh(Zb,Vc,Nc){1===Zb?this.LQa()?this.yqa(Vc,null,2,Nc):this.setPolicyLabel(Vc===
this.yf.AppliedPolicyId?"":Vc,Nc,""):this.Wf.updateCommandUI()}C0d(Zb){(new H(Zb,Object(f.a)(this,this.jkh,"continueToSetPolicyLabelFromJustificationDialog"))).C0d()}$0d(Zb,Vc){(new M(Zb,Vc,Object(f.a)(this,this.kkh,"continueToSetPolicyLabelFromUDPDialog"))).$0d()}v5b(Zb="",Vc=""){const Nc=new V.StandardDialog;Nc.Ru=w.AFrameworkApplication.vEb;Nc.Ac=0;Nc.Qc(1,CommonUIStrings.l_DialogClose);Nc.QT(Zb,Vc,null)}a6g(Zb){1===Zb&&this.eh.value.fqj()}X_g(){const Zb=new V.StandardDialog;Zb.Ru=w.AFrameworkApplication.vEb;
Zb.Ac=1;Zb.Qc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Zb.Qc(0,CommonUIStrings.l_DialogClose);Zb.QT(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(f.a)(this,this.a6g,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.Wf&&!!this.Wf.Qa&&this.Wf.Qa.Tk}Gp(){return this.Wf&&this.Wf.Qa?this.Wf.Qa.Gp:!1}Ccc(){return 32}SPj(Zb,Vc,Nc,ld){Zb?(ld[L.value]=Zb,ld[L.Qi]=Zb,ld[L.customTooltip]=Vc,this.feg(Nc,w.AFrameworkApplication.protectedFile,
ld)):(ld[L.iconColor]=L.zIc,this.yf.MandatoryLabelingEnforced?(ld[L.value]=ld[L.Qi]=this.uic().wWd,ld[L.icon]=L.urj):(ld[L.value]=ld[L.Qi]=this.uic().tHd,ld[L.icon]=L.xrj));ld[L.visible]=!0}KOj(Zb){let Vc="",Nc="",ld="";if(this.yf.AreLabelsAvailable){let yd=null;this.np&&(yd=this.np[this.yf.AppliedPolicyId]);yd&&(Vc=this.qic(yd),Nc=yd.Tooltip,w.AFrameworkApplication.protectedFile=this.eh.value.dab(yd),ld=this.Qld(yd));if(!this.eh.value.Kja()&&!yd)return}else{if(!this.pHa)return;Vc=this.pHa;ld=L.zIc;
Nc=this.job?this.job:""}this.SPj(Vc,Nc,ld,Zb)}bfb(Zb,Vc,Nc,ld,yd){if(1===Nc)return 32;this.yf=this.eh.value.Pn;if(!this.yf||!yd)return 32;yd[L.value]="";yd[L.Qi]="";yd[L.alt]=null;yd[L.Ulf]=null;yd[L.fna]=null;yd[L.customTooltip]="";yd[L.visible]=!1;yd[L.iconColor]="";yd[L.icon]="";if(this.Mxd())this.KOj(yd);else{Nc=Vc=Zb="";if(!this.yf.AreLabelsAvailable){if(!this.pHa)return 32;Zb=this.pHa;Nc=L.zIc;this.job&&(Vc=this.job)}else if(this.yf.AppliedPolicyId){ld=null;for(const sd of this.yf.SensitivityLabels)if(sd.Id.toLowerCase()===
this.yf.AppliedPolicyId.toLowerCase()){ld=sd;break}ld&&(Zb=this.qic(ld),Vc=ld.Tooltip,w.AFrameworkApplication.protectedFile=this.eh.value.dab(ld),Nc=this.Qld(ld))}Zb&&(yd[L.value]=Zb,yd[L.Qi]=Zb,this.Gp()?yd[L.customTooltip]=Vc:yd[L.alt]=Vc,this.feg(Nc,w.AFrameworkApplication.protectedFile,yd),yd[L.visible]=!0)}return 32}mNb(Zb,Vc,Nc,ld,yd){if(1===Nc)return 32;this.yf=this.eh.value.Pn;if(!this.yf||!yd)return 32;yd[L.Qi]="";if(this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",
!1)&&this.yf.HideBarByDefault)return 32;Zb="";if(this.yf.AreLabelsAvailable)if(this.yf.AppliedPolicyId){if(!this.np)return 32;(Vc=this.np[this.eh.value.Pn.AppliedPolicyId])&&(Zb=Vc.ParentId&&this.np[Vc.ParentId]?this.np[Vc.ParentId].DisplayName:Vc.DisplayName)}else Zb=this.yf.MandatoryLabelingEnforced?this.uic().wWd:this.uic().tHd;else{if(!this.pHa)return 32;Zb=this.pHa}yd[L.Qi]=Zb;return 32}qic(Zb){return Zb?this.np?Zb.ParentId&&this.np[Zb.ParentId]?this.np[Zb.ParentId].DisplayName+"\\"+Zb.DisplayName:
Zb.DisplayName:(e.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Zb.DisplayName):""}feg(Zb,Vc,Nc){this.Mxd()?(Nc[L.icon]=this.zff(Vc),Nc[L.iconColor]=this.Aff(Zb)):this.Gp()?Nc[L.icon]=Vc?L.N2j:L.P2j:(Nc[L.Ulf]=w.AFrameworkApplication.sC,Nc[L.fna]=Vc?m.getImageClass(L.O2j):m.getImageClass(L.Q2j))}lph(Zb){const Vc=this.KV("LearnMoreSection",!0);Zb=Object.assign(new B.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Zb,
LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:w.AFrameworkApplication.sC,Image16by16Class:m.getImageClass(L.iNi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Vc.ControlList,Zb);return Vc}WQe(Zb,Vc,Nc=!1){let ld;ld="Toggle_"+Zb.Id;ld="Sensitivity_"+ld;const yd=Zb.DisplayName,sd=Zb.Tooltip;var ic=Zb.Id===this.yf.AppliedPolicyId,Ic=Nc?y.a.dg(ld):ld;this.Mxd()?(ic=this.Qld(Zb),Vc=Object.assign(new P.a,{Id:Ic,ExternalId:Ic,LabelText:Nc?y.a.dg(yd):yd,
Command:"2935633379",MenuItemId:Ic,QueryCommand:"991261903",Visible:!0,Alt:Nc?y.a.dg(sd):sd,AriaLabel:Ea.a.h6b,IconColor:this.Aff(ic),KeyTip:Vc}),Vc.ExternalImageId=this.zff(this.eh.value.dab(Zb))):(Ic=Object.assign(new O.a,{Id:Ic,ExternalId:Ic,LabelText:Nc?y.a.dg(yd):yd,Command:"2935633379",MenuItemId:Ic,QueryCommand:"991261903",CheckedImage:w.AFrameworkApplication.sC,Visible:!0,Alt:Nc?y.a.dg(sd):sd,IsChecked:ic,AriaLabel:Ea.a.h6b,KeyTip:Vc}),this.isReactRibbonEnabled()?(Ic.CheckedImageClass=m.getImageClass(L.UPd),
Ic.ExternalImageId=L.UPd):Ic.CheckedImageClass=m.getImageClass(L.fvb),Vc=Ic);Ic=ld;this.Pob[Ic]=Zb.Id;this.xoe[Zb.Id]=Ic;return Vc}KV(Zb,Vc=!1){return Object.assign(new R.a,{Title:"",Id:Zb,DisplayMode:L.menu,ShowMenuSectionSeparator:Vc,ControlsId:"Ctrl_"+Zb,ControlList:[]})}msh(Zb,Vc,Nc){Zb=this.KV(Zb+"Sub");let ld=1;for(let yd of Vc)(Vc=this.np[yd])&&Vc.Enabled&&(Array.add(Zb.ControlList,this.WQe(Vc,ld.toString(),Nc)),ld++);return Zb}zd(Zb=!1){const Vc=this.KV("SensitivitySection");let Nc=1;const ld=
this.w4;for(let sd in ld){const ic=ld[sd],Ic=this.np[sd];if(Ic&&Ic.Enabled){if(ic.count){var yd="Sensitivity_"+Ic.Name;Zb&&y.a.dg(yd);yd="Label"+this.zFg++;const kd=Object.assign(new I.a,{Id:yd,ExternalId:yd,LabelText:Zb?y.a.dg(Ic.DisplayName):Ic.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new K.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Ea.a.h6b,KeyTip:Nc.toString(),Alt:Zb?y.a.dg(Ic.Tooltip):
Ic.Tooltip});this.isReactRibbonEnabled()?kd.ExternalImageId=L.UPd:(kd.Image16by16=w.AFrameworkApplication.sC,kd.Image16by16Class=m.getImageClass(L.fvb));Array.add(kd.Menu.MenuSectionList,this.msh(yd,ic,Zb));Array.add(Vc.ControlList,kd);this.Pob[kd.Id]=Ic.Id;this.xoe[Ic.Id]=kd.Id}else Array.add(Vc.ControlList,this.WQe(Ic,Nc.toString(),Zb));Nc++}}return Vc}nrb(Zb){return!!this.Na.W6(Zb)&&!!this.Na.W6(Zb).flags&&!!this.Na.W6(Zb).flags.length}Tdj(Zb,Vc){Vc.onSuccess&&this.np&&(Zb=this.np[this.eh.value.Pn.AppliedPolicyId])&&
(this.Qha&&(Vc=this.np[this.Qha])&&Vc.Order<=Zb.Order&&(this.eh.value.gga(29),this.Qha=null),this.XYa&&this.XYa!==Zb.Id&&(this.eh.value.gga(28),this.XYa=null))}zff(Zb){return Zb?L.wrj:L.vrj}Aff(Zb){return Zb?Zb:L.zIc}Qld(Zb){if(Zb.Color||!Zb.ParentId)return Zb.Color;const Vc=this.np[Zb.ParentId];return Vc?Vc.Color:Zb.Color}mbk(Zb){switch(Zb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}uic(){this.kXc||(this.kXc=Object.assign(new v,{tHd:HeaderStrings.NoSensitivityLabel,wWd:HeaderStrings.SelectASensitivityLabel}));
return this.kXc}static Hgk(){w.AFrameworkApplication.fa&&!w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!Z.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",!0))}static LAc(Zb){w.AFrameworkApplication.fa&&w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Zb?(ea.a.THd("ribbon","sensitivity"),ea.a.NHd("ribbon","sensitivity")):
ea.a.SHd("ribbon","sensitivity"));Z.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Zb))}static Gh(Zb){return Zb&&Zb.length?!1:!0}}Object(b.a)(xa,"PolicyActor",null,[630]);var wa=a(662),hb=a(105),Ja;(function(Zb){Zb[Zb.unknown=0]="unknown";Zb[Zb.boot=1]="boot";Zb[Zb.refresh=2]="refresh";Zb[Zb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ja||(Ja={}));Object(b.b)("GetPolicyLabelsReason",Ja);class Fa extends Sys.EventArgs{constructor(Zb,Vc,Nc,ld,yd,sd){super();this.qub=
Zb;this.title=Vc;this.message=Nc;this.buttonText=ld;this.$ba=yd;this.fGb=sd}}Object(b.a)(Fa,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Ba extends Sys.EventArgs{constructor(Zb,Vc,Nc,ld,yd){super();this.qub=Zb;this.title=Vc;this.message=Nc;this.buttonText=ld;this.$ba=yd}}Object(b.a)(Ba,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var fa;(function(Zb){Zb[Zb.none=0]="none";Zb[Zb.reasonDefaultLabel=1]="reasonDefaultLabel";Zb[Zb.reasonManual=2]="reasonManual";
Zb[Zb.reasonAutomatic=4]="reasonAutomatic";Zb[Zb.reasonRecommended=8]="reasonRecommended";Zb[Zb.reasonMandatory=16]="reasonMandatory"})(fa||(fa={}));Object(b.b)("ApplyLabelFlags",fa);class ta extends Sys.EventArgs{constructor(Zb,Vc,Nc){super();this.iLe=Zb;this.hLe=Vc;this.existingLabelPriority=Nc}}Object(b.a)(ta,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Oa extends Sys.EventArgs{constructor(){super()}}Object(b.a)(Oa,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class Ma extends Sys.EventArgs{constructor(){super()}}
Object(b.a)(Ma,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class fb{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=
this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.HideBarByDefault=!1}}Object(b.a)(fb,"GetPolicyLabelsData",null,[]);class pa extends Sys.EventArgs{constructor(Zb=!1){super();this.onSuccess=Zb}}Object(b.a)(pa,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Ua extends Sys.EventArgs{constructor(Zb,Vc){super();this.WAa=Zb;this.iBe=Vc}}Object(b.a)(Ua,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class Sa extends Sys.EventArgs{constructor(Zb,
Vc,Nc,ld){super();this.title=Zb;this.sxc=Vc;this.buttonText=Nc;this.hJf=ld}}Object(b.a)(Sa,"PolicyTipEventArgs",Sys.EventArgs,[]);class Ia extends Sys.EventArgs{constructor(Zb,Vc){super();this.qub=Zb;this.fGb=Vc}}Object(b.a)(Ia,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class X extends Sys.EventArgs{constructor(){super()}}Object(b.a)(X,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ca extends Sys.EventArgs{constructor(Zb,Vc){super();this.rxc=Zb;this.EN=
Vc}}Object(b.a)(ca,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class U extends Sys.EventArgs{constructor(Zb,Vc,Nc,ld=null,yd=null,sd=null,ic=null){super();this.errorType=Zb;this.Sig=Nc;this.title=ld;this.message=yd;this.buttonText=sd;this.$ba=ic}}Object(b.a)(U,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class ma extends Sys.EventArgs{constructor(){super()}}Object(b.a)(ma,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class ra extends Sys.EventArgs{constructor(Zb){super();this.hVj=Zb}}
Object(b.a)(ra,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Va=a(112),ob=a(108),ja=a(43),lb=a(64),wb=a(41);class Ab{constructor(Zb,Vc,Nc,ld,yd,sd,ic,Ic=null,kd=null,Hd=!1,Ud=null,de=null,qe=null,fe=null,Ke=!1,Te=null,Se=null,df=null,te=null,gf=null,cf=null){this.url=Zb;this.Yjk=Vc;this.body=Nc;this.headers=ld;this.bib=yd;this.priority=sd;this.state=ic;this.txg=Ic;this.IP=kd;this.IO=Hd;this.Ooj=Ud;this.UKj=de;this.name=qe;this.Ydb=fe;this.dkd=Ke;this.VLd=Te;this.Dec=Se;this.fmc=df;this.Dgb=
te;this.sqi=gf;this.responseType=cf}}Object(b.a)(Ab,"ClientRequest",null,[]);var nb=a(471),pb=a(235);class cb{static sNj(Zb,Vc){if(!Zb||!Vc||Zb.count!==Vc.count)return!1;for(let Nc of Zb)if(!Vc.contains(Nc))return!1;return!0}static toArray(Zb){if(!Zb)return null;const Vc=Array(Zb.count);let Nc=0;for(let ld of Zb)Vc[Nc]=ld,Nc++;return Vc}}Object(b.a)(cb,"HashSetUtils",null,[]);var Da=a(208),zb=a(184);class qb{constructor(Zb,Vc,Nc,ld=0,yd=null){this.tPc=this.Yee=null;this.kua=this.snb=this.unb=0;this.O3=
"";this.kIa=this.jNc=this.oie=this.lsa=this.aVc=null;this.Rie=!1;this.LFa=null;this.XRc=0;this.v0b=this.mIa=this.SGa=this.u0b=null;this.$a=new hb.a;this.uRb=this.GBb=this.uw=null;this.MSc=!1;this.GHb=null;this.Ra=Zb;this.Ah=Vc;this.ti=Nc;this.y_b=ld;this.Pn=new fb;this.woe=this.Ra.Va("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.FQ=yd;this.omc=Zb.ra("WacApplyManualPolicyLabelIsEnabled");this.Imc=Zb.ra("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Zb.ra("SupportsOfficeClientCoauthoring");
this.aIi=!1;this.KPj=3E4;this.Me=ob.a.instance;Zb.ra("SupportsPolicies")&&J.a("MipSupportsPolicies");this.Imc&&this.supportsOfficeClientCoauthoring&&J.a("MipSupportsOfficeClientCoauthoring")}get Fvd(){return this.MSc}Yye(Zb){this.$a.addHandler("PolicyTipEvent",Zb)}F4b(Zb){this.$a.addHandler("LabelInfoUpdateEvent",Zb)}Xyj(Zb){this.$a.removeHandler("LabelInfoUpdateEvent",Zb)}ize(Zb){this.$a.addHandler("SetPolicyLabelEventKey",Zb)}fAj(Zb){this.$a.removeHandler("SetPolicyLabelEventKey",Zb)}g3c(Zb){this.$a.addHandler("SetPolicyLabelFailureEventKey",
Zb)}eAj(Zb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",Zb)}rXg(Zb){this.$a.addHandler("GetPolicyLabelEventKey",Zb)}qXg(Zb){this.$a.addHandler("GetPolicyLabelFailureEventKey",Zb)}oXg(Zb){this.$a.addHandler("GetAutoPolicyLabelEventKey",Zb);this.Fvd&&(e.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.vPd(new Oa(0)))}Ayj(Zb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",Zb)}OWg(Zb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",
Zb)}fyj(Zb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",Zb)}GZg(Zb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Zb)}sAj(Zb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Zb)}HZg(Zb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",Zb)}tAj(Zb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",Zb)}Fxe(Zb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Zb)}xxj(Zb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Zb)}Zye(Zb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
Zb)}Pzj(Zb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Zb)}Gxe(Zb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}zxj(Zb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}$ye(Zb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}Qzj(Zb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}cYg(Zb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",Zb)}gzj(Zb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",
Zb)}DZg(Zb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",Zb)}qAj(Zb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",Zb)}get Qwd(){if(!this.Yee)return!1;for(const Zb of this.Yee.mok())if(!Zb.Capabilities||!Zb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get rHi(){return!!this.uw}Idh(){return this.oie?this.oie():!1}Dtj(Zb){this.jNc=Zb}Sx(){return(new Date).getTime()}phc(){this.ti&&(this.u0b=this.ti.Fd("WebServiceCall","Call Get Policy Endpoint On Server"));var Zb=Da.a.Jka(1,
1);this.Ra.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Ab(this.e8a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Zb),this.Ah.send(Zb).ZQd(Object(f.a)(this,this.HKf,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.GKf,"onDataLossPolicyFailureCallback"))):this.Ah.Sn(this.e8a("datalosspolicy"),1,null,null,!0,2,Object(f.a)(this,this.HKf,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.GKf,"onDataLossPolicyFailureCallback"),
null);this.unb++;e.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.woe,this.unb)}ktj(){this.vmd(this.O3,2,this.lsa)}vmd(Zb,Vc=0,Nc=null,ld=!1){S.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Mmd(void 0,Vc));this.GBb=this.Sx();const yd=this.jbd(Vc);this.ohc(Zb,yd,Nc,ld,Vc);this.yTd(!0)}HKf(Zb){this.pWf();let Vc="";({data:Vc}=this.T5d(Zb)).returnValue&&(e.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.unb=0,this.ti&&(this.v0b=this.ti.Fd("Task","Parse and Handle Get Policy Response")),this.Zgj(Vc),this.v0b&&(this.v0b.stop(),this.v0b=null))}GKf(Zb){this.pWf();this.unb<=this.y_b?this.phc():(e.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Zb?Zb.data?Zb.data.FUa:null:null),this.unb=0)}Juf(){return 0<this.kua}setPolicyLabel(Zb){this.Pn.AppliedPolicyId=Zb}IYd(Zb,Vc,Nc=null){const ld=this.Qoh(Nc);this.JPj(Zb,Vc,ld,Nc)}IRf(Zb){this.mIa&&
(this.mIa.stop(),this.mIa=null);let Vc,Nc;({ebg:Vc,Keg:Nc}=this.Eef(Zb));const ld=Zb.data.state,yd=ld?ld.EN:2;let sd="";({data:sd}=this.T5d(Zb)).returnValue?(e.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",yd),this.kua=0,this.shj(sd,Vc,Nc,ld)):this.eVd(yd)}aqj(Zb){S.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Mmd(Zb));this.uRb=this.Sx();e.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new ma(Zb))}KZi(){this.Imc&&this.supportsOfficeClientCoauthoring&&this.rHi&&this.uw.l$(12,null,!0)}HRf(Zb){this.mIa&&(this.mIa.stop(),this.mIa=null);let Vc;({ebg:Nc,Keg:Vc}=this.Eef(Zb));if(this.kua<=this.y_b)this.IYd(Nc,Vc);else{var Nc=(Nc=Zb.data.state)?Nc.EN:2;e.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Zb?Zb.data?Zb.data.FUa:null:null,Nc);this.GHb="WACServerConnectionFailed";
this.kua=0;this.eVd(Nc)}}dHi(Zb){if(Zb&&("LabelNotSupported"===Zb||"LabelErrorRetryLater"===Zb||"CoherencyFailure"===Zb||"LabelIdNotFound"===Zb||"LabelDisabled"===Zb))return e.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Zb),!0;e.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Zb);return!1}dab(Zb){return this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?Zb.IsEndpointProtectionEnabled||Zb.HasUserDefinedPermissions:
Zb.IsEndpointProtectionEnabled}lbh(Zb){if(!Zb)return!1;let Vc=null,Nc=null;for(const ld of this.Pn.SensitivityLabels)ld.Id===Zb&&(Vc=ld),ld.Id===this.O3&&(Nc=ld);if(!Vc)return!1;if(this.Imc&&this.supportsOfficeClientCoauthoring){if(this.jNc&&this.jNc()||this.Qwd)return!0}else if(w.AFrameworkApplication.Lx&&w.AFrameworkApplication.Lx.v7a||this.lsa&&this.lsa())return!0;return this.dab(Vc)===(!!Nc&&this.dab(Nc))}X3b(Zb,Vc,Nc,ld,yd){28===Zb?this.WZf(new Fa(Zb,Vc,Nc,ld,yd,!1)):this.WZf(new Fa(Zb,Vc,Nc,
ld,yd,!0))}gga(Zb){28===Zb?this.D_f(new Ia(Zb,!1)):this.D_f(new Ia(Zb,!0))}epj(Zb,Vc,Nc){e.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ta(Zb,Vc,Nc))}gqj(Zb){e.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ta(null,null,Zb))}hqj(Zb,Vc){e.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");
this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ta(Zb,Vc,null))}o_f(Zb,Vc){e.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Vc?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Ua(Zb,Vc))}T1c(Zb,Vc,Nc,ld,yd){37===Zb&&this.Voj(new Ba(37,Vc,Nc,ld,yd))}URd(){this.Upj(new X)}fqj(){e.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new ra(!0))}Kja(Zb=!1){const Vc=
!!this.Pn&&this.Pn.AreLabelsAvailable&&!!this.Pn.SensitivityLabels&&0<this.Pn.SensitivityLabels.length&&pb.a.any(this.Pn.SensitivityLabels,Nc=>!!Nc&&Nc.Enabled);Vc||Zb||xa.LAc(!1);return Vc}MMf(Zb){this.SGa&&(this.SGa.stop(),this.SGa=null);var Vc="";this.yTd(!1);({data:Vc}=this.T5d(Zb)).returnValue?(e.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.snb=0,Vc=this.ihj(Vc),Zb=this.fdf(Zb.data),S.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.ygc(void 0,
Zb,this.GBb)),this.GBb=null,Zb=new Oa(Zb),this.rpj(Zb),this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Vc&&this.NTj()?this.Fvd?this.tdk():(this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.rwb(),this.vPd(Zb),this.MSc=!0):Vc||this.wyc():!this.Fvd&&Vc&&this.Ra.ra("WacApplyManualPolicyLabelIsEnabled")&&this.CCe()?(this.vPd(Zb),this.MSc=!0):Vc||this.wyc()):this.wyc()}NTj(){if(!this.Ra.ra("WacApplyManualPolicyLabelIsEnabled"))return e.ULS.sendTraceTag(539877667,
306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.CCe())return!1;if(""===this.O3)return e.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.LFa===this.XRc)return e.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;e.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");
return!0}rwb(){this.Psg();e.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.kIa.count,this.LFa);const Zb=cb.toArray(this.kIa);this.epj(Zb,Zb,this.LFa)}tdk(){var Zb=this.kIa;this.Psg();cb.sNj(Zb,this.kIa)||(e.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.kIa.count),Zb=cb.toArray(this.kIa),this.hqj(Zb,Zb));this.Rie&&(e.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",
this.LFa),this.gqj(this.LFa))}Psg(){const Zb=new wa.a(l.a.hh());for(const Vc of this.Pn.SensitivityLabels)if(Vc&&Vc.AutoLabelingSensitiveTypeIds&&0<Vc.AutoLabelingSensitiveTypeIds.length)for(const Nc of Vc.AutoLabelingSensitiveTypeIds)Nc&&Zb.add(Nc);this.kIa=Zb}LMf(Zb){const Vc=this.fdf(Zb.data);S.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.ygc(void 0,Vc,this.GBb));this.GBb=null;this.SGa&&(this.SGa.stop(),this.SGa=null);if(this.snb<=this.y_b){if(this.Ra.ra("SendHostAttributionInfoForPolicyLabelEnabled")){const Nc=
Zb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Nc&&Nc[Da.a.lCc]&&"HostAttributionInfo.ScenarioTypeParamName"in Nc&&Nc[Da.a.nCc]){Zb.data.request.get_headers();Zb.data.request.get_headers();Zb=this.jbd(Vc);this.ohc(this.O3,Zb,this.lsa,void 0,Vc);return}}this.vmd(this.O3,Vc,this.lsa)}else e.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Zb?Zb.data?Zb.data.FUa:null:null),this.wyc(),this.snb=0,this.yTd(!1)}fdf(Zb){return Zb.state?
Zb.state:0}e8a(Zb,Vc=!1){let Nc=String.format("{0}{1}?action={2}&{3}",this.Ra.Va("PolicyHandlerWebServiceBase")||w.AFrameworkApplication.sa.Qa.L1,this.woe,Zb,w.AFrameworkApplication.oj);"setpolicylabel"===Zb&&w.AFrameworkApplication.Lx&&w.AFrameworkApplication.Lx.Sqf&&(Nc=lb.a.Kl(Nc,"sl","1"));Vc&&(Nc=lb.a.Kl(Nc,"cbd","1"));return Nc}Eef(Zb){let Vc,Nc;Vc=Nc=null;Zb&&Zb.data&&Zb.data.request&&Zb.data.request.get_headers()&&(Vc=Zb.data.request.get_headers()[nb.a.IWd],Nc=Zb.data.request.get_headers()[nb.a.HYd]);
return{ebg:Vc,Keg:Nc}}T5d(Zb){Zb=Zb?Zb.data?Zb.data.Pe:null:null;return Zb&&Zb.length&&!this.WHi(Zb)?{returnValue:!0,data:Zb}:(e.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Zb})}Zgj(Zb){let Vc;try{Vc=ja.b(Zb)}catch(Nc){e.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Vc)if(Vc.IsPolicyTipAvailable)switch(Vc.IsPolicyTipAvailable.toLowerCase()){case "false":e.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":e.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.tPc=Vc.NavigateUrl;this.eZj(Vc.GeneralText,Object(f.a)(this,this.T3i,"onDataLossPolicyOverrideButtonClick"));break;default:e.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Vc.IsPolicyTipAvailable)}else e.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else e.ULS.sendTraceTag(25565185,
306,10,"policyData is null after deserializing DataLossPrevention response.")}dlh(Zb){switch(Zb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;
case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}shj(Zb,Vc,Nc,ld){var yd=ld?ld.EN:2;let sd=0,ic="",Ic;if(({Bt:Ic}=ja.d(Zb)).returnValue)if(Ic){ic="Success";Zb=this.jbd(3);if(Ic.IsSuccessful){S.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.ygc(yd,void 0,this.uRb));this.GHb=this.uRb=null;e.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",yd);2===
yd&&this.gga(29);this.IQj(Vc,yd);this.KZi();this.gga(28);ld&&4===yd&&this.X3b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,ld.displayName),CommonUIStrings.l_DialogOk,()=>{});J.a("MipAppliedLabels",void 0,void 0,[Object.assign(new za.a,{name:"SetPolicyLabelApplyFlag",string:fa[yd]})]);this.ohc(Vc,Zb,this.lsa,void 0,3);return}e.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
yd,Ic.FailureReason);this.GHb=Ic.FailureReason;this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",!1)?sd=this.dlh(Ic.FailureReason):"FileTooLarge"===Ic.FailureReason?sd=7:"LabelNotSupported"===Ic.FailureReason?sd=13:"LabelDisabled"===Ic.FailureReason?sd=9:"MinorVersionLimitExceeded"===Ic.FailureReason&&(sd=15);this.aIi&&0<=Ic.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(ld=new Va.a(2,1,this.KPj,()=>{e.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",
this.kua);this.kua<=this.y_b&&this.IYd(Vc,Nc)}),this.Me.wg(ld));this.Imc&&this.supportsOfficeClientCoauthoring&&this.ohc(this.Pn.AppliedPolicyId,Zb,this.lsa,!0,3)}else ic="setPolicyLabelData null.",e.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",yd);else ic="TryDeserialize failed.",e.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",yd);this.eVd(yd,
sd);yd=this.ygc(yd,void 0,this.uRb);this.uRb=null;yd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.GHb);yd.extendedProperties.set("SetPolicyLabelDataParseStatus",ic.toString());S.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,yd)}eVd(Zb,Vc=0){const Nc=2===Zb||8===Zb||16===Zb;this.setPolicyLabel(this.O3);this.m_f(new pa);this.HPd(Vc,Zb,Nc,!1)}IQj(Zb,Vc){this.setPolicyLabel(this.O3=Zb);if(""===Zb)w.AFrameworkApplication.protectedFile=!1,w.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(const Nc of this.Pn.SensitivityLabels)if(Nc.Id===Zb){w.AFrameworkApplication.protectedFile=this.dab(Nc);break}this.$pj(new ca(Zb,Vc))}vfk(){for(const Zb of this.Pn.SensitivityLabels)Zb&&Zb.Enabled&&(Zb.Id===this.O3&&(this.Rie=this.LFa!==Zb.Order,this.LFa=Zb.Order),Zb.Order>this.XRc&&(this.XRc=Zb.Order))}ihj(Zb){if(!({Bt:Zb}=ja.d(Zb)).returnValue)return e.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Zb)return e.ULS.sendTraceTag(42467542,
306,10,"policyData is null after deserializing label policy data response."),!1;if(!Zb.AreLabelsAvailable)return!1;this.Pn=Zb;this.O3=Zb.AppliedPolicyId;this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnablePdfProtectionUsageTelemetry",!1)&&this.Ra.appSettings&&(this.Ra.appSettings.AppliedPolicyId=this.O3);this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.vfk();this.Kja()&&e.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.m_f(new pa(!0));return!0}CCe(){if(!this.Kja())return e.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Zb of this.Pn.SensitivityLabels)if(Zb&&Zb.AutoLabelingSensitiveTypeIds&&0<Zb.AutoLabelingSensitiveTypeIds.length)return!0;e.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}m_f(Zb){e.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");
this.$a.raiseEvent("LabelInfoUpdateEvent",Zb)}rpj(Zb){e.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",Zb)}wyc(){xa.LAc(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",new Ma)}vPd(Zb){this.FQ&&this.FQ.execute(Vc=>{Vc=[Vc.isFeatureEnabled("MsoClpSpTwo",!0),Vc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Vc).then(Nc=>{pb.a.any(Nc,ld=>ld)&&(e.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.$a.raiseEvent("GetAutoPolicyLabelEventKey",
Zb),this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.rwb(),J.a("MipAutoClassificationEnabled"));return null})})}Mmd(Zb=null,Vc=null){const Nc=new Map;Nc.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Zb&&Nc.set("ApplyLabelFlags",fa[Zb]);null!=Vc&&Nc.set("GetPolicyLabelsReason",Ja[Vc]);return Nc}ygc(Zb=null,Vc=null,Nc=null){const ld=new zb.a;ld.extendedProperties=this.Mmd(Zb,Vc);null!=Nc&&(ld.durationMs=this.Sx()-Nc);
return ld}$pj(Zb){e.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",Zb)}WZf(Zb){e.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");Zb&&Zb.fGb&&J.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Zb)}D_f(Zb){e.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Zb)}Voj(Zb){e.ULS.sendTraceTag(573842331,
306,50,"Raising an add mandatory labelling business bar entry event.");this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}Upj(Zb){e.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}eZj(Zb,Vc=null){e.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new Sa(CommonUIStrings.l_PolicyBusinessBarTitle,Zb,CommonUIStrings.l_PolicyOverrideButton,
Vc))}HPd(Zb,Vc,Nc,ld=!0){e.ULS.sendTraceTag(42074656,306,ld?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Vc);ld=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let yd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,sd=null,ic=null;switch(Zb){case 2:ld=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:yd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;
break;case 7:ld=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:ld=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:ld=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;yd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;
break;case 10:yd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:ld=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;yd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:ld=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,yd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,sd=CommonUIStrings.l_LearnMore,ic=()=>{this.LPj()}}Zb=
new U(Zb,Vc,Nc,ld,yd,sd,ic);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",Zb)}WOj(Zb){this.aVc=Zb}T3i(){this.tPc?(e.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),wb.a.aS(this.tPc)):e.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}WHi(Zb){if(!Zb.startsWith("<")||-1===Zb.indexOf("Error")&&-1===Zb.indexOf("Unavailable"))return!1;e.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");
return!0}pWf(){this.u0b&&(this.u0b.stop(),this.u0b=null)}e_h(Zb){if(!Zb)return"manual";switch(Zb.EN){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}}m0h(Zb){if(!Zb)return"privileged";Zb=Zb.EN;let Vc="privileged";if(4===Zb||1===Zb)Vc="standard";return Vc}ohc(Zb,Vc,Nc=null,ld=!1,yd=0){this.Ra.ra("WacLabelingGetPolicyLabelsIsEnabled")&&(this.O3=Zb,this.lsa=Nc,this.ti&&(this.SGa=this.ti.Fd("WebServiceCall",
"Call Get Policy Endpoint On Server")),Nc={},Nc[nb.a.kCe]=Zb,this.Ra.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Ab(this.e8a("getpolicylabels",ld),1,null,Nc,!0,2,yd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Vc),this.Ah.send(Zb).ZQd(Object(f.a)(this,this.MMf,"onGetPolicyLabelsSuccessCallback"),Object(f.a)(this,this.LMf,"onGetPolicyLabelsFailureCallback"))):this.Ah.Sn(this.e8a("getpolicylabels",ld),1,null,Nc,!0,2,Object(f.a)(this,this.MMf,"onGetPolicyLabelsSuccessCallback"),
Object(f.a)(this,this.LMf,"onGetPolicyLabelsFailureCallback"),yd,void 0,void 0,void 0,void 0,"22"),this.snb++,e.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.snb))}JPj(Zb,Vc,Nc,ld=null){if(this.omc){this.ti&&(this.mIa=this.ti.Fd("WebServiceCall","Call Set Policy Endpoint On Server"));var yd={};yd[nb.a.IWd]=Zb;Vc&&(yd[nb.a.HYd]=encodeURIComponent(Vc));this.aVc&&(yd[nb.a.hBe]=this.aVc);ld?(yd[nb.a.FYd]=this.e_h(ld),yd[nb.a.GYd]=this.m0h(ld),this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",
!1)&&1===ld.EN&&this.Pn.DefaultLabelType&&(yd[nb.a.Jeg]=this.Pn.DefaultLabelType)):(yd[nb.a.FYd]="manual",yd[nb.a.GYd]="privileged");this.supportsOfficeClientCoauthoring&&this.Pn&&(yd[nb.a.qWf]=this.Pn.PolicyLabelVersionToken);this.Ra.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Ab(this.e8a("setpolicylabel",!0),1,null,yd,!0,2,ld,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Nc),this.Ah.send(Zb).ZQd(Object(f.a)(this,this.IRf,"onSetPolicyLabelSuccessCallback"),
Object(f.a)(this,this.HRf,"onSetPolicyLabelFailureCallback"))):this.Ah.Sn(this.e8a("setpolicylabel",!0),1,null,yd,!0,2,Object(f.a)(this,this.IRf,"onSetPolicyLabelSuccessCallback"),Object(f.a)(this,this.HRf,"onSetPolicyLabelFailureCallback"),ld,void 0,void 0,void 0,void 0,"32");this.kua++;e.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.kua)}else e.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}LPj(){const Zb=
new V.StandardDialog,Vc=this.Ra.Va("BreadcrumbFolderUrl");Vc?(Zb.Ac=11,Zb.Qc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Zb.Qc(2,CommonUIStrings.l_DialogOk)):(Zb.Ac=0,Zb.Qc(1,CommonUIStrings.l_DialogOk));Zb.Bwe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Zb.Fwj();Zb.QT(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
Nc=>{1===Nc&&Vc&&wb.a.Vf(Vc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}jbd(Zb){switch(Zb){case 1:return Da.a.Jka(1,1);case 2:return Da.a.Jka(7,1);case 3:return Da.a.Jka(8,1);default:return Da.a.Jka(7,0)}}Qoh(Zb=null){if(!Zb)return Da.a.Jka(8,0);switch(Zb.EN){case 1:case 16:return Da.a.Jka(1,1);case 4:case 2:case 8:return Da.a.Jka(8,1);default:return Da.a.Jka(8,0)}}yTd(Zb){this.Ra.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Zb)}}Object(b.a)(qb,"PolicyManager",null,[606]);var Pa=a(142),Nb=a(261);class Tb{constructor(){this.R3=this.Uta=this.Nb=this.eh=null}get name(){return"Common.App.Policy"}init(){w.AFrameworkApplication.fa.ra("ShouldInitCommonPolicyPackage")&&(w.AFrameworkApplication.fa.ra("IsDataLossPreventionEnabledForUser")&&w.AFrameworkApplication.sa&&(this.eh=this.Nb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.eh.Yye(Object(f.a)(this,this.M0d,
"showPolicyBusinessBar")),e.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Pa.a.get_instance().Fj(5,()=>{this.eh.phc()}):Pa.a.get_instance().Fj(6,()=>{this.eh.phc()})),w.AFrameworkApplication.fa.ra("WacLabelingPoliciesIsEnabled")&&w.AFrameworkApplication.fa.ra("SupportsPolicies")?w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",
!1)?Pa.a.get_instance().Fj(5,Object(f.a)(this,this.sIf,"onAfterRibbonBehaviorAttached")):Pa.a.get_instance().Fj(6,Object(f.a)(this,this.sIf,"onAfterRibbonBehaviorAttached")):(xa.Hgk(),xa.LAc(!1)))}dispose(){}Oi(Zb){Zb.register(606,"Common.App.Policy.Contracts.IPolicyManager").gd().od(()=>new qb(w.AFrameworkApplication.fa,w.AFrameworkApplication.qe,w.AFrameworkApplication.sa.qF,w.AFrameworkApplication.fa.Ae("MaxGetPolicyRetries",1),Zb.Dc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
w.AFrameworkApplication.sa.Qa.li));Zb.register(xa,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").gd().od(()=>new xa(w.AFrameworkApplication.dc,w.AFrameworkApplication.sa,w.AFrameworkApplication.fa,Zb.MUd("Common.App.Policy.Contracts.IPolicyManager")));this.Nb=Zb}sIf(){this.R3=this.Nb.nh("CommonUI.BusinessBar");this.eh||(this.eh=this.Nb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Uta=this.Nb.resolve("Common.App.Policy.PolicyActor");Z.a("isSharedUxGateEnabled")&&
appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.eh.F4b(Object(f.a)(this.Uta,this.Uta.r2f,"registerActionsHandler")):this.Uta.Ih();this.eh.F4b(Object(f.a)(this,this.g7d,"updateLabelInfo"));w.AFrameworkApplication.fa.ra("WacApplyManualPolicyLabelIsEnabled")&&(this.eh.g3c(Object(f.a)(this,this.cni,"handleSetPolicyLabelFailure")),this.eh.Fxe(Object(f.a)(this,this.X3b,"addAutoPolicyBusinessBarEntry")),this.eh.Zye(Object(f.a)(this,this.gga,"removeAutoPolicyBusinessBarEntry")),
this.eh.Gxe(Object(f.a)(this,this.T1c,"addMandatoryLabellingBusinessBarEntry")),this.eh.$ye(Object(f.a)(this,this.URd,"removeMandatoryLabellingBusinessBarEntry")))}g7d(){this.Uta.Eeg();this.Uta.Ydg();this.Uta.GZf();const Zb=this.eh.Idh();w.AFrameworkApplication.fa.ra("HasDocumentEditRights")&&!Zb?this.Uta.eqg():e.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",w.AFrameworkApplication.fa.ra("HasDocumentEditRights"),
Zb);w.AFrameworkApplication.sa.updateCommandUI()}M0d(Zb,Vc){this.ddf(Vc.title,Vc.sxc,38,Vc.hJf,Vc.buttonText);e.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}cni(Zb,Vc){Vc.Sig&&(this.ddf(Vc.title,Vc.message,21,null,null,Vc.$ba,Vc.buttonText),e.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}gga(){}X3b(Zb,Vc){this.R3&&(this.eh.gga(Vc.qub),Zb=new d.a(Vc.title,
Vc.message,null),Zb.id=Vc.qub,Zb.closeable=!0,Zb.image=3,Zb.addButton(Vc.buttonText,Vc.$ba,Vc.buttonText,!0),this.R3.LD(Zb,!1))}T1c(Zb,Vc){this.R3&&(Zb=new d.a(Vc.title,Vc.message,null),Zb.id=Vc.qub,Zb.closeable=!1,Zb.image=3,Zb.addButton(Vc.buttonText,Vc.$ba,Vc.buttonText,!1),this.R3.LD(Zb,!1))}URd(){}ddf(Zb,Vc,Nc,ld=null,yd=null,sd=null,ic=null){Zb=new d.a(Zb,Vc,null);Zb.id=Nc;Zb.closeable=!0;ld&&Zb.PTg(yd,ld);sd&&Zb.addButton(ic,sd,ic)}static main(){Nb.a.instance.wj(new Tb)}}Object(b.a)(Tb,"PackageManager",
null,[4,5]);var Vb=a(1),Jb=a(10),Qa=a(563),Db=a(230),sa=a(52),Ha=a(40),mb=a(126),qa=a(42),Xa=a(382),Ca=a(201),va=a(91),na=a(34),Ka=a(231),ib=a(23),Ra=a(248);class ka{constructor(){this.rxc=this.Ybg=null;this.EN=0}}Object(b.a)(ka,"ApplyPolicyContextParameters",null,[]);var da=a(2),kb=a(723),Ob=a(576),lc=a(51),tc=a(48);class Pb{constructor(){this.iva=this.annotationType=null;this.vPa=this.Zx=!1}}Object(b.a)(Pb,"AnnotationActivationOptions",null,[]);var tb=a(59);const gc=(Zb,Vc,Nc,ld,yd,sd,ic=null)=>
{ic=Zb.Pa(1,ic);ic.tenantId=Vc;return tb.g(Zb,"GetPolicyLabelId",ic,Nc,ld,yd,sd,4)},Xb=(Zb,Vc,Nc,ld,yd,sd,ic,Ic,kd,Hd,Ud=null)=>{Ud=Zb.Pa(41,Ud);Ud.labelsInfoJson=Vc;Ud.appliedLabelId=Nc;Ud.tenantId=ld;Ud.applyLabelFlag=yd;Ud.skipApplyOutcomes=sd;return tb.g(Zb,"ApplyPolicyLabel",Ud,ic,Ic,kd,Hd,0)},Ga=(Zb,Vc,Nc,ld,yd,sd,ic=null)=>{ic=Zb.Pa(1,ic);ic.tenantId=Vc;return tb.g(Zb,"GetPolicyApplicationMethod",ic,Nc,ld,yd,sd,4)};var Za=a(748),Sb=a(728);class sb extends Za.a{constructor(){super();this.source=
this.automatic=this.recommended=null;this.H_=Object.assign(new Sb.a,{T_:sb.getTypeName(),B_:sb.we()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static we(){return["AugLoop_Core_Annotation"]}}Object(b.a)(sb,"LabellingAnnotation",Za.a,[]);var bc=a(747);class kc extends bc.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Sb.a,{T_:kc.getTypeName(),B_:kc.we()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static we(){return[]}}
Object(b.a)(kc,"SecurityShared",bc.a,[]);class vb extends kc{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Sb.a,{T_:vb.getTypeName(),B_:vb.we()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static we(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(b.a)(vb,"CLP",kc,[]);class ub extends Za.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Sb.a,{T_:ub.getTypeName(),B_:ub.we()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static we(){return["AugLoop_Core_Annotation"]}}
Object(b.a)(ub,"LabellingAnnotation",Za.a,[]);var Ub=a(1024),Rd=a(914),Cd=a(1026);class Yc extends Za.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Sb.a,{T_:Yc.getTypeName(),B_:Yc.we()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static we(){return["AugLoop_Core_Annotation"]}}Object(b.a)(Yc,"LinkedDataTypeAnnotation",Za.a,[]);var Kd=a(149),oc=a(35),eb=a(100);class yb extends qa.a{constructor(Zb,Vc,Nc,ld,yd){super();this.FDf=3;this.T9a=
Vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6649853_AutoPolicyMigratingToNewALAPI");this.Dx=this.augmentationLoopManager=null;this.F2a=!1;this.Ldb=[];this.Sxf=new kb.a(Ob.a.OL());this.nOd=0;this.sOd=null;this.rwb=(sd,ic)=>{sd=Object(da.a)(new Ub.a,{parentPath:["session","doc","security"],items:[Object(da.a)(new Rd.a,{id:"clp",body:Object(da.a)(new vb,{existingLabelPriority:ic.existingLabelPriority,partialDocSITs:ic.iLe,fullDocSITs:ic.hLe})})]});this.Ldb.push(sd);this.LDb()};this.Nsg=(sd,ic)=>{sd=
Object(da.a)(new Cd.a,{parentPath:["session","doc","security"],items:[Object(da.a)(new Rd.a,{id:"clp",body:Object(da.a)(new vb,{existingLabelPriority:ic.existingLabelPriority})})]});this.Ldb.push(sd);this.LDb()};this.Osg=(sd,ic)=>{sd=Object(da.a)(new Cd.a,{parentPath:["session","doc","security"],items:[Object(da.a)(new Rd.a,{id:"clp",body:Object(da.a)(new vb,{partialDocSITs:ic.iLe,fullDocSITs:ic.hLe})})]});this.Ldb.push(sd);this.LDb()};this.P8=()=>{e.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);
this.$.isEditMode?Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.LDb():this.rmf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.Cuh())};this.Vcb=()=>{var sd;e.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.T9a?null===(sd=this.augmentationLoopManager)||void 0===sd?void 0:sd.unregister("AutoPolicy"):this.gTe();this.augmentationLoopManager=null};this.WLi=(sd,ic)=>{var Ic,
kd,Hd,Ud,de;e.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===ic.operationType)e.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var qe=sd=null,fe=null;if(this.qmc()){var Ke=ic.YB;if(!Ke){e.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Ic=Ke.automatic)||void 0===Ic?0:Ic.id)sd=Ke.automatic.id;if(null===
(kd=Ke.recommended)||void 0===kd?0:kd.id)qe=Ke.recommended.id,Ke.recommended.policyTip&&(fe=Ke.recommended.policyTip)}else{Ic=ic.YB;if(!Ic){e.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Hd=null===(Ke=Ic.automatic)||void 0===Ke?void 0:Ke.sensitivityLabel)||void 0===Hd?0:Hd.id)sd=Ic.automatic.sensitivityLabel.id;if(null===(de=null===(Ud=Ic.recommended)||void 0===Ud?void 0:Ud.sensitivityLabel)||void 0===de?0:de.id)qe=
Ic.recommended.sensitivityLabel.id,Ic.recommended.sensitivityLabel.policyTip&&(fe=Ic.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(sd,qe,fe,1)}};this.WNi=(sd,ic)=>{e.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===ic.operationType?e.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(sd=ic.YB)?(sd=sd.classificationId,this.applyPolicyLabel(sd,
sd,null,2)):e.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.w3f=(sd,ic)=>{ic?ic.fGb&&this.businessBar.gG(41)?(this.businessBar.removeEntry(41),e.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!ic.fGb&&this.businessBar.gG(40)&&(this.businessBar.removeEntry(40),e.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):
e.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.fig=(sd,ic)=>{ic?ic.fGb?(this.businessBar.sZj(ic.title,ic.message,ic.buttonText,Ic=>{ic.$ba(Ic);this.businessBar.gG(41)&&this.businessBar.removeEntry(41)}),e.ULS.sendTraceTag(537154531,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.kXj(ic.title,ic.message,ic.buttonText,Ic=>{ic.$ba(Ic);this.businessBar.gG(40)&&
this.businessBar.removeEntry(40)}),e.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):e.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.YMd=Zb;this.policyManager=Vc;this.$=Nc;this.fa=ld;this.businessBar=yd;this.rsi();this.Ftj();this.disposed=!1}get Oc(){return!this.disposed&&this.$.ea.Oc}dispose(){var Zb;this.disposed||(this.disposed=!0,
this.vwh(),this.T9a?null===(Zb=this.augmentationLoopManager)||void 0===Zb?void 0:Zb.unregister("AutoPolicy"):this.gTe(),this.YMd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}k2a(Zb,Vc,Nc,ld,yd=!1){e.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${ld} with AutoLabelPresent: ${!!Zb}, RecommendedLabelPresent: ${!!Vc}, isStandard: ${yd}.`);this.Oc?this.YMd&&(this.nbh(Vc,ld)?(this.sOd=Vc,this.nOd=ld,this.Sxf.ia(ld,Vc)):Vc=
this.sOd,Zb=this.YMd.k2a(Zb,Vc,Nc,yd),e.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Zb}.`)):e.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Oc}.`)}nbh(Zb,Vc){if(!this.policyManager.Kja())return e.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;const Nc=this.policyManager.Pn;
let ld;({value:ld}=this.Sxf.Ad(this.nOd));let yd=null,sd=null,ic=null;for(const Ic of Nc.SensitivityLabels)Ic.Id===Zb&&(yd=Ic),Ic.Id===ld&&(sd=Ic),Ic.Id===this.sOd&&(ic=Ic);return sd&&sd.Id===Zb?(e.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.gG(41)&&this.nOd!==Vc&&ic&&(!yd||ic.Order>=yd.Order)?(e.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),
!1):!0}qmc(){return Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Sof(){return Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}Ftj(){this.policyManager.Fxe(this.fig);this.policyManager.Zye(this.w3f);this.$.ea.c5(this.P8);this.qmc()&&this.Sof()&&(this.policyManager.OWg(this.rwb),this.policyManager.GZg(this.Nsg),this.policyManager.HZg(this.Osg))}vwh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);
this.policyManager.xxj(this.fig);this.policyManager.Pzj(this.w3f);this.$.ea.O9(this.P8);this.qmc()&&this.Sof()&&(this.policyManager.fyj(this.rwb),this.policyManager.sAj(this.Nsg),this.policyManager.tAj(this.Osg))}rsi(){this.Dx=new kb.a(Ob.a.OL());const Zb=this.qmc()?sb.getTypeName():ub.getTypeName();this.Dx.add(1,Object(da.a)(new Pb,{annotationType:Zb,iva:this.WLi,Zx:!1,vPa:!1}));this.Dx.add(2,Object(da.a)(new Pb,{annotationType:Yc.getTypeName(),iva:this.WNi,Zx:!1,vPa:!1}))}xmg(){for(let Zb of this.Ldb)this.augmentationLoopManager.submitOperation(Zb);
this.Ldb=[]}K9(Zb){if(!this.Dx.Pb(Zb))return e.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Zb}.`),!1;if(this.Dx.ma(Zb).Zx)return e.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Zb}.`),!0;this.Dx.ma(Zb).Zx=!0;e.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Zb}.`);
if(!this.$.isEditMode)return e.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.LDb():this.rmf();return!0}rmf(){var Zb=!1;for(let Vc of this.Dx)if(Zb=Vc.value.Zx||Zb)break;Zb?this.augmentationLoopManager?(e.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.w3b()):this.F2a?e.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.F2a=!0,Zb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,e.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Zb} milliseconds.`),lc.a.instance.create(()=>{this.tsi()},Zb,tc.a.gEe,!0,!0)):e.ULS.sendTraceTag(537154632,306,
50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}LDb(){var Zb=0<this.Ldb.length;if(!Zb)for(let Vc of this.Dx)if(Zb=Vc.value.Zx||Zb)break;Zb?this.augmentationLoopManager?(e.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.w3b(),this.xmg()):this.F2a?e.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.F2a=!0,Zb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,e.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Zb} milliseconds.`),lc.a.instance.create(()=>{this.usi()},Zb,tc.a.gEe,!0,!0)):e.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}usi(){Ha.TaskExtensions.za(Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateAugmentationLoopToNewServiceInfra",
!1)?Object(eb.d)(Kd.a.resolve(oc.f,{Wa:1})):sa.GetServiceTaskFactory.Za(this.$.da,328,327,1),Zb=>{this.augmentationLoopManager=Zb.result;this.F2a=!1;this.augmentationLoopManager?(e.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.T9a?this.augmentationLoopManager.register(this.augmentationLoopManager.v0().S2("AutoPolicy").P2(this.Vcb).build()):this.augmentationLoopManager.bwe(this.Vcb),this.$.isEditMode?(this.w3b(),this.xmg()):
e.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):e.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}tsi(){Ha.TaskExtensions.za(Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateAugmentationLoopToNewServiceInfra",!1)?Object(eb.d)(Kd.a.resolve(oc.f,{Wa:1})):sa.GetServiceTaskFactory.Za(this.$.da,328,327,1),Zb=>{this.augmentationLoopManager=
Zb.result;this.F2a=!1;this.augmentationLoopManager?(e.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.T9a?this.augmentationLoopManager.register(this.augmentationLoopManager.v0().S2("AutoPolicy").P2(this.Vcb).build()):this.augmentationLoopManager.bwe(this.Vcb),this.$.isEditMode?this.w3b():e.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):e.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}gTe(){for(let Zb of this.Dx)Zb.value.Zx&&this.uwh(Zb.key)}uwh(Zb){this.Dx.ma(Zb).vPa&&this.aSe(Zb);this.Dx.ma(Zb).Zx=!1;e.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${Zb}.`)}w3b(){for(let Zb of this.Dx)Zb.value.Zx&&!Zb.value.vPa&&this.activateAnnotation(Zb.key)}activateAnnotation(Zb){this.T9a?this.augmentationLoopManager.K9("AutoPolicy",
{annotationType:this.Dx.ma(Zb).annotationType,Tv:!0,WO:this.Dx.ma(Zb).iva}):(this.augmentationLoopManager.srb(this.Dx.ma(Zb).annotationType),this.augmentationLoopManager.Nua(this.Dx.ma(Zb).annotationType,this.Dx.ma(Zb).iva));this.Dx.ma(Zb).vPa=!0;e.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Zb}.`)}Cuh(){for(let Zb of this.Dx)Zb.value.vPa&&this.aSe(Zb.key)}aSe(Zb){var Vc;this.T9a?null===(Vc=this.augmentationLoopManager)||void 0===Vc?void 0:
Vc.ack(this.Dx.ma(Zb).annotationType):this.augmentationLoopManager.zzc(this.Dx.ma(Zb).annotationType,this.Dx.ma(Zb).iva);this.Dx.ma(Zb).vPa=!1;e.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Zb}.`)}applyPolicyLabel(Zb,Vc,Nc,ld){if(this.fa.ra("SupportsOfficeClientCoauthoring"))e.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.k2a(Zb,Vc,Nc,ld);else{e.ULS.sendTraceTag(537154578,
306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const yd=sd=>{this.k2a(Zb,Vc,Nc,ld,0===sd||1===sd||4===sd)};this.Iod(yd,()=>{yd(2)},this.FDf)}}j5c(Zb,Vc){let Nc=null,ld=null;if(!({sensitivityLabel:Nc,GJa:ld}=this.Uqg(Zb)).returnValue)return e.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(ld&&ld.Order>=Nc.Order)return e.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),
!1;this.applyPolicyLabel(Nc.Id,Nc.Id,null,Vc);return!0}k5c(Zb,Vc){Vc=!1;let Nc=null,ld=null;if(!({sensitivityLabel:Nc,GJa:ld}=this.Uqg(Zb)).returnValue)return e.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,p$a:Vc};if(ld&&ld.ParentId&&Nc.ParentId&&ld.ParentId===Nc.ParentId)return e.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,
p$a:Vc};if(ld&&ld.Order>=Nc.Order)return e.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,p$a:Vc};if(this.fa.ra("SupportsOfficeClientCoauthoring"))e.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Zb=this.policyManager.Pn,Zb=!Zb.AppliedPolicyId||!Zb.PolicyLabelAssignmentMethod||oa.e(Zb.PolicyLabelAssignmentMethod)===
oa.e("standard"),this.vCe(Nc.Id,Zb);else{e.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const yd=sd=>{this.vCe(Nc.Id,0===sd||1===sd||4===sd)};this.Iod(yd,()=>{yd(2)},this.FDf)}return{returnValue:!0,p$a:Vc}}Iod(Zb,Vc,Nc,ld=0){if(this.Oc){var yd=this.$.qa.va.Lc();Ga(this.$.qa.va,this.$.xa.DocumentHostInfo.TenantId,sd=>{this.xbi(sd,Zb)},()=>{this.wbi(Zb,Vc,Nc,ld)},null,null,yd)}else e.ULS.sendTraceTag(537154570,
306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Oc}.`)}xbi(Zb,Vc){e.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Oc?!Zb||Ka.a(Zb)?e.ULS.sendTraceTag(537154567,306,15,Zb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Vc(Zb.Result):e.ULS.sendTraceTag(537154568,
306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Oc}.`)}wbi(Zb,Vc,Nc,ld){e.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.Oc?ld>=Nc?(e.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Vc()):this.Iod(Zb,Vc,Nc,ld+1):e.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Oc}.`)}vCe(Zb,
Vc){Vc?this.k2a(Zb,null,null,3,!0):this.k2a(null,Zb,null,3,!1)}Uqg(Zb){let Vc,Nc;Nc=Vc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Vc,GJa:Nc};if(!this.policyManager.Kja())return e.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Vc,GJa:Nc};const ld=this.policyManager.Pn;if(!ld)return e.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:Vc,GJa:Nc};if(pb.a.Gh(ld.SensitivityLabels))return e.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Vc,GJa:Nc};const yd=ld.AppliedPolicyId;for(const sd of Zb)for(const ic of ld.SensitivityLabels)ic.Id===sd&&(!Vc||Vc.Order<ic.Order)&&(Vc=ic),ic.Id===yd&&(Nc=ic);return Vc?{returnValue:!0,sensitivityLabel:Vc,GJa:Nc}:(e.ULS.sendTraceTag(537154526,
306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Vc,GJa:Nc})}}Object(b.a)(yb,"AutoPolicyManager",qa.a,[2]);var zc=a(167),dd=a(13),od=a(16);class Ed extends zc.ErrorDialog{constructor(Zb){super(Zb,Ed.jS(Zb))}lr(){super.lr();if(this.error.Appearance&1&&this.$.oe&2){const Zb=this.getButton(0);dd.DOMElementExtensions.VXd(Zb.get_element(),od.a.instance.ha(1315));this.CN(()=>{0===this.returnValue&&this.$.oe&2&&(e.ULS.sendTraceTag(50373725,
306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Ha.TaskExtensions.za(sa.GetServiceTaskFactory.Za(this.$.da,55,56,0),Vc=>{Vc.result.S$c()},this.$.ka,3))})}}static jS(Zb){return Zb.oe&2?na.a.Wd(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):na.a.Wd(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(b.a)(Ed,"BlockSenitivityLabelActionDialog",zc.ErrorDialog,[]);var ce=a(30),wc=a(89);class ed extends qa.a{constructor(Zb,Vc,Nc,ld,
yd){super();this.statusBarManager=null;this.g6c=!1;this.Wba=null;this.kKc=!1;this.WAa=this.jXd=null;this.Xo=this.ZMd=!1;this.oHa=this.pne=this.sia=this.yoe=this.Dq=null;this.jXe=()=>{e.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const sd=this.w2f(1);e.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${sd}.`)};this.M0d=(sd,ic)=>{ic?(this.Dq=
ic.title,this.yoe=ic.sxc,this.sia=ic.buttonText,this.pne=ic.hJf,this.aca.oh(27,null),e.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):e.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.vjg=(sd,ic)=>{const Ic=Object(mb.a)(U,ic);Ic?Ic.Sig?(e.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Ic.errorType}`),this.aca.yZj(Ic.title,Ic.message,
Ic.buttonText,kd=>{Ic.$ba&&(this.aca.gG(54)&&this.aca.removeEntry(54),Ic.$ba(kd))})):e.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(e.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.aca.oh(48,null))};this.g7d=(sd,ic)=>{this.s9&&(e.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.s9.Eeg(),this.s9.Ydg(),this.s9.GZf(),
this.$.oe&64&&(ic.onSuccess&&this.WAa?this.b2g():this.s9.eqg()));this.fa.ra("SupportsOfficeClientCoauthoring")&&(sd=this.St.Pn,this.oHa=sd.AppliedPolicyId,"null"===this.labelId&&(this.oHa=""),this.kKc&&(sd=sd.PolicyLabelAssignmentMethod&&oa.e(sd.PolicyLabelAssignmentMethod)===oa.e("standard")?4:2,this.applyPolicyLabel(this.labelId,sd,!0,this.jXd)));this.t2e();this.XA()};this.KMf=()=>{this.ZMd=!0;this.t2e()};this.GRf=(sd,ic)=>{e.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${w.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${ic.EN}`);
this.applyPolicyLabel(ic.rxc,ic.EN,!1,null)};this.d1i=(sd,ic)=>{this.oHa=ic.rxc;if(na.a.Iq(sd.Errors)){var Ic=na.a.K6(sd.Errors,[2045508683]);0<Ic.length&&(sd.Errors=na.a.hB(sd.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.ep(sd.Errors));Ic=na.a.K6(sd.Errors,[2046680228]);0<Ic.length&&(4===ic.EN||1===ic.EN)&&(sd.Errors=na.a.hB(sd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.ep(sd.Errors));Ic=sd=null;
for(var kd of this.St.Pn.SensitivityLabels)ib.a.equals(this.labelId,kd.Id,!1)&&(sd=kd),ib.a.equals(ic.Ybg,kd.Id,!1)&&(Ic=kd);kd={};kd.ApplyLabelFlag=ic.EN;sd?(kd.currentLabel="Set",kd.currentLabelEnabled=sd.Enabled,kd.currentLabelName=sd.Name?"Set":"NotSet",kd.currentLabelParentId=sd.ParentId?"Set":"NotSet"):kd.currentLabel="NotSet";Ic?(kd.serverLabel="Set",kd.serverLabelEnabled=Ic.Enabled,kd.serverLabelName=Ic.Name?"Set":"NotSet",kd.serverLabelParentId=Ic.ParentId?"Set":"NotSet"):kd.serverLabel=
"NotSet";e.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(kd)}`)}};this.Z5g=(sd,ic)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const Ic=this.St.Pn;if(!Ic)return e.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let kd=null;for(const Hd of Ic.SensitivityLabels)ib.a.equals(Hd.Id,sd,!1)&&(kd=Hd);return kd&&this.Qoi(kd)?(e.ULS.sendTraceTag(50341186,
306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.nXj(ic),!0):!1};this.uyi=()=>{let sd=!1;!this.$.xa.IsNewWorkbook||this.labelId&&this.labelId.length||(sd=!0);e.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${sd}`);return sd};this.uDf=(sd,ic)=>{1===ic.iBe?this.$.isEditMode?(e.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ia.mc(new va.a(-723527778,
0,this.$.Tc,10,null))):e.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.WAa=ic.WAa,this.$.ea.c5(this.qCe),this.$.akb(),e.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ia.mc(new va.a(-8805455,0,this.$.Tc,10,null)))};this.Fwe=(sd,ic)=>{ic?(sd=!!(this.$.oe&64),e.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${sd}`),sd&&(this.$.akb(),this.aca.IYj(ic.title,
ic.message,ic.buttonText,Ic=>{ic.$ba(Ic)}))):e.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.S3f=()=>{this.aca.gG(42)&&this.aca.removeEntry(42)};this.yrg=(sd,ic)=>{ic.hVj&&(e.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),Ha.TaskExtensions.za(sa.GetServiceTaskFactory.Za(this.$.da,55,56,0),Ic=>{Ic.result.S$c()},
this.$.ka,3))};this.qCe=()=>{this.WAa&&this.$.isEditMode?(this.$.ea.O9(this.qCe),this.NAb()):e.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.WAa} , edit mode : ${this.$.isEditMode}.`)};this.Wma=()=>{const sd=this.$.ea.ao;sd&&!ib.a.equals(sd.AppliedPolicyLabelId,this.labelId,!1)&&(e.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),e.ULS.shipAssertTag(537154463,
306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.ra("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.kKc=!0,this.jXd=sd.AppliedPolicyLabelId),this.oHa=sd.AppliedPolicyLabelId,this.NAb())};this.Qwd=()=>{let sd=!0;if(!this.$.ea.amIAlone)for(const ic of this.$.ea.Eo)if(!ic.SupportsClientIsMipTrusted){sd=!1;break}e.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${sd}`);
return sd};this.YNf=()=>{e.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.kKc=!0;this.NAb()};this.$=ld;this.St=Zb;this.aca=Nc;this.fa=yd;this.St.Yye(this.M0d);this.s9=Vc}initialize(){this.fa.ra("SupportsPolicies")?(this.oHa=this.fa.Va("AppliedPolicyId"),this.s9.Ih(),this.$.da.Qb(29,Zb=>{this.statusBarManager=Zb;Zb.TK(this)}),this.XA(),ib.a.Gh(this.fa.Va("HostUserId"))||this.ojj(),this.s9.Htj(this.Z5g),this.s9.Auj(this.uyi),this.St.Dtj(this.Qwd),
this.Xo=Vb.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste")):Z.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!ib.a.Gh(this.fa.Va("HostUserId"))&&Vb.EwaSettings.ya(158)&&this.$.ea.Dh.get(45)&&(e.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.a5h())}Ar(Zb){this.addHandler("LabelInfoChangedKey",Zb)}$r(Zb){this.removeHandler("LabelInfoChangedKey",Zb)}Co(){return!0}Gt(Zb,Vc){if("QueryPolicyLabel"!==
Zb)return!1;if(this.Mqa())return Vc.Visible=!1,!0;!ib.a.Gh(Vc.LabelText)&&ce.a.Gp()&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(wc.a.O8b,Vc.Alt))},0);Vc.Visible=!0;return 32===w.AFrameworkApplication.dc.Le(ya.a.bfb,2,Vc)}dispose(){this.statusBarManager&&(this.statusBarManager.pH(this),this.statusBarManager=null);this.s9.zUb();this.g6c=!1;this.St.eAj(this.vjg);this.St.fAj(this.GRf);this.$.ea.hx(this.Wma);if(this.fa.ra("SupportsOfficeClientCoauthoring")){const Zb=
this.$.da.Ba(292);Zb&&Zb.Yyj(this.YNf)}this.St.zxj(this.Fwe);this.St.Qzj(this.S3f);this.St.gzj(this.uDf);this.St.qAj(this.yrg);this.St.Ayj(this.jXe);this.Wba&&(this.Wba.dispose(),this.Wba=null);super.dispose()}get title(){return this.Dq}get sxc(){return this.yoe}get linkText(){return this.sia}get l9i(){return this.pne}get labelId(){return this.oHa}j5c(Zb,Vc){if(!this.fa.ra("SupportsPolicies"))return e.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.ZMd)return e.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(pb.a.Gh(Zb))return!1;this.Wba||this.Ztd();return this.Wba.j5c(Zb,Vc)}XA(){this.raiseEvent("LabelInfoChangedKey")}a5h(){Pa.a.get_instance().Fj(10,()=>{this.St.phc()})}ojj(){Pa.a.get_instance().Fj(10,()=>{this.St.F4b(this.g7d);this.St.rXg(this.KMf);this.St.qXg(this.KMf);this.St.g3c(this.vjg);this.St.ize(this.GRf);this.$.ea.wv(this.Wma);this.St.Gxe(this.Fwe);this.St.$ye(this.S3f);
this.St.cYg(this.uDf);this.St.DZg(this.yrg);if(this.fa.ra("SupportsOfficeClientCoauthoring")){const Zb=this.$.da.Ba(292);Zb&&Zb.TXg(this.YNf)}e.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler");this.St.oXg(this.jXe);this.ERh()});this.$.LYd("sensitivity",!0)}ERh(){this.fa.ra("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.NAb():this.e0h(this.$.xa.DocumentHostInfo.TenantId)}Ztd(){this.Wba=
new yb(this.s9,this.St,this.$,this.fa,this.aca)}w2f(Zb){if(!this.fa.ra("SupportsPolicies"))return e.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.Wba||this.Ztd();return this.Wba.K9(Zb)}k5c(Zb,Vc){if(!this.fa.ra("SupportsPolicies"))return e.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,p$a:!1};if(!this.ZMd)return e.ULS.sendTraceTag(537154516,
306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,p$a:!0};this.Wba||this.Ztd();return this.Wba.k5c(Zb,Vc)}e0h(Zb){e.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Zb.length}`);const Vc=this.$.qa.va.Lc();gc(this.$.qa.va,Zb,Nc=>{this.T3j(Nc)},null,null,null,Vc)}T3j(Zb){e.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
Zb&&!Ka.a(Zb)&&(this.oHa=Zb.Result);this.NAb();this.labelId?e.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):e.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}NAb(){this.St.vmd(this.labelId,void 0,void 0,!1)}t2e(){if(!this.g6c){this.$.ig();this.g6c=!0;this.aca.pif();const Zb={};Zb.hasLabel=!!this.labelId&&0<this.labelId.length;Zb.isProtectedFile=this.fa.ra("ProtectedFile");Zb.SupportsPolicies=
this.fa.ra("SupportsPolicies");Zb.AreLabelsAvailableForDisplay=this.St.Kja();Zb.SupportsOfficeClientCoauthoring=this.fa.ra("SupportsOfficeClientCoauthoring");Zb.IsAnonymousUser=this.fa.ra("IsAnonymousUser");e.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Zb)}`)}}b2g(){this.s9.c2g(this.WAa);this.WAa=null}Qoi(Zb){for(const Vc of Zb.LabelActions)if(ib.a.equals(Vc.Name,"ApplyWatermark",!1))return!0;return!1}nXj(Zb){Zb?(new Ed(this.$)).ah():e.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Zb,
Vc,Nc,ld){const yd=ja.c(this.St.Pn);if(void 0===Zb||null===Zb)Zb="";const sd=new ka;sd.rxc=Zb;sd.Ybg=ld;sd.EN=Vc;const ic=this.$.qa.va;Xa.a(this.$.userOperationManager,(Ic,kd,Hd)=>Xb(ic,yd,Zb,this.$.xa.DocumentHostInfo.TenantId,Vc,Nc,Ra.b.call(null,this.d1i,Ic),null,Hd,sd),Ic=>new Ca.a(222,0,Ic),null);this.kKc=!1;this.jXd=null}Mqa(){const Zb=this.$.da.Ba(478);return this.Xo&&Zb?Zb.Xo():!1}}Object(b.a)(ed,"PolicyManagerWrapper",qa.a,[204,205,665]);var md=a(72);class Yd extends Db.a{constructor(Zb){super();
this.$=Zb;this.uc()}create(){const Zb=Object(md.b)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?Object(eb.d)(Kd.a.resolve(oc.h,{Wa:this.La})):sa.GetServiceTaskFactory.Za(this.$.da,5,4,this.La),Vc=w.AFrameworkApplication.qe,Nc=w.AFrameworkApplication.fa;Ha.TaskExtensions.za(Zb,()=>{try{const ld=new Qa.a(()=>new qb(Nc,Vc,w.AFrameworkApplication.sa.qF,this.$.xa.MaxGetPolicyRetries,aa.a.instance.Dc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),yd=new Qa.a(()=>new xa(w.AFrameworkApplication.dc,
w.AFrameworkApplication.sa,w.AFrameworkApplication.fa,ld));let sd=this.$.da.Ba(274);sd||(sd=new ed(ld.value,yd.value,Zb.result,this.$,w.AFrameworkApplication.fa),this.$.da.Ja(274,sd),sd.initialize());this.$b(sd)}catch(ld){throw e.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${ld.toString()}]`),ld;}},this.ka,3)}static la(Zb){Zb.da.Ja(275,new Yd(Zb))}}Object(b.a)(Yd,"PolicyManagerFactory",Db.a,[]);var $d=a(724),bd=a(118),Vd=a(199);let De=class{constructor(Zb){this.$=
Zb}yd(){return!1}executeCommand(Zb,Vc,Nc){switch(Vc.command){case ya.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(Nc[L.a4c]=this.$.workbookContext.ExclusiveLockId),Zb=w.AFrameworkApplication.dc.Le(ya.a.setSensitivity,2,Nc),la.Task.Ua(32===Zb);case ya.a.z9:return Zb=w.AFrameworkApplication.dc.Le(ya.a.z9,2,Nc),la.Task.Ua(32===Zb);case ya.a.A9:return Zb=w.AFrameworkApplication.dc.Le(ya.a.A9,2,Nc),la.Task.Ua(32===Zb);default:return Vd.a(Vc.command)}}fd(Zb,Vc){switch(Vc.command){case ya.a.setSensitivity:case ya.a.z9:case ya.a.A9:return!0;
default:return!1}}Cd(Zb,Vc,Nc){switch(Vc){case "PopulateSensitivityFlyout":return 32===w.AFrameworkApplication.dc.Le(ya.a.jCa,2,Nc);default:return!1}}};De=Object(bd.b)([Object(Kd.d)(oc.sb),Object(bd.c)(0,Object(oc.E)())],De);Object(b.a)(De,"SensitivityCommandHandler",null,[210]);class Pe extends $d.a{constructor(Zb){super(Zb)}ue(){this.Zd([new De(this.$)])}static la(Zb){$d.a.Ie(316,new Pe(Zb))}}Object(b.a)(Pe,"SensitivityCommandHandlerFactory",$d.a,[]);Type.registerNamespace("Common.App.Policy");
Tb.main();(()=>{Jb.a.Fa(Zb=>{Yd.la(Zb);Vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateServices4",!1)||Pe.la(Zb)})})();String(c);window.___1684780685198_closurehack=c}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.policy.js.map/4924e341fd731fb32e0e785104f6b0ee/EwaDSOpt.policy.js.map