'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[27],{1030:function(r,C,a){a.d(C,"a",function(){return e});r=a(0);var c=a(179);C=a(894);var b=a(757);class e extends C.a{constructor(f,d){super(f,d);d!==b.a.ZK&&this.$Q(d);this.a_(e.iterateNext);this.a_(e.lAa);this.m1a(c.a.cYa);this.m1a(c.a.dYa);this.m1a(c.a.$_)}}e.iterateNext="IterateNext";e.lAa="IteratePrevious";e.aUb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount="SetTotalChangesCount";
e.NSa="OnVHDiffReady";Object(r.a)(e,"VersionHistoryMessenger",C.a,[])},1325:function(r,C,a){r=a(0);var c=a(15),b=a(64),e=a(771),f=a(126),d=a(9),h=a(218),l=a(74),k=a(47),u=a(201),v=a(129),x=a(231),w=a(1),m=a(12),t=a(107),z=a(16),y=a(248),D=a(19),H=a(354);class F{constructor(I,S,J){this.XIa=I;this.ol=S;this.d8d=J}}Object(r.a)(F,"UserActivityLocation",null,[]);var G=a(1030),L=a(59);const M=(I,S,J,K,R,Z=null)=>{Z=I.Pa(1,Z);return L.g(I,"GetVersionHistoryHighlightActivitiesData",Z,S,J,K,R,4)};var O=a(757),
B=a(63);a.d(C,"a",function(){return E});class E{constructor(I,S,J,K){this.authorColor=this.N4=this.wha=null;this.Cab=!1;this.Z4a=-1;this.mcd=0;this.OLa=100;this.i8=-1;this.K8d=null;this.Ptb=d.a.mkk;this.hdd=d.a.nkk;this.HJb=!1;this.w4h=()=>({DisplayName:d.a.okk,Email:null,Id:null,Provider:null});this.ei=R=>{(R=x.a(R)?null:R.Result)?R.OperationWaitingForFileDownload?20>this.mcd?(this.OLa*=2,B.Task.delay(this.OLa).continueWith(()=>{this.O5d()})):(this.QJc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
R.ActivityList?(this.initialize(R.ActivityList,R.VersionAuthors),w.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.NSa():this.rSb(!0),this.K8d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.K8d.vd.toString()}`)):(this.QJc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.OLa*=2,B.Task.delay(this.OLa).continueWith(()=>
{this.O5d()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.WBa=()=>{this.QJc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.PAd=R=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${R.MessageId}`);switch(R.MessageId){case G.a.iterateNext:this.iterateNext();this.i8=(this.i8+1)%this.YP.length;
this.AQb(G.a.setCurrentChangeCount,this.i8+1);break;case G.a.lAa:this.lAa();this.i8=0>this.i8?0:this.i8;this.i8=(this.i8+this.YP.length-1)%this.YP.length;this.AQb(G.a.setCurrentChangeCount,this.i8+1);break;case G.a.aUb:this.rSb(R.Values.ToggleValue)}};this.aih=(R,Z)=>this.H9b(R.ol,Z.ol);this.Zhh=(R,Z)=>this.H9b(R.ol,Z);this.Od=()=>{w.EwaSettings.isChangeGateEnabled("OfficeVSO:7487107_XlOnlineVHRemovingDeselectOnSelectionChanged")||this.Bbc()};this.Go=()=>{this.Bbc()};this.Ui=()=>{this.Bbc()};c.ULS.sendTraceTag(537150411,
0,50,"VersionHistoryHighlightManager::Constructor.");this.$=I;this.ariaLiveNotifier=K;this.gridView=D.h(this.$);this.gridView.ga.yp(this.Od);this.gridView.TF(this.Go);this.gridView.Gc.ro(this.Ui);this.kfk();this.HJb=w.EwaSettings.isChangeGateEnabled("OfficeVSO:7468185_XlOnlineVHNewIterationAlgorithm");S&&(this.K8d=I.yc.Fd("UserAction","VersionHistoryDiffManagerStopWatch"),this.O5d());if(this.Mt=J)I=b.a.ML(this.$.xa.VersionHistoryActionUrl)||O.a.ZK,I!==O.a.ZK&&this.Mt.$Q(I),this.Mt.wn(G.a.iterateNext),
this.Mt.wn(G.a.lAa),this.Mt.wn(G.a.aUb),this.Mt.ql(G.a.iterateNext,this.PAd),this.Mt.ql(G.a.lAa,this.PAd),this.Mt.ql(G.a.aUb,this.PAd)}get Kkb(){return this.N4}get wQb(){return-1===this.Z4a?null:this.YP[this.Z4a]}get YP(){this.Cab||(this.wha.sort(this.aih),this.Cab=!0);return this.wha}dispose(){this.RCa();this.wha=this.N4=null;this.gridView&&(this.gridView.ga&&this.gridView.ga.Rp(this.Od),this.gridView.qH(this.Go),this.gridView.Gc&&this.gridView.Gc.io(this.Ui),this.Mt&&(this.Mt.s3(G.a.lAa),this.Mt.s3(G.a.iterateNext),
this.Mt.s3(G.a.aUb)))}initialize(I,S){I?(this.RCa(),this.Z4a=-1,this.wha=[],this.Cab=!1,this.N4={},this.authorColor={},this.pUi(S),this.Xbd(I)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}O5d(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.mcd.toString()} --${this.OLa.toString()}`);this.mcd++;this.$.userOperationManager.Bd(new u.a(537,0,(I,S,J)=>M(this.$.qa.va,
y.b(I,this.ei),y.a(S,this.WBa),J,null),80),null)}rSb(I){const S=this.N4;for(let K in S){var J=K;const R=S[K];R?R.tSb(I):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+J+"view was Null")}}RCa(){const I=this.N4;for(let J in I){var S=J;const K=I[J];K?K.LRd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+S+"view was Null")}this.wha=this.N4=null}Zag(I){let S;if(this.HJb)S=I?this.jcf(this.i8):this.ndf(this.i8),I=
this.YP[S];else if(!({lmf:S,Evg:I}=this.$$h(I,this.Z4a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!I,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.Bbc();if(I.XIa.toString()in this.N4){this.N4[I.XIa.toString()].nJj(I.ol);var J=k.E(I.ol);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(z.a.instance.Xb(158),S+1,this.YP.length,J.vz(!1),I.d8d.DisplayName));this.Z4a=S}else c.ULS.shipAssertTag(537150401,
0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${I.XIa.toString()} view not present in views dictionary`)}AQb(I,S){if(w.EwaSettings.ya(279))if(this.Mt){var J={};J.count=S;I=new e.a(I);I.Values=J;this.Mt.send(I)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}$$h(I,
S){let J,K=!1;J=null;let R=0;for(;!K&&R<this.YP.length;){S=I?this.jcf(S):this.ndf(S);J=this.YP[S];const Z=Object(f.a)(t.a,this.$.ua.getItemByName(J.ol.SheetName));if(!Z)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,lmf:S,Evg:J};Z.visible&&(K=!0);R++}return{returnValue:K,lmf:S,Evg:J}}jcf(I){return this.HJb||-1!==I?(I+1)%this.YP.length:this.dcf()}ndf(I){this.HJb&&
-1===I?I=0:-1===I&&(I=this.dcf());return I=(I+this.YP.length-1)%this.YP.length}Xbd(I){this.Qsh(I);this.Cbd()}Phi(I,S){const J=[];if(!I.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),J;for(const K of I.RangeList)if(!K||!this.$.ua.Pk(K.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+K.SheetName);else if(!this.HJb||this.$.ua.getItemByName(K.SheetName).visible)I=
new F(0,K,S),J.push(I);return J}Qsh(I){for(const S of I)if(!S||v.e(S.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const J of S.LocationList)if(J)switch(J.Type){case 0:this.wha.push(...this.Phi(J,S.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}Cbd(){var I=
{};const S=[];for(const J of this.wha){if(0!==J.XIa)continue;const K=new H.a(k.E(J.ol),l.d(this.$.ua.getItemByName(J.ol.SheetName))),R=E.xEc(K);R in I||S.push(K);I[R]=this.J2h(J.d8d);I[R]===this.hdd&&this.thk(J)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.wha.length}, Highlightable activities: ${S.length},Total userlist in activities : ${this.wha.length}, Total userlist from pane: ${S.length} `);this.QJc();0<S.length&&(I=new (a(1437).RangeVersionHistoryHighlightView)(this.$,
S,I,this.Ptb),this.N4["0"]=I)}thk(I){w.EwaSettings.isChangeGateEnabled("OfficeVSO:7213684_NarratorReadsAuthorNameForChangesWithoutUserAttributionDuringIteration")&&(I.d8d=this.w4h())}QJc(){const I=this.wha?this.YP.length:0;this.AQb(G.a.setCurrentChangeCount,0);this.AQb(G.a.setTotalChangesCount,I)}NSa(){this.AQb(G.a.NSa,0)}pUi(I){if(I)for(let R=0;R<I.length;++R)if(w.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!I[R].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,
"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");else{var S=I[R].EmailAddress;var J=I[R].UserName;var K=null;if(I[R].LoginName){const Z=I[R].LoginName.split("|");3===Z.length&&(K=Z[2])}K?this.authorColor[K]=I[R].InitialsColor:S?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[S]=I[R].InitialsColor):J?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),
this.authorColor[J]=I[R].InitialsColor):c.ULS.sendTraceTag(537150359,0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}kfk(){if(this.$.xa.VersionHistoryHighlightsSettings){var I=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.xa.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.xa.VersionHistoryHighlightsSettings):
null;for(let J=0;J<I.length;J++){var S=I[J];const K=S.key?S.key:S.Key?S.Key:"";S=S.value?S.value:S.Value?S.Value:"";"DefaultColor"===K?this.hdd=S:"InitialTint"===K?this.Ptb=S:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}J2h(I){if(I.Email in this.authorColor)return this.authorColor[I.Email];if(I.DisplayName in
this.authorColor)return this.authorColor[I.DisplayName];c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.hdd}H9b(I,S){var J=Object(f.a)(t.a,this.$.ua.getItemByName(I.SheetName));const K=Object(f.a)(t.a,this.$.ua.getItemByName(S.SheetName));return J&&K?(J=(J=m.HelperMethods.eH(J.index,K.index))||m.HelperMethods.eH(I.FirstRow,S.FirstRow))||m.HelperMethods.eH(I.FirstColumn,S.FirstColumn):(c.ULS.sendTraceTag(537150355,
0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),0)}dcf(){var I=k.m(this.gridView.ga.pa.activeRange,this.$.ua.na);if(!I)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;I=m.HelperMethods.Ry(new h.a(this.YP),0,this.YP.length,I,this.Zhh);0>I&&(I=~I);return I%this.YP.length}Bbc(){if(this.wQb){if(!(this.wQb.XIa.toString()in this.N4)){c.ULS.shipAssertTag(537150353,0,!1,
`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.wQb.XIa.toString()} view not present in views dictionary`);return}this.N4[this.wQb.XIa.toString()].Cwh(this.wQb.ol)}this.Z4a=-1}iterateNext(){this.Zag(!0)}lAa(){this.Zag(!1)}static xEc(I){return`${I.range}${I.sheetId}`}}Object(r.a)(E,"VersionHistoryHighlightManager",null,[733,2])},1437:function(r,C,a){a.r(C);r=a(0);var c=a(15),b=a(9);class e{}e.iLh="ewa-vhr-rectinnerborder";Object(r.a)(e,"CssClassNames",null,[]);var f=a(74),d=
a(47),h=a(209),l=a(19),k=a(354),u=a(1325);a.d(C,"RangeVersionHistoryHighlightView",function(){return v});class v{constructor(x,w,m,t){this.wnb=null;this.$=x;this.fOg=w;this.QVa=m;this.RVa={};this.Ptb=t;this.xvi()}get HG(){return[v.r7]}get pc(){return this.wnb||(this.wnb=l.h(this.$).pc)}tSb(x){x?this.pc.fs(this.HG):this.pc.Sk(this.HG)}LRd(){this.tSb(!1);this.pc.BVa(new k.a(null,f.d(this.$.na)),this.HG)}nJj(x){if(this.QVa){var w=new k.a(d.E(x),f.d(this.$.ua.getItemByName(x.SheetName))),m=u.a.xEc(w);
if(m in this.QVa)if(m in this.RVa){w=h.a.mq(this.QVa[m]);m=this.RVa[m];for(let t in m)m[t].style.backgroundColor=`rgba(${w.r},${w.g},${w.b},${b.a.pkk})`;l.h(this.$).ga.Sa.LI(null);l.h(this.$).Ygf(x,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+m);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+
m)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Cwh(x){x=new k.a(d.E(x),f.d(this.$.ua.getItemByName(x.SheetName)));var w=u.a.xEc(x);if(w in this.RVa)if(w in this.QVa){x=h.a.mq(this.QVa[w]);w=this.RVa[w];for(let m in w)w[m].style.backgroundColor=`rgba(${x.r},${x.g},${x.b},${this.Ptb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+w);else c.ULS.sendTraceTag(537150425,
0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+w)}xvi(){this.pc.oB(this.fOg,[v.r7],!1,(x,w)=>{if(x&&x.range&&x.sheetId&&w){var m=new k.a(x.range,x.sheetId);m=u.a.xEc(m);m in this.RVa||(this.RVa[m]={});this.RVa[m][x.paneType.toString()]=w;m in this.QVa?(x=this.QVa[m],m=h.a.mq(x),w.style.borderColor=x,w.style.backgroundColor=`rgba(${m.r},${m.g},${m.b},${this.Ptb})`,x=document.createElement("div"),x.className=e.iLh,w.appendChild(x)):c.ULS.sendTraceTag(537150419,
0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+m)}else c.ULS.shipAssertTag(537150423,0,!!x,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!x||!!x.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!x||!!x.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,
0,!!w,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}v.r7=23;Object(r.a)(v,"RangeVersionHistoryHighlightView",null,[769])},1513:function(r,C,a){a.r(C);var c=a(10),b=a(0),e=a(6),f=a(230),d=a(15),h=a(123),l=a(128),k=a(43);class u extends h.a{constructor(Ya,Qb,Ec,id,Bd){super(Ya,Qb);this.executionContext=null;this.retryCount=0;this.Vaj=Id=>{({TUd:Id}=this.lak(Id)).returnValue?Id.Success?(l.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):
(l.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Id.Output}`),this.hi(this.BL)):(l.c(2138207060,!1),this.hi(this.BL));(Id=this.executionContext.activityState[u.NDd])&&Id();this.uq();this.executionContext.SN()};this.Uaj=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.F8f();
else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");l.c(2138207060,!1);this.hi(this.BL);var Id=this.executionContext.activityState[u.NDd];Id&&Id();this.uq();this.executionContext.SN()}};this.BL=Ec;this.K5=id;this.baseUrl=Bd}execute(Ya){this.executionContext=Ya;this.retryCount=3;this.F8f();return 1}F8f(){var Ya=this.executionContext.activityState[u.pyc];const Qb=`${this.baseUrl}${"restoreversion.ashx"}`,Ec={};Ec.VersionId=this.executionContext.activityState[u.Jwg];
Ec.QuerySignature=Ya;Ya=k.c(Ec);this.K5.Sn(Qb,2,Ya,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.Vaj,this.Uaj,null)}lak(Ya){let Qb;Qb=null;Ya=Ya?Ya.data?Ya.data.Pe:null:null;return Ya&&Ya.length?({Bt:Qb}=k.d(Ya)).returnValue?{returnValue:!0,TUd:Qb}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,TUd:Qb}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),
{returnValue:!1,TUd:Qb})}}u.Jwg="RVAvi";u.pyc="RVAqs";u.NDd="RVlvrt";Object(b.a)(u,"RestoreVersionActivity",h.a,[]);var v=a(8);class x extends f.a{constructor(Ya,Qb,Ec){super();this.activityName=Ya;this.uL=Qb;this.BL=Ec;this.uc()}create(){this.$b(new u(this.activityName,this.uL,this.BL,e.AFrameworkApplication.qe,e.AFrameworkApplication.sa.Qa.L1))}static la(Ya){Ya.da.Ja(320,new x(v.a.WUd,v.a.Mj,v.a.XUd))}}Object(b.a)(x,"RestoreVersionActivityFactory",f.a,[]);class w extends h.a{constructor(Ya,Qb){super(Ya,
Qb)}execute(Ya){(0,Ya.activityState[w.ujg])(()=>{this.uq();Ya.SN()});return 1}}w.ujg="RVEAssea";Object(b.a)(w,"RestoreVersionErrorActivity",h.a,[]);class m extends f.a{constructor(Ya,Qb){super();this.activityName=Ya;this.uL=Qb;this.uc()}create(){this.$b(new w(this.activityName,this.uL))}static la(Ya){Ya.da.Ja(321,new m(v.a.XUd,v.a.Mj))}}Object(b.a)(m,"RestoreVersionErrorActivityFactory",f.a,[]);var t=a(64),z=a(724),y=a(52),D=a(40),H=a(199),F=a(383),G=a(63);class L{constructor(Ya,Qb){this.$=Ya;this.skk=
Qb}yd(){return e.AFrameworkApplication.fa.ra("IsAnonymousUser")?(d.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Ya,Qb){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Ya=!1;switch(Qb.command){case -1112508866:F.a(this.$)&&this.$.da.Ba(423).uFc(!1),Ya=this.skk.$Zj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Ya}.`);return Ya?G.Task.Ua(Ya):H.a(Qb.command)}fd(Ya,
Qb){return-1112508866===Qb.command&&this.$.isVersionHistoryEnabled()}Cd(){return!1}}Object(b.a)(L,"VersionHistoryCommandHandler",null,[210]);var M=a(2),O=a(265),B=a(179),E=a(481);class I{static addAppPLTEventToLog(Ya){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Ya)}catch(Qb){}}static setIsPageLoadForFirstTime(Ya){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Ya)}catch(Qb){}}}Object(b.a)(I,"VersionHistoryLogConnector",null,[]);var S=a(31),
J=a(771),K=a(894),R=a(167),Z=a(91),P=a(34),V=a(1),Ea=a(50),oa=a(263),ea=a(1030),aa=a(273),ia=a(260),ya=a(13);class za{constructor(Ya){this.my=Ya}Zi(){aa.a(this.my.$).Ux(this.Qe)||aa.a(this.my.$).Zi(this)}R$(){aa.a(this.my.$).Ux(this.Qe)&&aa.a(this.my.$).gB(this)}get Qe(){return ia.a.Gwg}get Wc(){return document.querySelector('[id="vhHeader"]')}get Fg(){return!0}ui(Ya){return ya.DOMElementExtensions.zg(this.Wc,Ya)}pk(){this.my.$.frame.Hf.gl(this.my.$.frame.Hf.rG)}Rk(){}$g(Ya,Qb){Qb||this.my.tUb.then(Ec=>
{Ec.enterHeaderFocusTrapZone();return null});return!Qb}}Object(b.a)(za,"VersionHistoryHeader",null,[26]);class la{constructor(Ya){this.my=Ya}Zi(){aa.a(this.my.$).Ux(this.Qe)||aa.a(this.my.$).Zi(this)}R$(){aa.a(this.my.$).Ux(this.Qe)&&aa.a(this.my.$).gB(this)}get Qe(){return ia.a.Hwg}get Wc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Fg(){return!0}ui(Ya){return ya.DOMElementExtensions.zg(this.Wc,Ya)}pk(){this.my.$.frame.Hf.gl(this.my.$.frame.Hf.rG)}Rk(){}$g(Ya,Qb){Qb||
this.my.tUb.then(Ec=>{Ec.enterFocusTrapZone();return null});return!Qb}}Object(b.a)(la,"VersionHistoryPane",null,[26]);class xa{constructor(Ya){this.my=Ya}Zi(){aa.a(this.my.$).Ux(this.Qe)||aa.a(this.my.$).Zi(this)}R$(){aa.a(this.my.$).Ux(this.Qe)&&aa.a(this.my.$).gB(this)}get Qe(){return ia.a.Iwg}get Wc(){return document.querySelector('[id="vhViewer"]')}get Fg(){return!0}ui(Ya){return ya.DOMElementExtensions.zg(this.Wc,Ya)}pk(){this.my.$.frame.Hf.gl(this.my.$.frame.Hf.rG)}Rk(){}$g(Ya,Qb){Qb||this.my.tUb.then(Ec=>
{Ec.enterViewerFocusTrapZone();return null});return!Qb}}Object(b.a)(xa,"VersionHistoryViewer",null,[26]);var wa=a(157),hb=a(266),Ja=a(77),Fa=a(530),Ba=a(757);class fa{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(fa,"AppBootSettings",null,[]);class ta{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ta,"AppVersionControllerFactoryParameters",null,[]);class Oa{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=
null}}Object(b.a)(Oa,"OnVersionSelectedParams",null,[]);class Ma{constructor(){this.appName=0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=
!1;this.wdDisableSPOFileCache=this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}Object(b.a)(Ma,"AppSettings",null,[]);class fb{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(fb,"ControllerFactoryParameters",null,[]);var pa;(function(Ya){Ya[Ya.none=0]="none";Ya[Ya.vhUnknown=1]="vhUnknown";Ya[Ya.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Ya[Ya.vhFailedToGetDownloadToken=
101]="vhFailedToGetDownloadToken";Ya[Ya.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";Ya[Ya.vhFetchFailed=103]="vhFetchFailed";Ya[Ya.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Ya[Ya.vhFileNotFound=105]="vhFileNotFound";Ya[Ya.vhVersionTooOld=106]="vhVersionTooOld";Ya[Ya.vhFetchException=107]="vhFetchException";Ya[Ya.vhServiceUnavailable=108]="vhServiceUnavailable";Ya[Ya.vhBadGateway=109]="vhBadGateway";Ya[Ya.vhUnauthorized=110]="vhUnauthorized";Ya[Ya.vhInternalServerError=
111]="vhInternalServerError";Ya[Ya.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Ya[Ya.vhFailedHostDownload=113]="vhFailedHostDownload";Ya[Ya.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Ya[Ya.vhFailedToCacheParts=115]="vhFailedToCacheParts";Ya[Ya.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Ya[Ya.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Ya[Ya.vhInvalidDocID=118]="vhInvalidDocID";Ya[Ya.vhMissingDocID=119]="vhMissingDocID";
Ya[Ya.vhNullDocID=120]="vhNullDocID";Ya[Ya.vhNullHashedDocID=121]="vhNullHashedDocID";Ya[Ya.vhNullGetDownloadAccessTokenRequest=122]="vhNullGetDownloadAccessTokenRequest";Ya[Ya.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Ya[Ya.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Ya[Ya.vhGetTipVersionException=125]="vhGetTipVersionException";Ya[Ya.vhGetVersionsException=126]="vhGetVersionsException";Ya[Ya.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";
Ya[Ya.vhFetchRetryException=128]="vhFetchRetryException";Ya[Ya.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";Ya[Ya.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Ya[Ya.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Ya[Ya.vhXhrException=132]="vhXhrException";Ya[Ya.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Ya[Ya.vhFileGone=134]="vhFileGone";Ya[Ya.vhNullRevisionIDs=135]="vhNullRevisionIDs";Ya[Ya.vhRequestDeleteVersionsException=
136]="vhRequestDeleteVersionsException";Ya[Ya.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";Ya[Ya.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(pa||(pa={}));Object(b.b)("VersionHistoryFullAppErrorCode",pa);var Ua=a(313);class Sa{constructor(Ya){this.baseVersionInfo=this.i6=this.Wra=this.um=this.ewaAccessibilityManager=this.tUb=null;this.uRd=this.zGf=!1;this.ARe=!0;this.dialog=this.accessTokenExpirationManager=this.bA=this.Z4e=
this.iF=this.N8d=this.L8d=this.M8d=null;this.yQf=Qb=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.LWj()){var Ec=Bd=>{l.c(2138207060,!1);this.um.setRestoreFailedAtServer(Bd)};this.iF&&this.iF.startTimer(Sa.Log);var id=()=>{this.iF.endTimer(Sa.Log);this.rIe(this.iF)};this.um.setRestoreInProgress();Ea.a(this.$).Ys(new oa.a(v.a.Qx,5,()=>{const Bd=Ja.a(this.$).$d.activityState;Bd[hb.a.Fq]=v.a.fLe;Bd[wa.a.$Z]=!0;Bd[wa.a.$U]=0;Bd[u.Jwg]=
Qb;Bd[u.pyc]=e.AFrameworkApplication.oj;Bd[u.NDd]=id;Bd[w.ujg]=Ec;V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",!1)&&(Bd[Ua.a.pwc]=!0)}))}else l.c(2138207060,!1)};this.kTf=Qb=>{this.tUb.then(Ec=>{Ec.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.iF.endTimer(Sa.m4d);this.iF.incrementCounter(Sa.Ilh);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.iF.getTimerDuration(Sa.m4d)}`);
this.ZCj(Qb.containerDiv);Qb.versions&&0<Qb.versions.length&&(this.Z4e=Sa.EG(Qb.versions[Qb.versions.length-1]));this.i6&&this.Wra&&this.FWd(this.i6);d.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=Qb=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${Sa.EG(Qb.currentVersion)}, LastSelected:${Sa.EG(this.i6)}`);this.iF.incrementCounter(Sa.Hlh);this.i6=Qb.currentVersion;this.baseVersionInfo=Qb.baseVersion;
this.zGf=Qb.noBaseToCompareTo;this.Wra&&this.Ejk()&&(this.FWd(Qb.currentVersion),d.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.VKf=Qb=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===Qb||void 0===Qb?0:Qb.versionSelected)?Sa.EG(Qb.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===Qb||void 0===Qb?0:Qb.updatedVersions)?Qb.updatedVersions.length:0}, LastSelected:${Sa.EG(this.i6)}`);
this.iF.incrementCounter(Sa.Glh);if(this.baseVersionInfo){if((null===Qb||void 0===Qb?0:Qb.updatedVersions)&&2<=Qb.updatedVersions.length){let Ec=null,id=null;const Bd=Sa.EG(this.i6),Id=Sa.EG(this.baseVersionInfo);for(const ee of Qb.updatedVersions)if(Qb=Sa.EG(ee),Bd===Qb?Ec=ee:Id===Qb&&(id=ee),Ec&&id)break;Ec&&id?(this.i6=Ec,this.baseVersionInfo=id,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${Sa.EG(this.i6)}, RevisionID[N-1]: ${Sa.EG(this.baseVersionInfo)}.`),
this.FWd(this.i6)):d.ULS.sendTraceTag(537150306,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Bd}, RevisionID[N-1]: ${Id}.`)}else d.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,
0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};this.TJf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.dgh();const Qb=new Z.a(1470556788,0,this.$.Tc,0,null);this.$.Ia.mc(Qb)};this.PQf=Qb=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let Ec=new Z.a(-1244760097,0,this.$.Tc,0,null);this.$.Xe.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),
Ec=new Z.a(-309686558,0,this.$.Tc,0,null));l.c(1604651619,!0);this.$.Ia.mc(Ec,{["FileDownloadUrl"]:Qb})};this.WKf=Qb=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!V.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.KWj())Qb=new O.QueryStringBuilder(Qb),Qb.Tj("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+Qb.toString().length),8===this.$.frame.wcb(Qb.toString(),
!0)?(d.ULS.sendTraceTag(587830283,0,10,"VersionHistoryPaneActor:OnDownloadVersion failed"),l.c(1316171850,!1)):l.c(1316171850,!0)};this.xIf=Qb=>{this.um.setFullAppErrorCode(Qb);V.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&this.um.setViewerError(!0)};this.DDe=Qb=>{const Ec=document.getElementById(Sa.e2e);!Ec||this.bA&&!Qb||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.bA=new ea.a(Ec.contentWindow,
t.a.ML(this.$.xa.VersionHistoryActionUrl)||Ba.a.ZK),this.bA.ql(B.a.cYa,this.zfb),this.bA.ql(B.a.dYa,this.zfb),this.bA.ql(B.a.$_,this.zfb),this.bA.wn(ea.a.setCurrentChangeCount),this.bA.wn(ea.a.setTotalChangesCount),V.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.bA.wn(ea.a.NSa),this.bA.ql(ea.a.setCurrentChangeCount,this.zfb),this.bA.ql(ea.a.setTotalChangesCount,this.zfb),V.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.bA.ql(ea.a.NSa,this.zfb))};this.nMf=Qb=>{if(V.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))Qb=pa[Qb]?pa[Qb]:"None";else switch(Qb){case 101:Qb="VHFailedToGetDownloadToken";break;case 100:Qb="VHFailedToLoadVersionList";break;case 104:Qb="VHVersioningNotEnabled";break;case 105:Qb="VHFileNotFound";break;case 106:Qb="VHVersionTooOld";break;default:Qb="None"}this.iF.addEvent("OnFullAppError",Qb);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${Qb}`)};
this.YKd=Qb=>{this.ARe=Qb;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${Qb.toString()}`);this.aXd(ea.a.aUb,{["ToggleValue"]:Qb})};this.PNf=Qb=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${Qb}`);l.c(1488635506,!0);const Ec={};Qb?this.aXd(ea.a.iterateNext,Ec):this.aXd(ea.a.lAa,Ec)};this.zfb=Qb=>{switch(Qb.MessageId){case B.a.cYa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");
V.EwaSettings.ya(370)&&this.um.setVersionLoadComplete();break;case B.a.dYa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case ea.a.setCurrentChangeCount:Qb=Qb.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${Qb}`);this.um.setCurrentChangeCount(Qb);break;case ea.a.setTotalChangesCount:Qb=Qb.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${Qb}`);
this.um.setTotalChangesCount(Qb);break;case ea.a.NSa:this.YKd(this.ARe);break;case B.a.$_:if(!V.EwaSettings.isChangeGateEnabled("OfficeVSO:7402639_ExcelVHAccessTokenExpiredRefreshFix"))break;d.ULS.sendTraceTag(509682466,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession DocumentRefresh");this.A0i();break;default:d.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${Qb.MessageId}`)}};this.$=Ya;this.qec=this.$.qc+Sa.EPh;this.Wsh();V.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&
this.$.da.Qb(38,Qb=>{this.accessTokenExpirationManager=Qb;this.LSa=this.LSa.bind(this);this.accessTokenExpirationManager.psb(this.LSa)});this.CHb="";this.EBd=0;this.perfTelemetryInfos=[]}LSa(){null!=this.um&&(this.um.updateDocId(e.AFrameworkApplication.oj),d.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){V.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.lAc(this.LSa);
this.UJe()}lkj(){this.$.da.Qb(15,Ya=>{this.ewaAccessibilityManager=Ya;this.ewaAccessibilityManager.mode=2})}Wsh(){this.M8d=new la(this);this.L8d=new za(this);this.N8d=new xa(this)}$Zj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");e.AFrameworkApplication.WS("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.WS("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");
e.AFrameworkApplication.NO("8492a557;72ff4572");this.iF=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.iF.startTimer(Sa.Kog);if(!this.um&&(Fa.a(()=>{this.um=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(M.a)(new fb,{ulsLogger:new E.a,docId:e.AFrameworkApplication.oj,appSettings:Object(M.a)(new Ma,{appName:120,userSessionId:e.AFrameworkApplication.userSessionId,wdEnableSaveACopy:!0,wdEnableDownloadTokens:!0,wacCluster:e.AFrameworkApplication.qe.AQ,
uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:V.EwaSettings.ya(281)&&this.$.isEditMode,wdEnableIterator:V.EwaSettings.ya(279),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:V.EwaSettings.ya(370),disableSaveACopy:this.k_d(),wdEnableShowVersionChanges:!0,disabledChangeGates:this.$.xa.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:V.EwaSettings.ya(466),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",
!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.um))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),l.c(429638140,!1),!1;this.a_j();this.iF.endTimer(Sa.Kog);this.iF.startTimer(Sa.Nog);d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");l.c(429638140,!0);return!0}a_j(){var Ya;this.Cvj();if(!document.getElementById(this.qec)){const Qb=
document.createElement("div");Qb.id=this.qec;Qb.style.width="100%";Qb.style.zIndex="998";Qb.style.display="block";Qb.style.position="absolute";if(e.AFrameworkApplication.sa.Qa.$f){const Ec=(null===(Ya=document.getElementById("HeaderRegion"))||void 0===Ya?void 0:Ya.offsetHeight)||0;Qb.style.top=Ec+"px";Qb.style.bottom="0px";Qb.style.height=`calc(100vh - ${Ec}px)`}else Qb.style.height="100%";this.$.Hq.insertBefore(Qb,this.$.Hq.firstChild);this.tUb=this.um.createVersionHistoryDialog(Qb)}document.getElementById(this.qec).style.display=
"block";this.kRd();this.iF.startTimer(Sa.m4d);this.um.getVersions("")}kRd(){this.M8d.Zi();this.L8d.Zi();this.N8d.Zi();this.lkj()}y6d(){this.M8d.R$();this.L8d.R$();this.N8d.R$();this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0)}Cvj(){this.um.getVersionsReadyEvent().addListener(this.kTf);this.um.getVersionSelectedEvent().addListener(this.onVersionSelected);this.um.getCloseSelectedEvent().addListener(this.TJf);this.um.getFullAppErrorEvent().addListener(this.nMf);this.um.getIteratorSelectedEvent().addListener(this.PNf);
this.um.getShowVersionChangesToggledEvent().addListener(this.YKd);this.um.getDownloadTokenReadyEvent().addListener(this.VKf);this.um.getSaveACopySelectedEvent().addListener(this.PQf);this.um.getDownloadVersionSelectedEvent().addListener(this.WKf);V.EwaSettings.ya(281)&&this.$.isEditMode&&(this.um.getRestoreVersionSelectedEvent().addListener(this.yQf),this.uRd=!0)}Dvj(){this.Wra.getAppErrorEvent().addListener(this.xIf)}xj(){this.um.getVersionsReadyEvent().removeListener(this.kTf);this.um.getVersionSelectedEvent().removeListener(this.onVersionSelected);
this.um.getCloseSelectedEvent().removeListener(this.TJf);this.um.getFullAppErrorEvent().removeListener(this.nMf);this.um.getIteratorSelectedEvent().removeListener(this.PNf);this.um.getShowVersionChangesToggledEvent().removeListener(this.YKd);this.um.getSaveACopySelectedEvent().removeListener(this.PQf);this.um.getDownloadVersionSelectedEvent().removeListener(this.WKf);this.um.getDownloadTokenReadyEvent().removeListener(this.VKf);this.uRd&&(this.um.getRestoreVersionSelectedEvent().removeListener(this.yQf),
this.uRd=!1);this.Wra&&this.Wra.getAppErrorEvent().removeListener(this.xIf)}kUj(){return this.k_d()||!e.AFrameworkApplication.b0}KWj(){return this.kUj()?(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),l.c(1316171850,!1),!1):!0}LWj(){let Ya=!0;if(!this.$.ea.amIAlone&&!V.EwaSettings.ya(277)){this.KPi();this.um.setCoauthRestoreError();Ya=!1;const Qb=new Z.a(-729359593,0,this.$.Tc,0,null);this.$.Ia.mc(Qb)}this.$.yS&&(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),
Ya&&(Ya=!1,this.ZZj()));return Ya}ZZj(){var Ya=P.a.Wd(1,0,1903,1902,0,-1603358883,"RestoreVersionUnsavedChangesError");Ya=this.dialog||new R.ErrorDialog(this.$,Ya);Ya.initialize();Ya.ah()}Ejk(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?Sa.EG(this.baseVersionInfo):""}`);if(Sa.EG(this.i6)===this.Z4e)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;
if(V.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.zGf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Ya=Sa.b5h(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Ya?Ya.length:
0}`);return Ya?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}k_d(){return!this.$.Ana}dgh(){document.getElementById(this.qec).style.display="none";const Ya=new Z.a(-1423792966,0,this.$.Tc,0,null);this.$.Ia.mc(Ya);this.UJe()}UJe(){this.iF&&(this.iF.endTimer(Sa.Nog),this.rIe(this.iF),this.iF=null);this.xj();this.y6d();this.perfTelemetryInfos&&(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Ya=>JSON.stringify(Ya)).toString()),
this.perfTelemetryInfos=null);this.bA&&(this.bA.s3(B.a.cYa),this.bA.s3(B.a.dYa),this.bA.s3(ea.a.setCurrentChangeCount),this.bA.s3(ea.a.setTotalChangesCount),this.bA.s3(B.a.$_),V.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.bA.s3(ea.a.NSa),this.bA.dispose(),this.bA=null)}ZCj(Ya){try{this.Wra?(I.setIsPageLoadForFirstTime(!1),V.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(Sa.e2e)&&
(this.Wra.resetContainer(Ya),this.DDe(!0))):(I.setIsPageLoadForFirstTime(!0),Fa.a(()=>{const Qb=new fa;Qb.ulsLogger=new E.a;Qb.actionUrl=this.$.xa.VersionHistoryActionUrl;Qb.hideEmbedFooter=!0;Qb.useFetch=!S.a.Dz;this.Wra=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(M.a)(new ta,{appBootSettings:Qb,rootDiv:Ya}))})),this.Dvj()}catch(Qb){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${Qb}`)}}FWd(Ya){d.ULS.sendTraceTag(537150298,
0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${Sa.EG(Ya)}, LastSelected:${this.CHb}`);if(Ya)if(Sa.EG(Ya).length){var Qb=(new Date).getTime();if(Sa.EG(Ya)===this.CHb&&1E3>Qb-this.EBd)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{Sa.EG(Ya)!==this.CHb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.um.setTotalChangesCount(-1),this.um.setCurrentChangeCount(-1));
var Ec=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Ec.addEvent("SelectVersion",Sa.EG(Ya));try{this.mmk(Ec);this.EBd=Qb;this.CHb=Sa.EG(Ya);const id=new Oa;id.selectedVersionInfo=this.i6;id.baseVersionInfo=this.baseVersionInfo;id.telemetryCollector=Ec;this.Wra.onVersionSelectedWithParams(id);this.um&&this.um.setDisableSaveACopy(this.k_d());this.DDe(!1)}catch(id){this.EBd=0,this.CHb="",Ec.addEvent("Exception",id.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${id}`)}finally{d.ULS.sendTraceTag(537150292,
0,50,Ec?Ec.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}mmk(Ya){for(const Qb of this.perfTelemetryInfos){const Ec=Qb.TelemetryEventKey?Qb.TelemetryEventKey:Qb.telemetryEventKey?Qb.telemetryEventKey:"",id=Qb.TelemetryEventData?Qb.TelemetryEventData:Qb.telemetryEventData?Qb.telemetryEventData:"";Ec&&id&&
Ya.addEvent(Ec,id)}this.perfTelemetryInfos.length=0}rIe(Ya){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Ya?Ya.getJsonForLogging():""} `)}KPi(){const Ya=this.$.ea.Eo,Qb={};let Ec=null;for(const id of Ya)id.UserEmail&&(Qb[id.UserEmail]=id.UserEmail in Qb?Qb[id.UserEmail]+1:1),id.User.UserID===this.$.ea.clientId&&(Ec=id.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Ya.length}, TotalAuthorsAsYourself ${Ec?
Qb[Ec]:-1}`)}A0i(){Ea.a(this.$).Ys(new oa.a(v.a.Qx,5,()=>{const Ya=Ja.a(this.$).$d.activityState;Ya[hb.a.Fq]=v.a.Mj;Ya[Ua.a.pwc]=!0}))}aXd(Ya,Qb){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Ya}`);if(this.bA){Ya=new J.a(Ya);Ya.Values[K.a.$wb]=this.$.xa.UserSessionId;if(Qb)for(let Ec in Qb)Ya.Values[Ec]=Qb[Ec];this.bA.send(Ya)}else d.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static EG(Ya){return Ya?
Ya.RevisionID?Ya.RevisionID:Ya.revisionID?Ya.revisionID:"":""}static b5h(Ya){return Ya?Ya.DownloadUrl?Ya.DownloadUrl:Ya.downloadUrl?Ya.downloadUrl:"":""}}Sa.EPh="_excelVersionHistoryOverlay";Sa.e2e="vhs_frame";Sa.Kog="TimeTakenShowVersionHistoryDialogAction";Sa.Nog="TimeTillVersionHistoryDialogWasOpenMs";Sa.m4d="TimeTakenGetVersionsToOnVersionsReady";Sa.Hlh="CountOnVersionSelectedCalledinOneVHSession";Sa.Ilh="CountOnVersionsReadyCalledinOneVHSession";Sa.Glh="CountOnDownloadTokenReadyCalledinOneVHSession";
Sa.Log="TimeTakenVersionRestore";Object(b.a)(Sa,"VersionHistoryPaneActor",null,[2]);var Ia=a(100),X=a(149),ca=a(35);class U extends z.a{constructor(Ya){super(Ya)}ue(){const Ya=this.SOi(),Qb=y.GetServiceTaskFactory.Za(this.$.da,21,137,this.La);D.TaskExtensions.za(D.TaskExtensions.xe([Ya,Qb],this.ka,3),()=>{var Ec=Qb.result;const id=t.a.ML(this.$.xa.VersionHistoryActionUrl);id!==Ba.a.ZK&&Ec.$Q(id);Ec=new Sa(this.$);this.Zd([new L(this.$,Ec)])},this.ka,3)}SOi(){return Ia.d(X.a.resolve(ca.B,{Wa:this.La}).then(Ya=>
Ya("excelVersionHistory")))}static la(Ya){z.a.Ie(304,new U(Ya))}}Object(b.a)(U,"VersionHistoryCommandHandlerFactory",z.a,[]);var ma=a(1325),ra=a(727);class Va extends f.a{constructor(Ya){super();this.$=Ya;this.uc()}create(){const Ya=y.GetServiceTaskFactory.Za(this.$.da,211,212,this.La),Qb=y.GetServiceTaskFactory.Za(this.$.da,21,137,this.La);D.TaskExtensions.za(D.TaskExtensions.xe([Ya,Qb],this.$.ka),()=>{const Ec=Object(ra.a)(this.$.da,305,()=>new ma.a(this.$,!0,Qb.result,Ya.result));this.$b(Ec)},
this.$.ka,3)}static la(Ya){Ya.da.Ja(306,new Va(Ya))}}Object(b.a)(Va,"VersionHistoryHighlightManagerFactory",f.a,[]);var ob=a(522),ja=a(7),lb=a(177),wb=a(16);class Ab extends h.a{constructor(Ya,Qb,Ec){super(Ya,Qb);this.lineageManager=Ec}execute(Ya){this.lineageManager.lineageHidePreviousHistory();return super.execute(Ya)}}Object(b.a)(Ab,"LineageClearHistoryConfirmedActivity",h.a,[]);var nb=a(17),pb=a(153);class cb{constructor(Ya,Qb){this.$=Ya;this.lineageManager=Qb;Ya=[new nb.a(v.a.tCd,1038647878,
0,0,2244),new nb.a(v.a.idle,1038647878,0,1)];Ja.a(this.$).YQd(new pb.a(v.a.sCd,v.a.idle,Ya),new Ab(v.a.tCd,v.a.idle,Qb))}yd(){return!1}executeCommand(Ya,Qb,Ec){Ya=!1;switch(Qb.command){case 1834994092:9===Qb.Jf&&this.D4j();this.yXj(Qb,Ec);Ya=!0;break;case -409942531:this.AXj(),Ya=!0}return Ya?G.Task.Ua(!0):H.a(Qb.command)}fd(Ya,Qb){return 1834994092===Qb.command||-409942531===Qb.command}Cd(){return!1}yXj(Ya,Qb){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${Qb.MenuItemId||
Ya.Jf}`);this.lineageManager.Pig(19===Ya.Jf&&!!Qb.MenuItemId,Qb.MenuItemId,Ya.Jf,Qb)}D4j(){const Ya=ja.a.Hyc;Ya!==lb.a(this.$).xq.Tz&&lb.a(this.$).xq.activateRibbonTab(Ya)}AXj(){Ea.a(this.$).Ys(new oa.a(v.a.sCd,5,()=>{const Ya=Ja.a(this.$).$d,Qb=P.a.Wd(3,1,2241,2242,2243,1038647878,"LineageConfirmClearHistory");Qb.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";Qb.HelpDescription=wb.a.instance.ha(1319);Ya.xs([Qb])}))}}Object(b.a)(cb,"LineageActivityCommandHandler",null,[210]);class Da extends z.a{constructor(Ya){super(Ya)}ue(){D.TaskExtensions.za(y.GetServiceTaskFactory.Za(this.$.da,
366,367,this.La),Ya=>{this.Zd([new cb(this.$,Ya.result)])},this.ka,3)}static la(Ya){z.a.Ie(363,new Da(Ya))}}Object(b.a)(Da,"LineageActivityCommandHandlerFactory",z.a,[]);var zb=a(426),qb=a(30),Pa=a(84),Nb=a(175),Tb=a(114);class Vb{}Object(b.a)(Vb,"LineageClientParams",null,[]);class Jb{}Object(b.a)(Jb,"LineageFilter",null,[]);var Qa=a(74),Db=a(75),sa=a(136),Ha=a(47),mb=a(201),qa=a(119),Xa=a(129),Ca=a(231),va=a(248),na=a(19),Ka=a(137),ib=a(59);const Ra=(Ya,Qb,Ec,id,Bd,Id,ee,Fe=null)=>{Fe=Ya.Pa(1,Fe);
Fe.clientParams=Qb;Fe.lineageFilter=Ec;return ib.g(Ya,"LineageOpenPaneOrChangeFilter",Fe,id,Bd,Id,ee,0)},ka=(Ya,Qb,Ec,id,Bd,Id,ee=null)=>{ee=Ya.Pa(1,ee);ee.fetchFromBelow=Qb;return ib.g(Ya,"LineageLoadMore",ee,Ec,id,Bd,Id,0)},da=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageRefreshView",Id,Qb,Ec,id,Bd,0)},kb=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageUpdateView",Id,Qb,Ec,id,Bd,0)},Ob=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageClosePane",
Id,Qb,Ec,id,Bd,0)},lc=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageHidePreviousHistory",Id,Qb,Ec,id,Bd,0)},tc=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageLoadInGridBlueDots",Id,Qb,Ec,id,Bd,0)},Pb=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageGetOriginalBlueDotsUidList",Id,Qb,Ec,id,Bd,4)},tb=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"LineageGetBlueDotsInformation",Id,Qb,Ec,id,Bd,4)},gc=(Ya,Qb,Ec,id,Bd,Id,ee=null)=>{ee=Ya.Pa(1,
ee);ee.blueDotsReloadHint=Qb;return ib.g(Ya,"LineageLoadInGridBlueDotsWithReloadHint",ee,Ec,id,Bd,Id,0)};var Xb=a(55),Ga=a(355);class Za{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Za,"LineageActivitiesResponseDTO",
null,[]);class Sb extends Za{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(Sb,"LineageActivitiesUpdateResponseDTO",Za,[]);class sb{constructor(){this.hasAnyActiveInGridHighlight=this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=
this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(sb,"LineageAppCallbacks",null,[]);class bc{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(bc,"LineageAuthorDTO",null,[]);class kc{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(kc,"LineageControllerFactoryParams",
null,[]);class vb{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(vb,"LineageSharedRangeDTO",null,[]);class ub{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(ub,"LineageSheetMultiRangeDTO",null,[]);class Ub{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=
0}}Object(b.a)(Ub,"LineageUserActivityDTO",null,[]);class Rd{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Rd,"LineageValueChangeDTO",null,[]);var Cd;(function(Ya){Ya[Ya.default=0]="default";Ya[Ya.D48X48=1]="D48X48";Ya[Ya.D64X64=2]="D64X64";Ya[Ya.D96X96=3]="D96X96";Ya[Ya.D120X120=4]="D120X120";Ya[Ya.D240X240=5]="D240X240";Ya[Ya.D360X360=6]="D360X360";Ya[Ya.D432X432=7]="D432X432";Ya[Ya.D504X504=8]="D504X504";Ya[Ya.D648X648=9]="D648X648"})(Cd||
(Cd={}));Object(b.b)("ProfilePhotoDimension",Cd);const Yc=(Ya,Qb)=>{let Ec=[];for(const We of Ya){Ya=We;var id=Qb,Bd=Object(M.a),Id=new Ub,ee=Number.parseLocale(Ya.UserActivity.Id),Fe=Ya.Uid,La=Ya.UserActivity.Type;var Kb=Ya.UserActivity.Person;var uc=id;if(Kb){var Sc=null;e.AFrameworkApplication.fa.ra("IsUserProfilePictureResolutionEnabled")&&(Sc=uc.Nka(Kb.Email,Kb.Provider,e.AFrameworkApplication.oj,Cd.default));Kb=Object(M.a)(new bc,{id:Kb.Id,provider:Kb.Provider,displayName:Kb.DisplayName,email:Kb.Email,
imageUrl:Sc})}else Kb=null;uc=Ya.SheetName;Sc=new Date(Ya.UserActivity.DisplayTimestamp);var nd=Ya.DisplayLocation,Jd=Ya.LineageValueChangeList;var ke=[];for(const $e of Jd)Jd=Object(M.a)(new Rd,{hasNewValue:$e.HasNewValue,hasOldValue:$e.HasOldValue,newValue:$e.HasNewValue?$e.NewValue:null,oldValue:$e.HasOldValue?$e.OldValue:null,cellLocation:$e.CellLocation}),ke.push(Jd);Jd=Ya.IsBulkEditOverFlow;a:{var ne=Ya.UserActivity.LocationList;var Ue=Ya.UserActivity.Type;if(!ne){d.ULS.sendTraceTag(512259102,
0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");Ue=null;break a}if(!ne.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");Ue=null;break a}var of=[],He=[];let $e="";21===Ue?He.push(ne[0]):He=ne;for(const Uf of He)switch(Uf.Type){case 1:break;case 2:$e=Uf.SheetName;break;case 0:ne=Uf;if(!ne.RangeList){d.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");
break}$e=ne.RangeList[0].SheetName;He=[];21===Ue?He.push(ne.RangeList[0]):He=ne.RangeList;for(const Re of He)ne=Object(M.a)(new vb,{firstCol:Re.FirstColumn,firstRow:Re.FirstRow,lastRow:Re.LastRow,lastCol:Re.LastColumn}),of.push(ne);break;default:d.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",Uf.Type)}Ue=Object(M.a)(new ub,{sheetName:$e,rangeList:of})}id=(of=Ya.NestedActivityList)?Yc(of,id):null;Ya=Bd(Id,{activityId:ee,activityGuid:Fe,
activityType:La,author:Kb,sheetName:uc,displayTimestamp:Sc,gridLocation:nd,valueChanges:ke,isBulkEditOverflow:Jd,rangeHighlightLocation:Ue,nestedActivityList:id,degradedCardTypeBits:Ya.DegradedCardTypeBits});25===Ya.activityType?(Bd=[],Kd(Ya,Bd),Ec=[...Ec,...Bd]):Ec.push(Ya)}return Ec},Kd=(Ya,Qb)=>{25===Ya.activityType?Ya.nestedActivityList.forEach(Ec=>{Ec&&Kd(Ec,Qb)}):Qb.push(Ya)};class oc{constructor(Ya,Qb,Ec,id,Bd){this.N6a=this.PE=null;this.QF=this.DAa=0;this.XKb=()=>{this.u$&&(this.u$.stop(),
this.u$=null);this.iSb.start();this.PE.createLineageTaskPane(this.rCd,this.N6a,this.activityGuid)};this.onBlueDotDismissed=()=>{this.PE.onBlueDotDismissed()};this.lineageOpenPaneOrChangeFilterRequest=(Id,ee)=>{this.iSb.stop();Ka.b(this.$).Vd(sa.a.h9i,{});this.X0d();const Fe=Object(M.a)(new Vb,{ClientViewCapacity:Id.clientViewCapacity});let La=null;ee&&(La=Object(M.a)(new Jb,{FilterSheetMultiRange:this.E9j(ee.filterSheetMultiRange)}));const Kb=uc=>{uc=qa.a.vf(uc.data);d.ULS.sendTraceTag(537155481,
0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${P.a.Uc(uc)}]`)};this.$.userOperationManager.Bd(new mb.a(1010,0,(uc,Sc,nd)=>Ra(this.$.qa.va,Fe,La,va.b(uc,this.Vnd("LineageOpenPaneOrChangeFilter")),va.a(Sc,Kb),nd,null),80),null)};this.lineageLoadMoreRequest=Id=>{Ka.b(this.$).Vd(sa.a.g9i,{});const ee=Fe=>{Fe=qa.a.vf(Fe.data);d.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${P.a.Uc(Fe)}]`)};this.$.userOperationManager.Bd(new mb.a(1011,
0,(Fe,La,Kb)=>ka(this.$.qa.va,Id,va.b(Fe,this.Vnd("LineageLoadMore")),va.a(La,ee),Kb,null),80),null)};this.lineageRefreshViewRequest=()=>{Ka.b(this.$).Vd(sa.a.j9i,{});const Id=ee=>{ee=qa.a.vf(ee.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${P.a.Uc(ee)}]`)};this.$.userOperationManager.Bd(new mb.a(1012,0,(ee,Fe,La)=>da(this.$.qa.va,va.b(ee,this.Vnd("LineageRefreshView")),va.a(Fe,Id),La,null),80),null)};this.lineageUpdateViewRequest=()=>{kb(this.$.qa.va,
Id=>{if(Id=Ca.a(Id)?null:Id.Result){var ee={["CountOfUpdatedActivities"]:Id.LineageActivitiesResponse.ActivityList.length};Ka.b(this.$).Vd(sa.a.k9i,ee);Id=Object(M.a)(new Sb,{activityList:V.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?Yc(Id.LineageActivitiesResponse.ActivityList,this.Vfa):this.LOd(Id.LineageActivitiesResponse.ActivityList),latestActivityId:Id.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Id.LineageActivitiesResponse.FirstSearchedActivityId,
serverMessageCode:Id.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Id.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Id.HasNewActivities,filterSheetMultiRange:this.u9j(Id.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Id.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Id.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:Id.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Id.LineageActivitiesResponse.EolCorrelationId,
eolDateHideHistory:new Date(Id.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.EBb(Id.LineageActivitiesResponse.EolPersonHideHistory)});this.PE.onLineageActivitiesUpdateResponse(Id)}else d.ULS.shipAssertTag(537155475,0,!!Id,"LineageManager.LineageUpdateView returned null response.")},Id=>{Id=qa.a.vf(Id.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${P.a.Uc(Id)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>
qb.a.rEb(this.$)&&this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.hasAnyActiveInGridHighlight=()=>this.blueDotManager?this.blueDotManager.hasAnyActiveInGridHighlight():!0;this.onDisplayInGridHighlightsChanged=Id=>{this.blueDotManager&&this.blueDotManager.vOj(Id)};this.onCardSelected=(Id,ee)=>{var Fe,La;if(null===(Fe=this.blueDotManager)||void 0===Fe?0:Fe.shouldShowBlueDot(Id.activityGuid))null===
(La=this.blueDotManager)||void 0===La?void 0:La.aMa(Id.activityGuid,1);if(Id=Id.rangeHighlightLocation){if(ee){if(({range:Fe}=Ha.ab(ee,V.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.ua:null)).returnValue){this.Mkf(Id.sheetName,this.NBb([Ha.j(Fe)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+ee+" is not valid.")}Id.rangeList.length?this.Mkf(Id.sheetName,Id.rangeList):this.iqi(Id.sheetName)}};this.onLearnMoreLinkClicked=
()=>{const Id=new Z.a(-859308420,Db.a.fc,this.$.Tc,12,null);this.$.Ia.mc(Id,{[Db.a.Og]:"HelpID=XLO_LineageTS",["InputMethod"]:Db.a.fc,[Db.a.Gd]:ja.a.rS,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=Id=>{this.$.Ia.mc(new Z.a(-1112508866,Id,this.$.Tc,12,null))};this.isFeatureEnabled=Id=>{switch(Id){case "FlattenListInLineageManager":return V.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");case "UseLineagePaneContainer":return V.EwaSettings.isChangeGateEnabled("OfficeVSO:7883958_UseLineagePaneContainer");
default:return!1}};this.rg=()=>{const Id=this.$.ea.ao.LineageVersion;Id!==this.DAa&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Id}, this.lineageVersion: ${this.DAa}`),this.DAa=Id,this.stj())};this.Md=(Id,ee)=>{this.PE&&!this.lineageTaskPane.BFb&&ee.QG&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.ho=()=>{this.PE&&!this.lineageTaskPane.BFb&&(d.ULS.sendTraceTag(587220562,
0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.ZE=()=>{const Id=this.q8a();this.PE.onFilterableSheetListChange(Id)};this.SBa=()=>{const Id=this.q8a();this.PE.onFilterableSheetListChange(Id)};this.Tvc=()=>{const Id=this.q8a();this.PE.onFilterableSheetListChange(Id)};this.onPaneClosed=()=>{this.PE.onPaneClosed();Ob(this.$.qa.va,null,Id=>{Id=qa.a.vf(Id.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${P.a.Uc(Id)}]`)},
null,null)};this.onRangeFilterInputEnabled=Id=>{Id?this.gridView.ga.ND(this.Od):this.gridView.ga.aD(this.Od)};this.Od=()=>{var Id=Ha.q(this.gridView.ga.pa.activeRange,this.$);Id=Object(M.a)(new ub,{rangeList:this.NBb(Id.Ranges),sheetName:Id.SheetName});this.PE.onSelectedRangeUpdated(Id)};this.tryParseRangeInfo=Id=>{let ee;if(({sheetName:ee,range:Id}=Ha.ab(Id,this.$.ua)).returnValue){ee||(ee=this.$.ua.na.sheetName);const Fe=[];Fe.push(Id);Id=Ha.u(ee,null,Fe);return Object(M.a)(new ub,{rangeList:this.NBb(Id.Ranges),
sheetName:Id.SheetName})}return null};this.$A=()=>{const Id=this.QF!==this.$.ea.gf;this.PE&&this.lineageTaskPane.isVisible&&Id&&(this.QF=this.$.ea.gf,this.PE.onRefreshRequired());this.blueDotManager&&this.blueDotManager.sFb()&&this.blueDotManager.i9i(!this.lineageTaskPane.BFb)};this.$=Ya;Qb.Ja(366,this);this.blueDotManager=id;this.gridView=na.h(this.$);this.lineageTaskPane=Ec;this.rCd=this.lineageTaskPane.IV();this.batchSize=50;this.u$=Bd;this.iSb=this.$.yc.vh("UserAction","LineagePaneLoadingShimmerStopWatch");
this.Vfa=Pa.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Tui();this.mTg()}dispose(){this.Bwj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.kY(this.onPaneClosed),this.lineageTaskPane.rH(this.$A),this.lineageTaskPane=null);this.iSb=this.Vfa=this.N6a=this.rCd=this.PE=null}Pig(Ya,Qb,Ec,id){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Ec){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");
return}if(!Ya&&16!==Ec&&18!==Ec&&30!==Ec){this.lineageTaskPane.n9b();return}}qb.a.de()||(this.iSb.start(),this.u$&&(Xb.b().VB(this.iSb.id,this.u$.id,"actions","actions"),this.u$.stop(),this.u$=null));this.lineageTaskPane.BFb||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Ya?Qb:Ec}`);this.QF=this.$.ea.gf;this.N6a=null;Ya?(Ya=Ha.r(this.gridView.ga.pa.selectedRanges,this.$),this.N6a=Object(M.a)(new ub,{rangeList:Qb.toString()===ja.a.iig?this.NBb(Ya.Ranges):
null,sheetName:Ya.SheetName})):V.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===Ec&&this.olj(id);qb.a.de()&&this.lineageTaskPane.BFb?this.lineageTaskPane.SOj(this.XKb):this.PE.createLineageTaskPane(this.rCd,this.N6a,this.activityGuid);this.lineageTaskPane.Oh(!0);this.$.Ed(-71295319,-1,0,null)}olj(Ya){var Qb;if(Ya){var Ec=Ya.sheetRanges;Ya=Ya.activityGuid;Ec&&Ya?(null===(Qb=this.blueDotManager)||void 0===Qb?void 0:Qb.aMa(Ya,2),this.activityGuid=
Ya,this.N6a=this.i6h(Ec)):d.ULS.shipAssertTag(509752709,0,!1,"Blue dot gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Ya={["paneVisible"]:this.lineageTaskPane.isVisible};Nb.a.sendTelemetryEvent(Object(M.a)(new Ga.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:Tb.a.Wj(Ya)}));this.$.userOperationManager.Bd(new mb.a(1018,0,(Qb,Ec,id)=>lc(this.$.qa.va,
Qb,Ec,id,null),64),null);this.lineageTaskPane.isVisible||this.Pig(!1,null,4,void 0)}Tui(){const Ya=Object(M.a)(new sb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,
lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,hasAnyActiveInGridHighlight:this.hasAnyActiveInGridHighlight,onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged,shouldShowBlueDot:Qb=>{var Ec,id;return null!==(id=null===(Ec=this.blueDotManager)||void 0===Ec?void 0:Ec.shouldShowBlueDot(Qb))&&void 0!==
id?id:!1}});Fa.a(()=>{this.PE=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(M.a)(new kc,{clientBatchSize:this.batchSize,filterableSheetList:this.q8a(),uiCulture:this.$.xa.UICultureTag,dataCulture:this.$.xa.DataCultureTag,logger:new E.a,lineageAppCallbacks:Ya}))})}i6h(Ya){const Qb=[],Ec=this.$.ua.na;for(const id of Ya)id.sheetId===Ec.sheetId&&(Ya=Ha.j(id.range),Ya=Object(M.a)(new vb,{firstCol:Ya.FirstColumn,firstRow:Ya.FirstRow,lastCol:Ya.LastColumn,lastRow:Ya.LastRow}),
Qb.push(Ya));return Object(M.a)(new ub,{rangeList:Qb,sheetName:Ec.sheetName})}Vnd(Ya){return Qb=>{if(Qb=Ca.a(Qb)?null:Qb.Result){var Ec={["CountOfActivities"]:Qb.ActivityList.length};Ec.WebRequestName=Ya;Ka.b(this.$).Vd(sa.a.L6i,Ec);Qb=Object(M.a)(new Za,{activityList:V.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?Yc(Qb.ActivityList,this.Vfa):this.LOd(Qb.ActivityList),latestActivityId:Qb.LastSearchedActivityId,oldestActivityId:Qb.FirstSearchedActivityId,
serverMessageCode:Qb.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Qb.EcmaLastSearchedDate),serverFirstActivityId:Qb.ServerFirstActivityId,serverLastActivityId:Qb.ServerLastActivityId,showLoadPrevious:Qb.ShowLoadPrevious,eolCorrelationId:Qb.EolCorrelationId,eolDateHideHistory:new Date(Qb.EolDateHideHistory),eolPersonHideHistory:this.EBb(Qb.EolPersonHideHistory)});this.PE.onLineageActivitiesResponse(Qb)}else d.ULS.shipAssertTag(537155477,0,!!Qb,"LineageManager."+Ya+" returned null response.")}}u9j(Ya){return Xa.e(Ya.Ranges)&&
!Ya.SheetName?null:Object(M.a)(new ub,{rangeList:this.NBb(Ya.Ranges),sheetName:Ya.SheetName})}NBb(Ya){const Qb=[];for(const Ec of Ya)Ya=Object(M.a)(new vb,{firstCol:Ec.FirstColumn,firstRow:Ec.FirstRow,lastRow:Ec.LastRow,lastCol:Ec.LastColumn}),Qb.push(Ya);return Qb}E9j(Ya){if(!Ya)return null;const Qb={};Qb.Ranges=this.Uod(Ya.rangeList);Qb.SheetName=Ya.sheetName;return Qb}Uod(Ya){const Qb=[];if(Xa.e(Ya))return Qb;for(const Ec of Ya)Ya={},Ya.FirstColumn=Ec.firstCol,Ya.FirstRow=Ec.firstRow,Ya.LastRow=
Ec.lastRow,Ya.LastColumn=Ec.lastCol,Qb.push(Ya);return Qb}iqi(Ya){(Ya=this.$.ua.getItemByName(Ya))&&Ya.visible&&Ya.activate(!0)}Mkf(Ya,Qb){const Ec=[];for(var id of Qb)Qb={},Qb.FirstColumn=id.firstCol,Qb.FirstRow=id.firstRow,Qb.LastRow=id.lastRow,Qb.LastColumn=id.lastCol,Ec.push(Ha.E(Qb));id=Ec.length-1;Qb=Ec[id].topLeft;na.h(this.$).M0(Ec,id,Ya,null,Qb,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}stj(){this.PE&&this.lineageTaskPane.isVisible&&(this.QF=this.$.ea.gf,this.PE.onRefreshRequired())}mTg(){var Ya;
this.lineageTaskPane.hV(this.onPaneClosed);this.lineageTaskPane.UF(this.$A);this.$.ea.wv(this.rg);this.$.ea.Mk(this.Md);this.$.ea.VK(this.ho);const Qb=this.$.ua;Qb.e_(this.ZE);Qb.yja(this.Tvc);Qb.jJa(this.SBa);Qb.A1a(this.Tvc);null===(Ya=this.blueDotManager)||void 0===Ya?void 0:Ya.aye(this.onBlueDotDismissed)}Bwj(){var Ya;this.$.ea.hx(this.rg);this.gridView.ga.aD(this.Od);this.$.ea.Vk(this.Md);this.$.ea.EP(this.ho);const Qb=this.$.ua;Qb.R9(this.ZE);Qb.Qpa(this.Tvc);Qb.pUa(this.SBa);Qb.COb(this.Tvc);
null===(Ya=this.blueDotManager)||void 0===Ya?void 0:Ya.N4f(this.onBlueDotDismissed)}onStaleActivitiesDetected(){this.PE.onStaleActivitiesDetected()}q8a(){const Ya=this.$.ua.items,Qb=[];for(const Ec of Ya)Ec.visible&&!Qa.e(Ec)&&Qb.push(Ec.sheetName);return Qb}X0d(){var Ya=this.$.da.Ba(403);Ya&&Ya.disable();Ya=new Z.a(-847286761,Db.a.fc,this.$.Tc,0,ja.a.n2);this.$.Ia.mc(Ya,{["InputMethod"]:Db.a.fc,CalloutName:5})}LOd(Ya){const Qb=[];for(const Ec of Ya)Ya=Object(M.a)(new Ub,{activityId:Number.parseLocale(Ec.UserActivity.Id),
activityGuid:Ec.Uid,activityType:Ec.UserActivity.Type,author:this.EBb(Ec.UserActivity.Person),sheetName:Ec.SheetName,displayTimestamp:new Date(Ec.UserActivity.DisplayTimestamp),gridLocation:Ec.DisplayLocation,valueChanges:this.tnj(Ec.LineageValueChangeList),isBulkEditOverflow:Ec.IsBulkEditOverFlow,rangeHighlightLocation:this.gnj(Ec.UserActivity.LocationList,Ec.UserActivity.Type),nestedActivityList:this.$mj(Ec.NestedActivityList),degradedCardTypeBits:Ec.DegradedCardTypeBits}),Qb.push(Ya);return Qb}gnj(Ya,
Qb){if(!Ya)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Ya.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Ec=[];var id=[];let Bd="";21===Qb?id.push(Ya[0]):id=Ya;for(const Id of id)switch(Id.Type){case 1:break;case 2:Bd=Id.SheetName;break;case 0:Ya=Id;if(!Ya.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");
break}Bd=Ya.RangeList[0].SheetName;id=[];21===Qb?id.push(Ya.RangeList[0]):id=Ya.RangeList;for(const ee of id)Ya=Object(M.a)(new vb,{firstCol:ee.FirstColumn,firstRow:ee.FirstRow,lastRow:ee.LastRow,lastCol:ee.LastColumn}),Ec.push(Ya);break;default:d.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(M.a)(new ub,{sheetName:Bd,rangeList:Ec})}tnj(Ya){const Qb=[];for(const Ec of Ya)Ya=Object(M.a)(new Rd,{hasNewValue:Ec.HasNewValue,
hasOldValue:Ec.HasOldValue,newValue:Ec.HasNewValue?Ec.NewValue:null,oldValue:Ec.HasOldValue?Ec.OldValue:null,cellLocation:Ec.CellLocation}),Qb.push(Ya);return Qb}$mj(Ya){return Ya?this.LOd(Ya):null}EBb(Ya){if(!Ya)return null;let Qb=null;e.AFrameworkApplication.fa.ra("IsUserProfilePictureResolutionEnabled")&&(Qb=this.Vfa.Nka(Ya.Email,Ya.Provider,e.AFrameworkApplication.oj,0));return Object(M.a)(new bc,{id:Ya.Id,provider:Ya.Provider,displayName:Ya.DisplayName,email:Ya.Email,imageUrl:Qb})}}Object(b.a)(oc,
"LineageManager",null,[755,2]);class eb extends f.a{constructor(Ya){super();this.u$=this.lineageTaskPane=null;this.$=Ya;this.uc()}mzf(Ya,Qb){D.TaskExtensions.za(Ya,()=>{this.$b(this.$.da.Ba(366)||new oc(this.$,this.$.da,this.lineageTaskPane,Qb,this.u$))},this.$.ka,3)}create(){this.u$=this.$.yc.Fd("UserAction","LineagePaneSeenStopwatch");this.u$.start();const Ya=y.GetServiceTaskFactory.Za(this.$.da,365,364,this.La),Qb=zb.a(this.$);let Ec=Ia.d(X.a.resolve(ca.C,{Wa:this.La}));if(V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",
!1)){const id=y.GetServiceTaskFactory.Za(this.$.da,501,500,0);D.TaskExtensions.za(D.TaskExtensions.xe([Ya,Qb,Ec,id],this.$.ka),()=>{this.lineageTaskPane=Ya.result;qb.a.de()||Qb.result.wS(this.lineageTaskPane);this.mzf(Ia.d(Ec.result.ou.loadScript("cellLineage")),id.result)},this.$.ka,3)}else D.TaskExtensions.za(D.TaskExtensions.xe([Ya,Qb,Ec],this.$.ka),()=>{this.lineageTaskPane=Ya.result;qb.a.de()||Qb.result.wS(this.lineageTaskPane);this.mzf(Ia.d(Ec.result.ou.loadScript("cellLineage")),null)},this.$.ka,
3)}static la(Ya){Ya.da.Ja(367,new eb(Ya))}}Object(b.a)(eb,"LineageManagerFactory",f.a,[]);var yb=a(828),zc=a(232),dd=a(14),od=a(113),Ed=a(274),ce=a(90),wc=a(249),ed=a(20),md=a(734);const Yd=ja.a.O3d+"LineageActivityPaneTitle",$d=ja.a.ATb+"LineageActivityCloseButton";class bd extends wc.a{constructor(Ya,Qb,Ec){super(Ya);this.XKb=this.XKe=this.qf=null;this.iyd=!0;this.nx=0;this.ju=!1;this.kd=(id,Bd)=>{Bd.Ag||this.n9b()};this.lm=()=>{this.n9b();return!0};this.$=Qb;this.taskPaneManager=Ec;this.$.ik(this.kd);
aa.a(this.$).Zi(this);qb.a.de()&&(this.isVisible=!1)}iV(Ya){this.get_events().addHandler("LineageTaskPaneRemove",Ya)}lY(Ya){this.get_events().removeHandler("LineageTaskPaneRemove",Ya)}UF(Ya){this.addHandler("LineageTaskPaneVisibilityChanged",Ya)}rH(Ya){this.removeHandler("LineageTaskPaneVisibilityChanged",Ya)}hV(Ya){this.get_events().addHandler("LineageTaskPaneClose",Ya)}kY(Ya){this.get_events().removeHandler("LineageTaskPaneClose",Ya)}get isVisible(){return super.isVisible}set isVisible(Ya){super.isVisible!==
Ya&&(super.isVisible=Ya,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get BFb(){return this.iyd}get Fg(){return this.isVisible}get Ji(){return 15}get Qe(){return ia.a.TNi}get Dl(){return ed.a.JMh}get uS(){return wb.a.instance.ha(1077)}get fr(){return 300}get isResizable(){return!1}get Wc(){return this.domElement}get height(){return this.taskPaneManager.hQ.offsetHeight}get titleText(){return wb.a.instance.ha(1294)}get wB(){return this.taskPaneManager.Oxa(this.Wc,this.titleText,this.fr,this.isResizable,
()=>{this.isVisible=!0;this.XKb?this.XKb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1;this.n9b()},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.fr)}Sr(){return this.ju}Vu(){return this.ju}LX(){}QW(){return!1}pk(){}Rk(){}dispose(){this.$&&(this.$.Wl(this.kd),aa.a(this.$).gB(this));this.qf&&(zc.a.instance.Aa(dd.a.click,this.qf,this.lm),od.KeyInputManager.instance.By(this.qf,this.XKe));this.qf=this.taskPaneManager=this.$=null;super.dispose()}$g(Ya,
Qb){if(!Qb){Ya=ya.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Ya)return!1;ya.DOMElementExtensions.setFocus(Ya)}return!Qb}ui(Ya){return ya.DOMElementExtensions.zg(this.Wc,Ya)}Oh(Ya){this.ju=Ya;const Qb=this.taskPaneManager;if(this.isVisible=Ya)this.$.frame.Hf.vk("LineagePane"),this.iyd=!1;if(qb.a.de())Ya?Qb.m9("LineageTaskPane",this.wB):Qb.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.mD();const Ec=!!this.taskPaneManager.Ci&&15===this.taskPaneManager.Ci.taskPane.Ji;
Ya&&0<Qb.pF.length&&(!Ec||Qb.isCollapsed)&&Qb.$J(this,!0)}this.$.ig()}IV(){var Ya=this.$.qc;Ya=qb.a.de()?this.domElement:document.getElementById(Ya+ja.a.wCd);if(!qb.a.de()||!V.EwaSettings.isChangeGateEnabled("OfficeVSO:7858326_TaskPaneReactHeader")){var Qb=this.XN();Ya.appendChild(Qb)}Qb=md.b("div","LineagePaneBodyId","LineageActivityBody");Ya.appendChild(Qb);this.TOj();return Qb}n9b(){this.$.frame.Hf.vk(this.$.frame.Hf.rG||Ed.AFrame.mV);this.iyd=!0;this.Oh(!1);this.raiseEvent("LineageTaskPaneClose")}SOj(Ya){this.XKb=
Ya}TOj(){this.$.frame.Hf.gl("LineagePane");const Ya=this.$.frame.Hf.rj("LineagePane");Ya.parent=Ed.AFrame.mV;Ya.LO=!0}XN(){const Ya=md.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),Qb=md.b("h1","LineagePaneTitleId",Yd);Qb.innerText=this.titleText;this.qf=yb.a.Vb("LineagePaneCloseButtonId",$d,wb.a.instance.ha(10),"ClosePaneGlyph_16x16x32",!1);this.qf.classList.add(e.AFrameworkApplication.isRtl?ja.a.Nla:ja.a.Ola);zc.a.instance.ta(dd.a.click,this.qf,this.lm);this.XKe=od.KeyInputManager.instance.ev(this.qf,
this.lm,ce.a.Li);Ya.appendChild(Qb);Ya.appendChild(this.qf);return Ya}static la(Ya,Qb){const Ec=Ya.qc;let id=document.getElementById(Ec+ja.a.wCd);id||(id=document.createElement("div"),id.id=Ya.qc+ja.a.wCd,id.classList.add("LineageActivityPane"),qb.a.de()||document.getElementById(Ec+ja.a.GX).appendChild(id));return Ya.da.Ba(365)||Ya.da.Ja(365,new bd(id,Ya,Qb))}}Object(b.a)(bd,"LineageTaskPane",wc.a,[753,2,418,26]);class Vd extends f.a{constructor(Ya){super();this.fi=this.mj=null;this.$=Ya;this.uc()}get bF(){this.mj||
(this.mj=D.TaskExtensions.za(zb.a(this.$),Ya=>{this.fi=bd.la(this.$,Ya.result)},this.ka,3));return this.mj}create(){const Ya=y.GetServiceTaskFactory.create(this.$.da,203,this.ka,this.La),Qb=V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateCommonUiStrings",!1)?Object(Ia.d)(X.a.resolve(ca.p,{Wa:this.La})):y.GetServiceTaskFactory.create(this.$.da,155,this.ka,this.La);D.TaskExtensions.za(D.TaskExtensions.ts(D.TaskExtensions.xe([Ya,Qb],this.ka),()=>this.bF,this.ka),()=>{this.$b(this.fi)},
this.ka,3)}dispose(){this.fi=this.mj=this.$=null;super.dispose()}static la(Ya){Ya.da.Ja(364,new Vd(Ya))}}Object(b.a)(Vd,"LineageTaskPaneFactory",f.a,[]);var De=a(916),Pe=a(85);class Zb{constructor(Ya,Qb){this.Ah=Ya;this.tw=Qb}CY(Ya,Qb,Ec,id=null){return this.aAh(Ya,id,Bd=>this.Ah.$rb(Bd,2,Ec,Qb,void 0,void 0,void 0,void 0,void 0,"2"))}aAh(Ya,Qb,Ec){const id=!!Qb&&""!==Qb;let Bd=Ya;id&&(Bd=t.a.aR(Ya,"perfTag",Qb));const Id=new Date;return De.a.then(Ec(Bd),ee=>{const Fe=+new Date-+Id;if(!ee||!ee.Zh||
!ee.Zh.data)return ee;id&&ee.Zh.data.request&&this.wKj(ee.Zh.data.request.getResolvedUrl(),Qb,Fe);return ee})}wKj(Ya,Qb,Ec){Ya=this.tw.Adi(Ya);if(Ya.count&&(Ya=Pe.last(Ya))){const id={Message:"Request durations for activities calls."};id.PerfTag=Qb;id.CustomDuration=Ec;id.PerformanceDuration=Ya.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(id))}}}Object(b.a)(Zb,"CatchUpNetworkingWrapper",null,[761]);var Vc=a(255);class Nc extends Vc.a{constructor(Ya,Qb){super(Ya,Qb)}Ada(){return 6}}
Object(b.a)(Nc,"GetActivityFeedRequest",Vc.a,[]);class ld extends Vc.a{constructor(Ya,Qb,Ec,id,Bd,Id){super(Ya,Qb);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Ec;this.ActivityStatesToSet=id;this.ActivityStatesToReset=Bd;this.ResetUnseenCount=Id}Ada(){return 7}}Object(b.a)(ld,"UpdateActivityFeedStateRequest",Vc.a,[]);var yd=a(251),sd=a(394);class ic{constructor(Ya,Qb,Ec){this.yme=Ya;this.OFa=Qb;this.fGa=Ec}getActivityFeed(Ya){return De.a.then(this.fGa.execute(new Nc(this.OFa(),
null),(Qb,Ec,id)=>this.yme.CY(Qb,Ec,id,"ActivityFeed"),Ya),Qb=>{if(!Qb)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!Qb.Zh)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;Qb=Qb.Zh.data;if(!Qb)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(Qb.httpStatus!==yd.a.xK)return d.ULS.sendTraceTag(508929507,3012,10,"GetActivityFeed: Response status code {0}",Qb.httpStatus),
null;if(!Qb.Pe)return d.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;Qb=sd.a.PLa(Qb.Pe);return Qb?Qb:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}hdk(Ya,Qb,Ec,id){return De.a.then(this.fGa.execute(new ld(this.OFa(),null,Ya,Qb,Ec,id),(Bd,Id,ee)=>this.yme.CY(Bd,Id,ee,"UpdateActivityFeedState"),null),Bd=>{try{return Bd.succeeded}catch(Id){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception {0}",
Id.message),!1}})}}Object(b.a)(ic,"CatchUpRequestHandler",null,[760]);var Ic=a(474);class kd{constructor(Ya){this.Wia=Ya;this.jle=new Ic.a}JPi(){this.yQi()}yQi(){if(this.Wia){var Ya=Qb=>{this.jle.contains("CatchUpChangesFeedback")||(this.jle.add("CatchUpChangesFeedback"),Qb.logActivity("CatchUpChangesFeedback",null))};this.Wia.execute(Qb=>{window.setTimeout(()=>{Ya(Qb)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(kd,
"FloodgateEventLogger",null,[]);var Hd=a(198);class Ud{constructor(Ya){this.iMg=Ya}get duration(){return this.iMg.duration}}Object(b.a)(Ud,"PerformanceResourceTimingWrapper",null,[]);class de{constructor(Ya){this.tw=Ya}Adi(Ya){const Qb=new Hd.a;if(!this.tw)return Qb;Ya=this.tw.getEntriesByName(Ya,"resource");if(!Ya)return Qb;for(const Ec of Ya)Qb.add(new Ud(Ec));return Qb}}Object(b.a)(de,"PerformanceWrapper",null,[]);var qe=a(261);class fe{constructor(){this.Nb=null}get name(){return"Common.App.CatchUpActivity"}Oi(Ya){this.Nb=
Ya;this.Nb.register(Zb,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").gd().od(()=>new Zb(e.AFrameworkApplication.qe,new de(window.performance)));this.Nb.register(ic,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").gd().od(()=>new ic(this.Nb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.oj,new sd.a));this.Nb.register(kd,"Common.App.CatchUpActivity.FloodgateEventLogger").gd().od(()=>
new kd(this.Nb.Dc("Common.ISystemInitiatedFeedback")))}init(){this.Nb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.Nb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){qe.a.instance.wj(new fe)}}Object(b.a)(fe,"CatchUpActivityPackage",null,[4,5]);class Ke{constructor(Ya,Qb){this.$=Ya;this.catchUpActivityManager=Qb}yd(Ya,Qb){return this.catchUpActivityManager?-876699925===Qb?!this.catchUpActivityManager.gpf:!1:!0}executeCommand(Ya,Qb,Ec){Ya=
!1;switch(Qb.command){case -876699925:Ya=this.catchUpActivityManager.Cdj();break;case 950288339:return this.catchUpActivityManager.sFb()?(Qb=Ec.LineageTaskPaneVisible,void 0!==Qb?this.catchUpActivityManager.Afk(Qb):this.catchUpActivityManager.showHideInGridHighlights()):this.catchUpActivityManager.showHideInGridHighlights(),G.Task.Ua(!0)}return Ya?G.Task.Ua(!0):H.a(Qb.command)}fd(Ya,Qb){return V.EwaSettings.ya(382)?-876699925===Qb.command||950288339===Qb.command:!1}Cd(){return!1}}Object(b.a)(Ke,"CatchUpActivityCommandHandler",
null,[210]);class Te extends z.a{constructor(Ya){super(Ya)}ue(){this.$.da.Qb(286,Ya=>{this.Zd([new Ke(this.$,Ya)])})}static la(Ya){z.a.Ie(285,new Te(Ya))}}Object(b.a)(Te,"CatchUpActivityCommandHandlerFactory",z.a,[]);var Se=a(118),df=a(235),te=a(529),gf=a(92),cf=a(126),bf=a(27);class $a{constructor(Ya){this.Ni=Ya}doesContentExist(Ya){if(!Ya)return d.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Ya.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Ya.navigationId)return d.ULS.sendTraceTag(537168065,
3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const Qb={};Qb.NavigationId=atob(Ya.navigationId);return 32===this.Ni.Le(bf.a.gMa,2,Qb);default:return!1}}}Object(b.a)($a,"CatchUpActivityContentManager",null,[728]);var Y=a(863),Ta=a(1300);class Bb{constructor(Ya){this.RKb=()=>{switch(this.Xw.model.state){case 1:this.bjg(!0);break;case 0:this.tSb(!1);break;case 2:case 3:this.tSb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+
this.Xw.model.state)}};this.sIg=Ya;this.Xw.Lxe(this.RKb);this.zz=[]}get Xw(){return this.sIg}dispose(){this.Xw.A4f(this.RKb);this.zz=null}lOj(Ya){this.zz.push(Ya)}gfh(){this.zz.length=0}bjg(Ya){for(const Qb of this.zz){Qb.className=Y.a.Xbh;const Ec=document.getElementById(`${Qb.id}-${ja.a.wIe}`);ya.DOMElementExtensions.setVisible(Ec,Ya)}}tSb(Ya){for(const Qb of this.zz)Qb&&(Ya?Qb.className=2===this.Xw.model.state?Y.a.rqj:Y.a.sqj:this.bjg(!1))}}Object(b.a)(Bb,"RangeCatchUpActivityView",null,[852,2]);
var Rb=a(23);class jc extends Ta.a{constructor(Ya,Qb,Ec){super(Ya,Qb,Ec);this.gridView=na.h(Ya);this.Dpa=Qb}dispose(){this.gridView=null;super.dispose()}QVg(Ya){const Qb=this.Kkb[0];Qb?Qb.lOj(Ya):d.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.Dpa.activityId)}JDj(){const Ya=this.Kkb[0];Ya&&Ya.gfh()}ZTg(Ya){this.Dpa.addRange(Ya)}W2h(){if(3!==this.Dpa.activityType)return null;d.ULS.shipAssertTag(537168003,
0,1===this.Dpa.QSb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");return Ha.E(this.Dpa.QSb[0])}zWd(Ya){if(Ya){if(!this.Dpa)return;this.IGd(this.NEj())}super.zWd(Ya)}Xbd(){const Ya=this.Cbd();this.Kkb.push(Ya)}Cbd(){return new Bb(this)}IGd(Ya){Ya?Ya.SheetName?(this.gridView.ga.Sa.LI(null),this.gridView.focus(),this.gridView.Ygf(Ya,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):
d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}NEj(){if(Xa.e(this.Dpa.QSb))return d.ULS.shipAssertTag(537167971,0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Ya=this.$.ua.na;d.ULS.shipAssertTag(537167970,0,!!Ya,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");
Ya=this.T$j(Ya.sheetName,this.Dpa.QSb);if(!Ya&&(Ya=this.vii(this.Dpa.QSb),!Ya))return null;const Qb={};Qb.SheetName=Ya.SheetName;Qb.FirstColumn=Ya.FirstColumn;Qb.FirstRow=Ya.FirstRow;Qb.LastColumn=Ya.FirstColumn;Qb.LastRow=Ya.FirstRow;return Qb}vii(Ya){if(Xa.e(Ya))return null;let Qb=null;for(let id=0;id<Ya.length;id++){var Ec=Ya[id].SheetName;if(!Rb.a.equals(Ec,Qb,!1)&&(Qb=Ec,Ec=this.$.ua.getItemByName(Ec),null===Ec||void 0===Ec?0:Ec.visible))return Ya[id]}return null}T$j(Ya,Qb){if(Qb)for(const Ec of Qb)if(Rb.a.equals(Ec.SheetName,
Ya,!1))return Ec;return null}}Object(b.a)(jc,"RangeCatchUpActivityHighlightController",Ta.a,[]);var vc=a(86);class bb extends vc.a{constructor(Ya,Qb,Ec,id,Bd,Id){super();this.$=Ya;this.yae=Qb;this.MCg=Ec;this.rI=id;V.EwaSettings.isChangeGateEnabled("OfficeVSO:7809002_CatchUpActivityHoverStateFix")&&Bd&&Id?this.state=2:this.state=Bd?1:0}get type(){return this.rI}get activityId(){return this.yae}get activityType(){return this.MCg}dispose(){this.yae=null;super.dispose()}}Object(b.a)(bb,"CatchUpActivityHighlightModelBase",
vc.a,[]);class Mb extends bb{constructor(Ya,Qb,Ec,id,Bd,Id,ee){super(Ya,Qb,Ec,id,Id,ee);this.ranges=Bd;this.Cab=!1}get QSb(){this.Cab||(this.ranges.sort(Mb.H9b),this.Cab=!0);return this.ranges}addRange(Ya){for(const Qb of Ya)this.ranges.push(Qb)}dispose(){this.ranges=null;super.dispose()}static H9b(Ya,Qb){if(!Ya.SheetName||!Qb.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const Ec=Ya.SheetName.localeCompare(Qb.SheetName);
return Ec?Ec:Ya.FirstColumn<Qb.FirstColumn||Ya.FirstColumn===Qb.FirstColumn&&Ya.FirstRow<Qb.FirstRow?-1:Ya.FirstColumn===Qb.FirstColumn&&Ya.FirstRow===Qb.FirstRow?0:1}}Object(b.a)(Mb,"RangeCatchUpActivityHighlightModel",bb,[]);var hc=a(354);class Cc{constructor(){this.L9b=[];this.Qhb={};this.m1c={};this.Dmc=V.EwaSettings.isChangeGateEnabled("OfficeVSO:7795308_EnableCatchupHighlightLogging")}dispose(){this.m1c=this.Qhb=this.L9b=null}N5f(Ya,Qb){Qb?na.h(Ya).pc.fs([24]):na.h(Ya).pc.Sk([24]);this.Dmc&&
d.ULS.sendTraceTag(508933385,0,50,`CatchUpHighlightControllersCreator:renderAllCatchUpRangeHighlights with setVisible=${Qb}.`)}Xvj(Ya){this.EPe(Ya,[new hc.a(null,null)],this.Qhb,!1);this.Dmc&&d.ULS.sendTraceTag(508933384,0,50,"In CatchUpHighlightControllersCreator:removeAllCatchUpRangeHighlights().")}xnh(Ya,Qb,Ec,id){var Bd;const Id={};for(const Fe of Qb){if(!Fe||Xa.e(Fe.LocationList))continue;Qb=[];const La={},Kb=[];for(const uc of Fe.LocationList){if(!uc){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+
Fe.Id);break}switch(uc.Type){case 0:var ee=uc;let Sc;"0"in La?(Sc=La["0"],Sc.ZTg(ee.RangeList)):(Sc=new jc(Ya,new Mb(Ya,Fe.Id,Fe.Type,0,ee.RangeList,id,Ec.yDi(Fe.Id)),Ec),Qb.push(Sc),La["0"]=Sc);for(const nd of ee.RangeList){ee=new hc.a(Ha.E(nd),Qa.d(Ya.ua.getItemByName(nd.SheetName)));if(this.wEc(ee)in this.Qhb)this.Qhb[this.wEc(ee)].push(Sc);else{let Jd=[];Jd.push(Sc);this.Qhb[this.wEc(ee)]=Jd}Kb.push(ee);this.L9b.push(ee)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,
0,!(Fe.Id in Id),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+Fe.Id);this.m1c[Fe.Id]=Kb;Id[Fe.Id]=Qb}this.EPe(Ya,this.L9b,this.Qhb,id);this.Dmc&&d.ULS.sendTraceTag(508933383,0,50,`CatchUpHighlightControllersCreator:createControllersAndHighlights, length of completeSheetRangeList is ${null===(Bd=this.L9b)||void 0===Bd?void 0:Bd.length}.`);return Id}WBb(Ya){return this.m1c[Ya]}$eh(Ya){for(let Qb in Ya){const Ec=Ya[Qb];for(const id of Ec)id.JDj()}}wEc(Ya){return`${Ya.range}-${Ya.sheetId}`}EPe(Ya,
Qb,Ec,id){this.$eh(Ec);na.h(Ya).pc.oB(Qb,[24],id,(Bd,Id)=>{if(null==Bd.range){for(var ee of Bd.l_)ee.dispose();Bd.l_=[]}else{ee=new hc.a(Bd.range,Bd.sheetId);ee=this.wEc(ee);var Fe=Ec[ee];if(Fe)for(const La of Fe)La.QVg(Id),Bd.metadata=La;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+ee)}})}}Object(b.a)(Cc,"CatchUpHighlightControllersCreator",null,[]);class Wb{constructor(){this.activityIds=
this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(Wb,"CreateIndicatorTooltipParameters",null,[]);class mc{constructor(){this.clearSticky=!1}}Object(b.a)(mc,"DismissIndicatorTooltipParameters",null,[]);class Mc{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(Mc,"UpdateIndicatorTooltipParameters",null,[]);class hd{constructor(Ya,Qb,Ec){this.$=Ya;this.Ni=Qb;this.WBb=Ec}navigateToActivity(Ya){if(Ya.fromSummaryString){var Qb=
new Z.a(1834994092,Db.a.fc,this.$.Tc,18,null);this.$.Ia.mc(Qb);return this.vFa(1)}Ya=Ya.activity;if(V.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&Ya&&1===Ya.type){var Ec=new Z.a(1834994092,Db.a.fc,this.$.Tc,30,null);const id={["activityGuid"]:Ya.activityId,["sheetRanges"]:null===(Qb=this.WBb)||void 0===Qb?void 0:Qb.call(this,Ya.activityId)};this.$.Ia.mc(Ec,id);return this.vFa(1)}if(!this.Fyi(Ya))return this.vFa(4);if(!this.TIi(Ya))return this.vFa(7);
Qb={};try{Ec=window.self.atob(Ya.navigationId);if(!Ec)return this.vFa(5);Qb.NavigationId=Ec}catch(id){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${id}`),this.vFa(5)}if(8===this.Ni.Le(bf.a.gMa,2,Qb))return this.Ni.processAction(bf.a.Jcb,2),this.vFa(2);Qb=32===this.Ni.Le(bf.a.k4a,2,Qb)?1:6;return this.vFa(Qb)}Fyi(Ya){return Ya&&Ya.navigationId?!0:!1}TIi(Ya){switch(Ya.type){case 3:case 4:case 6:case 7:case 9:case 8:case 10:return!0;default:return!1}}vFa(Ya){return Promise.resolve(Ya)}}
Object(b.a)(hd,"CatchUpActivityNavigationManager",null,[729]);var pd=a(37);class Nd{constructor(Ya,Qb){this.u$b=this.hsa=null;this.CCd=!1;this.vCd=!0;this.$of=!1;this.Zkc=this.fVa=null;this.dza={};this.FGa=null;this.Esd=!1;this.WBb=Ec=>this.Fka.WBb(Ec);this.RKb=(Ec,id)=>{switch(id.state){case 0:case 1:3===id.eyc?(this.xpi(),this.fVa=null):2===id.eyc&&(this.Zkc=null);break;case 2:this.Zkc=id.activityId;break;case 3:this.iTe();this.fVa=id.activityId;this.BXj();break;default:d.ULS.shipAssertTag(537168030,
0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+id.state)}};this.Zm=()=>{this.Axb()};this.Od=()=>{this.Axb()};this.Go=()=>{this.Axb()};this.Ui=()=>{this.Axb()};this.Hdj=()=>{this.$8b()};this.Idj=()=>{this.iKe();this.x5e=setTimeout(()=>{this.D5a()},200)};this.Zhg=(Ec,id)=>{id.lAi?(this.$8b(),this.D5a()):(this.$of&&d.ULS.sendTraceTag(508938368,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Flyout is created while bluedots are updating."),
this.vKe(),this.Ljd=setTimeout(()=>{this.$8b();this.D5a();const Bd=this.jak(id.Tda);Bd?(this.hsa.createActivityIndicatorTooltip(Object(M.a)(new Wb,{target:this.hEh(id.Tda),container:Bd,activityIds:[id.activityId],isSticky:!1,dirHint:this.gridView.rtl?12:9,activityNavigationManager:V.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.h8b:void 0,onHoverEnter:this.Hdj,onHoverLeave:this.Idj})),this.Mkc=id.Tda,d.ULS.sendTraceTag(51172353,0,50,
"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event."),this.hnc||(this.gridView.view.As(this.kJc),this.gridView.ut(this.kJc),this.hnc=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},150))};this.$Lf=()=>{this.$8b();this.x5e=setTimeout(()=>{this.D5a()},200)};this.kJc=()=>{this.hsa?(this.d9a&&this.hsa.updateActivityIndicatorTooltip(Object(M.a)(new Mc,{target:this.d9a,
isSticky:!0})),this.Mkc&&this.hsa.updateActivityIndicatorTooltip(Object(M.a)(new Mc,{target:this.d9a,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Ya;this.gridView=na.h(this.$);this.ga=this.gridView.ga;this.lc=this.gridView.Gc;this.ga.u4b(this.Zm);this.ga.yp(this.Od);this.gridView.TF(this.Go);this.lc.ro(this.Ui);this.d9a=this.Mkc=null;this.hnc=!1;this.Gjd={};this.h8b=new hd(this.$,e.AFrameworkApplication.dc,
this.WBb);this.blueDotManager=Qb;this.wkc=!!Qb&&Qb.sFb()}get tve(){return this.hsa}set tve(Ya){this.hsa=Ya}get excelCommentManager(){this.FGa||(this.FGa=this.$.da.Ba(65));return this.FGa}get Fka(){this.u$b||(this.u$b=new Cc);return this.u$b}set Fka(Ya){this.u$b=Ya}dispose(){this.ga.Wzc(this.Zm);this.ga.Rp(this.Od);this.gridView.qH(this.Go);this.lc.io(this.Ui);this.rTe();this.Gjd=this.d9a=this.Mkc=this.Zkc=this.fVa=this.lc=this.ga=this.gridView=null}CXd(Ya){var Qb;const Ec=this.W5b();this.rTe();if(Xa.e(Ya))this.Fka.Xvj(this.$),
null===(Qb=this.blueDotManager)||void 0===Qb?void 0:Qb.H4i(),this.Fka.Dmc&&d.ULS.sendTraceTag(508933386,0,50,"CatchUpActivityHighlightManager:setActivityPayloadForHighlights - userActivities is NULL or empty.");else{d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:setActivityPayloadForHighlights().");if(this.dza=this.Fka.xnh(this.$,Ya,this,Ec)){Ya=this.dza;for(let id in Ya){Qb=Ya[id];for(const Bd of Qb)this.x3g(Bd)}}this.Fka.N5f(this.$,Ec)}}rSb(){const Ya=this.W5b();Ya&&this.Esd?
d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):(Ya||this.Axb(),this.Fka.N5f(this.$,Ya))}aMa(Ya){this.blueDotManager&&(this.blueDotManager.aMa(Ya,0),V.EwaSettings.isChangeGateEnabled("OfficeVSO:7809018_dismissFlyoutOnBlueDotDismissal")&&this.D5a())}fYd(Ya,Qb){if(!this.wkc||!(0===Qb&&this.CCd===Ya||1===Qb&&this.vCd===Ya)){var Ec=this.W5b();this.wkc&&0!==Qb?this.wkc&&1===Qb?this.vCd=Ya:d.ULS.shipAssertTag(508908755,
0,!1,"CatchUpActivityHighlightManager.SetForceHighlightsOff - Unknown reason for setting force highlights off"):this.CCd=Ya;Ec!==this.W5b()&&this.rSb()}}Ecg(Ya){this.$of=Ya}yDi(Ya){return this.Zkc===Ya}rTe(){if(this.dza){const Ya=this.dza;for(let Qb in Ya){const Ec=Ya[Qb];for(const id of Ec)this.Cwj(id),id.dispose()}}this.dza={};this.Fka.dispose();this.Fka=null}BXj(){if(this.excelCommentManager){var Ya=this.dza[this.fVa];Ya&&0<Ya.length&&3===Ya[0].model.activityType&&((Ya=Ya[0])?this.excelCommentManager.eYj(Ya.W2h()):
d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}xpi(){this.excelCommentManager&&this.excelCommentManager.zyb()}iTe(){if(this.fVa){const Ya=this.dza[this.fVa];if(Ya){for(const Qb of Ya)Qb.zWd(!1);this.fVa=null}else d.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}Axb(){this.iTe();this.D5a()}jak(Ya){if(!Ya)return d.ULS.shipAssertTag(537168026,
0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Ya=`${Ya.id}-${ja.a.Vbh}`;let Qb=this.Gjd[Ya];if(!Qb){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;Qb=document.createElement("Div");Qb.className=Y.a.Wbh;Qb.id=Ya;this.gridView.domElement.appendChild(Qb);this.Gjd[Ya]=Qb}return Qb}D5a(){if(this.hsa&&(this.hsa.dismissActivityIndicatorTooltips(Object(M.a)(new mc,
{clearSticky:!0})),this.d9a=this.Mkc=null,this.hnc&&!this.d9a&&(this.gridView.view.wq(this.kJc),this.gridView.$v(this.kJc),this.hnc=!1),this.flyoutAnchorTarget)){const Ya=this.flyoutAnchorTarget.parentElement;null===Ya||void 0===Ya?void 0:Ya.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}}x3g(Ya){Ya.Lxe(this.RKb);Ya.uWg(this.Zhg);Ya.tWg(this.$Lf)}Cwj(Ya){Ya.A4f(this.RKb);Ya.Mxj(this.Zhg);Ya.Lxj(this.$Lf)}vKe(){this.Ljd&&clearTimeout(this.Ljd)}iKe(){this.Ljd&&clearTimeout(this.x5e)}$8b(){this.vKe();
this.iKe()}W5b(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.CCd&&(!this.wkc||!this.vCd)}hEh(Ya){if(this.flyoutAnchorTarget){d.ULS.debugAssertTag(509225110,0,!1,"CatchUpActivityHighlightManager::ensureFlyoutAnchorTarget got non-null flyoutAnchorTarget.");var Qb=this.flyoutAnchorTarget.parentElement;null===Qb||void 0===Qb?void 0:Qb.removeChild(this.flyoutAnchorTarget);this.flyoutAnchorTarget=null}var Ec=Ya.getBoundingClientRect();this.flyoutAnchorTarget=document.createElement("div");
this.flyoutAnchorTarget.className=Y.a.$bh;this.$.$D.appendChild(this.flyoutAnchorTarget);Ya=pd.a(this.$).Bi(Ec.left);Qb=pd.a(this.$).Bi(Ec.top);const id=pd.a(this.$).Bi(Ec.width);Ec=pd.a(this.$).Bi(Ec.height);this.flyoutAnchorTarget.style.left=`${Ya}px`;this.flyoutAnchorTarget.style.top=`${Qb}px`;this.flyoutAnchorTarget.style.width=`${id}px`;this.flyoutAnchorTarget.style.height=`${Ec}px`;return this.flyoutAnchorTarget}}Object(b.a)(Nd,"CatchUpActivityHighlightManager",null,[791,2]);var Xd=a(440);class ae{constructor(){this.collectionId=
this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(ae,"ActivityFeedEntry",null,[]);const Ve=(Ya,Qb)=>Qb.isUserProfilePictureResolutionEnabled?Pe.toArray(Pe.select(Pe.asEnumerable(Ya),Ec=>{if(!Ec||!Ec.activityFeedItemPayload)return Ec;const id=JSON.parse(Ec.activityFeedItemPayload);var Bd=id.actor;if(!Bd||Bd.pictureUrl)return Ec;const Id=Bd.userPrincipalName||Bd.email;if(!Id)return Ec;Bd=Qb.Nka(Id,Bd.provider,e.AFrameworkApplication.oj,0);if(!Bd)return Ec;
id.actor.pictureUrl=Bd;return Object.assign(new ae,{id:Ec.id,type:Ec.type,collectionId:Ec.collectionId,activityState:Ec.activityState,activityFeedItemPayload:JSON.stringify(id),timestamp:Ec.timestamp})})):Ya,we=(Ya,Qb)=>{const Ec=new Map,id=new Map;for(const Bd of Ya){if(!Bd||!Bd.activityFeedItemPayload)continue;Ya=JSON.parse(Bd.activityFeedItemPayload).actor;if(!Ya)continue;const Id=Ya.email||Ya.userPrincipalName;Id&&!id.has(Id)&&id.set(Id,new Xd.a(Id,null,Ya.name))}id.forEach(Bd=>{const Id=Qb.Yic(Bd,
6);Ec.set(Bd.UserId,Id)});return Ec};class Mf{}Object(b.a)(Mf,"GetRelevantActivitiesDataRequest",null,[]);class Ye{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(Ye,"Activity",null,[]);class kf{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(kf,"ActivityFeedItem",
null,[]);class Bf{constructor(){this.personaColorMap=this.activityFeedItems=null}}Object(b.a)(Bf,"ActivityFeedPayload",null,[]);class vf{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(vf,"ActivityRequestPayload",null,[]);class Rf{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Rf,"Person",null,[]);class re extends Ye{constructor(){super();
this.relationship=0}}Object(b.a)(re,"TaskActivity",Ye,[]);const Aa=(Ya,Qb,Ec,id,Bd,Id=null)=>{Id=Ya.Pa(1,Id);return ib.g(Ya,"GetLineageWywaAuthors",Id,Qb,Ec,id,Bd,4)},Eb=(Ya,Qb,Ec,id,Bd,Id,ee=null)=>{ee=Ya.Pa(1,ee);ee.getRelevantActivitiesDataRequest=Qb;return ib.g(Ya,"GetRelevantActivitiesData",ee,Ec,id,Bd,Id,0)};class cc{constructor(Ya,Qb,Ec=!1,id=null){this.c8d=null;this.$=Ya;this.i8b=Qb;this.leb=Pa.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.Vfa=Pa.a.instance.resolve("Common.App.People.IUserProfilePictureUtilsV2");
this.I$a=Ec;this.blueDotManager=id}requestWYWAActivities(){return this.I$a?new Promise((Ya,Qb)=>{Aa(this.$.qa.va,Ec=>{var id;Ec=Ca.a(Ec)?null:Ec.Result;if(V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const Bd=null===(id=null===Ec||void 0===Ec?void 0:Ec.WywaAuthors)||void 0===id?void 0:id.length;if(null!=Bd&&0<Bd){const Id={activities:[],actors:Ec?this.tic(Ec.WywaAuthors):null,hasMore:!1,highWaterline:cc.Zka,lowWaterline:cc.Zka,wywaWaterline:cc.Zka};this.Qtg(ee=>{Id.activities=
ee;Ya(Id)},ee=>{d.ULS.sendTraceTag(509638481,0,10,`updateInGridBlueDots failed: reason: "${ee}"`);Ya(Id)},!0,!1)}else Ya(cc.txb)}else id=Object(M.a)(new vf,{activities:[],actors:Ec?this.tic(Ec.WywaAuthors):null,hasMore:!1,highWaterline:cc.Zka,lowWaterline:cc.Zka,wywaWaterline:cc.Zka}),Ya(id)},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");Qb(null)},null,null)}):Promise.resolve(cc.txb)}requestActivities(){return Promise.resolve(cc.txb)}requestRelevantActivities(){if(!this.$.ea.Oc||
this.$.ea.U8a)return d.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Oc}, HasRaisedSessionEnded: ${this.$.ea.U8a}]`),Promise.resolve(cc.txb);const Ya=Object(M.a)(new Mf,{SetDaysBack:e.AFrameworkApplication.fa.Ae("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.Ae("AppWaterlineOverrideTimestampValue",0)});return new Promise((Qb,Ec)=>{Eb(this.$.qa.va,Ya,id=>{let Bd=
cc.txb;id?Ca.a(id)?(id=P.a.Uc(id.Errors),d.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${id}`)):Bd=this.fdi(id.Result):d.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");Qb(Bd)},id=>{id=qa.a.vf(id.data);id=P.a.Uc(id);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${id}]`);Ec(null)},
null,null)})}requestActivityFeed(){return Ia.c(this.getActivityFeed()).then(Ya=>{Ya=this.s9j(Ya);return Object(M.a)(new Bf,{activityFeedItems:Ve(Ya,this.Vfa),personaColorMap:we(Ya,this.leb)})})}updateActivityState(Ya){return this.i8b?Ia.c(this.i8b).then(Qb=>{var Ec,id;return Ia.c(Qb.hdk(Ya.itemIds,null!==(Ec=Ya.activityStatesToSet)&&void 0!==Ec?Ec:0,null!==(id=Ya.activityStatesToReset)&&void 0!==id?id:0,Ya.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.i8b?De.a.g4d(this.i8b,
Ya=>Ya.getActivityFeed(null)):G.Task.Ua([])}fdi(Ya){if(!Ya)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(M.a)(new vf,{activities:[]});const Qb=this.Wpg(Ya.NewActivities,2);Ya=this.Wpg(Ya.OutstandingActivities,3);for(const Ec of Ya)Qb.push(Ec);return Object(M.a)(new vf,{activities:Qb})}Wpg(Ya,Qb=1){const Ec=[];if(!Ya||!Ya.length)return Ec;for(const id of Ya)id?(Ya=cc.z9j(id.Type),6===Ya||7===Ya||9===Ya||8===
Ya?Ec.push(Object(M.a)(new re,{activityId:id.Id,type:Ya,displayTimestamp:new Date(id.DisplayTimestamp),navigationId:id.NavigationId,actors:this.tic(id.People),relevancy:Qb,relationship:this.y9j(id.Relationship)})):Ec.push(Object(M.a)(new Ye,{activityId:id.Id,type:Ya,displayTimestamp:new Date(id.DisplayTimestamp),navigationId:id.NavigationId,actors:this.tic(id.People),relevancy:Qb}))):d.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");
return Ec}y9j(Ya){switch(Ya){case 1:return 1;case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}s9j(Ya){const Qb=[];for(const Ec of Ya)Ya=Object(M.a)(new kf,{id:Ec.id,type:Ec.type,collectionId:Ec.collectionId,activityState:Ec.activityState,activityFeedItemPayload:Ec.activityFeedItemPayload,timestamp:Ec.timestamp}),Qb.push(Ya);return Qb}tic(Ya){const Qb=[];if(!Ya||!Ya.length)return Qb;for(const Ec of Ya)Ec&&Qb.push(this.EBb(Ec));return Qb}EBb(Ya){return Object(M.a)(new Rf,
{id:Ya.Id,provider:Ya.Provider,displayName:Ya.DisplayName,email:Ya.Email,imageUrl:this.Vfa.Nka(Ya.Email,Ya.Provider,e.AFrameworkApplication.oj,0),color:this.leb.Yic(new Xd.a(null,void 0,Ya.DisplayName),6)})}static z9j(Ya){switch(Ya){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),
1}}ULc(){if(this.blueDotManager){const Ya=this.blueDotManager.e6c;return this.c8d.filter(Qb=>!Ya.has(Qb.Id))}return this.c8d}Mmj(Ya,Qb){const Ec=Ya.map(id=>({activityId:id.activityGuid,activityFeedItemId:null,type:1,actors:[{id:id.author.id,provider:id.author.provider,displayName:id.author.displayName,givenName:null,email:id.author.email,imageUrl:id.author.imageUrl,color:null}],location:{type:105,region:null,subregion:null},displayTimestamp:id.displayTimestamp,relevancy:null,navigationId:null,state:0,
collectionId:null}));this.c8d=Ya.map(id=>{var Bd,Id;const ee=null!==(Id=null===(Bd=id.rangeHighlightLocation)||void 0===Bd?void 0:Bd.rangeList.map(Fe=>({Type:0,RangeList:[{SheetName:id.sheetName,FirstRow:Fe.firstRow,LastRow:Fe.lastRow,FirstColumn:Fe.firstCol,LastColumn:Fe.lastCol}]})))&&void 0!==Id?Id:[];return{Id:id.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:ee}});Qb(Ec)}Qtg(Ya,Qb,Ec,id){this.blueDotManager?(id?this.blueDotManager.yOi():this.blueDotManager.xOi()).then(Bd=>
{this.Mmj(Bd,Ya);this.blueDotManager.BQa()&&Ec&&this.blueDotManager.iOi()},Bd=>{Qb&&Qb(Bd)}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}cc.Zka="<WywaWaterline>DefaultWaterline</WywaWaterline>";cc.txb=Object(M.a)(new vf,{activities:[],actors:[],hasMore:!1,highWaterline:cc.Zka,lowWaterline:cc.Zka,wywaWaterline:cc.Zka});Object(b.a)(cc,"CatchUpActivityRequestManager",null,[730]);class pc{constructor(Ya){this.$=
Ya}shouldShowEmptyExperienceButton(){return this.$.ea.zbb?!0:!1}onButtonClick(){const Ya={["InputMethod"]:Db.a.fc};this.$.Ia.mc(new Z.a(1834994092,Db.a.fc,this.$.Tc,16,null),Ya)}onInviteOthersButtonClick(){const Ya={["InputMethod"]:Db.a.fc};this.$.Ia.mc(new Z.a(869186573,Db.a.fc,this.$.Tc,16,null),Ya)}getExplanationText(){const Ya=this.$.da.Ba(365);return wb.a.instance.Ha(Ya&&Ya.isVisible?657:656)}getCommandName(){return wb.a.instance.ha(443)}}Object(b.a)(pc,"CatchUpEmptyExperienceBehaviorManager",
null,[731]);const Hc=Ya=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Ya)};class td{constructor(Ya,Qb=null){this.$=Ya;this.flyoutRibbonButton=Qb;aa.a(this.$).Zi(this);this.hasFocus=!1}dispose(){aa.a(this.$).gB(this)}get Wc(){return document.getElementById("catchUpFlyoutContainer")}get Fg(){return this.flyoutRibbonButton.erf&&!this.hasFocus}get Qe(){return ia.a.R7c}$g(Ya,Qb){if(Qb)return!1;Ya=document.getElementById("flyoutItem0");if(!Ya)return d.ULS.sendTraceTag(537168009,
3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Ya.focus();this.Nyh(Ya);return!0}ui(Ya){return this.Wc?ya.DOMElementExtensions.zg(this.Wc,Ya):!1}pk(){this.hasFocus=!0}Rk(){this.hasFocus=!1}Nyh(Ya){if(Sys.Browser.agent===Sys.Browser.Firefox){var Qb=document.createEvent("KeyboardEvent");Qb.initKeyEvent(dd.a.Ic,!0,!0,window.self,!1,!1,!1,!1,ce.a.mVb,0);Ya.dispatchEvent(Qb)}else Qb=document.createEvent("Events"),Qb.initEvent(dd.a.Ic,!0,!0),Qb.keyCode=ce.a.mVb,Qb.which=ce.a.mVb,
Ya.dispatchEvent(Qb)}}Object(b.a)(td,"FlyoutFocus",null,[26,2]);var me=a(429);class ve{constructor(Ya){this.buttonClickedCallback=null;this.Tnb=this.aFb=!1;this.oVh=new Date;this.k5e=Ya}dispose(){this.Tnb=this.aFb=!1}registerButtonClickedEvent(Ya){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Ya.buttonClickedCallback}onFlyoutInitialized(){this.aFb&&d.ULS.sendTraceTag(537168007,
3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Ya=(new Date).getTime()-this.oVh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Ya}`);l.c(bf.a.ach,!0,l.e,0,0,Ya);this.aFb=!0;me.a.PF&&me.a.PF.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.aFb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get erf(){return this.Tnb}onFlyoutVisibilityChanged(Ya){this.Tnb!==Ya.flyoutIsVisible&&(this.Tnb=Ya.flyoutIsVisible,me.a.PF&&me.a.PF.updateCommandUI(!0),this.Tnb||this.k5e&&this.k5e.JPi())}}Object(b.a)(ve,"FlyoutRibbonButton",null,[790]);var Qe=a(535);class Ze{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)(Ze,"CatchUpConfiguration",null,[]);class nf{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(nf,"SharedControllerFactoryParameters",null,[]);class Cb{constructor(Ya,Qb,Ec=null,id=null,Bd=null){var Id;this.CKa=null;this.Vif=!1;this.DCd=this.DAa=0;this.BQa=!1;this.rg=()=>{const ee=this.$.ea.ao.LineageVersion;this.DAa!==ee&&(d.ULS.sendTraceTag(509645837,0,50,`CatchUpActivityManager.onWorkbookMetadataChanged: lineageVersion: ${ee}, this.lineageVersion: ${this.DAa}`),this.DAa=ee,this.Yyc(!1))};this.ho=()=>{d.ULS.sendTraceTag(509109976,0,100,"CatchUpActivityManager.onLoadOnDemandOccured");
this.Yyc(!0)};this.Md=(ee,Fe)=>{ee=V.EwaSettings.isChangeGateEnabled("OfficeVSO:7788930_BlueDotReloadAfterBecomingActive");Fe.QG&&this.blueDotManager&&(d.ULS.sendTraceTag(509109975,0,100,"CatchUpActivityManager.onSessionIdChanged"),ee&&this.Yyc(!0));ee||this.Yyc(!0)};this.ETf=ee=>{var Fe;V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!df.a.Gh(ee.wywaActivities)&&2!==ee.wywaActivities[0].type&&(this.u_.CXd(this.E3a.ULc()),this.showHideInGridHighlights(),this.$.ea.wv(this.rg),
null===(Fe=this.blueDotManager)||void 0===Fe?void 0:Fe.aye(this.onBlueDotDismissed),this.BQa&&(this.$.ea.VK(this.ho),this.$.ea.Mk(this.Md)))};this.onBlueDotDismissed=()=>{this.u_.CXd(this.E3a.ULc())};this.$=Ya;this.blueDotManager=Bd;this.u_=new Nd(this.$,this.blueDotManager);this.oce=new $a(e.AFrameworkApplication.dc,V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CatchUpMockDataEnabled",!1));Ya=te.a.N7j(Pa.a.instance.Dc("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.Pyf=
id;this.E3a=new cc(this.$,Ya,this.I$a(),this.blueDotManager);this.h8b=new hd(this.$,e.AFrameworkApplication.dc);this.emptyCatchUpBehaviorManager=new pc(this.$);this.lOi(ee=>{this.Y1i(ee)},Qb);this.rQi();Qb=null;Ec||(Qb=Pa.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=Ec||new ve(Qb);this.flyoutFocus=new td(this.$,this.flyoutRibbonButton);this.cFe=this.$.yc.vh("UserAction","BlueDotLiveUpdateIntervalStopwatch");this.BQa=null===(Id=this.blueDotManager)||
void 0===Id?void 0:Id.BQa()}get gpf(){const Ya=this.flyoutRibbonButton.aFb;Ya&&!this.Vif&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.Vif=!0);return Ya}get Uzi(){return this.flyoutRibbonButton.erf}dispose(){var Ya;this.CKa&&this.CKa.getWywaEvent().removeListener(this.ETf);this.CKa=this.$=null;gf.a.Ka(this.u_);this.flyoutRibbonButton=this.flyoutFocus=this.oce=this.h8b=this.E3a=this.u_=null;this.$.ea.hx(this.rg);null===(Ya=this.blueDotManager)||void 0===
Ya?void 0:Ya.N4f(this.onBlueDotDismissed);this.BQa&&(this.$.ea.EP(this.ho),this.$.ea.Vk(this.Md))}Cdj(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}Afk(Ya){this.u_.fYd(!Ya,1)}showHideInGridHighlights(){this.u_.rSb()}sFb(){return!!this.blueDotManager&&this.blueDotManager.sFb()}rQi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.Aof()&&d.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}Yyc(Ya){if(this.blueDotManager){var Qb=
V.EwaSettings.isChangeGateEnabled("OfficeVSO:7643204_BlueDotLiveUpdatePerfTelemetry")&&!Ya&&this.DCd<Cb.eOi,Ec=V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDotsHideSuppression",!1);Ec?this.u_.Ecg(!0):this.u_.fYd(!0,0);Qb&&this.cFe.start();this.E3a.Qtg(()=>{this.u_.CXd(this.E3a.ULc());Ec?this.u_.Ecg(!1):this.u_.fYd(!1,0);Qb&&(this.cFe.stop(),this.DCd+=1);Ya&&(this.DAa=0)},null,Ya&&this.blueDotManager.yVj(),Ya)}else d.ULS.sendTraceTag(508953163,0,50,"blueDotManager is null when refreshBlueDots is called")}lOi(Ya,
Qb){Hc("ScriptDownload");void X.a.resolve(ca.B,{Wa:Qb}).then(Ec=>Object(Se.a)(this,void 0,void 0,function*(){Ya(Ia.d(Ec("catchUpActivity")))}))}I$a(){return!!this.Pyf&&this.Pyf.I$a()&&this.$.ea.zbb}Aof(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}Y1i(Ya){D.TaskExtensions.za(Ya,()=>{Fa.a(()=>{this.CKa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(M.a)(new nf,{activityContentManager:Object(cf.a)(728,this.oce),activityNavigationManager:Object(cf.a)(729,
this.h8b),activityRequestManager:Object(cf.a)(730,this.E3a),dataCulture:this.$.xa.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(cf.a)(ve,this.flyoutRibbonButton),uiCulture:this.$.xa.UICultureTag,ulsLogger:new E.a,emptyCatchUpBehaviorManager:Object(cf.a)(731,this.emptyCatchUpBehaviorManager)}))});this.u_.tve=this.CKa.getActivityIndicatorTooltipManager();Qe.a(this.$);this.CKa.getWywaEvent().addListener(this.ETf);Hc("InitializeCatchUpApp");this.CKa.initialize(Object(M.a)(new Ze,{featuredActivityGroupsEnabled:!1,
summaryStringEnabled:this.I$a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.Aof()}))},this.$.ka,3)}}Cb.eOi=10;Object(b.a)(Cb,"CatchUpActivityManager",null,[732,2]);class ac extends f.a{constructor(Ya){super();this.$=Ya;this.uc()}create(){let Ya=V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?y.GetServiceTaskFactory.Za(this.$.da,501,500,1):G.Task.Ua(null),Qb=y.GetServiceTaskFactory.Za(this.$.da,458,459,this.La);D.TaskExtensions.za(D.TaskExtensions.xe([Ya,
Qb],this.$.ka),()=>{const Ec=Qb.result,id=Ya.result,Bd=Object(ra.a)(this.$.da,286,()=>new Cb(this.$,this.La,null,Ec,id));this.$b(Bd)},this.$.ka,3)}static la(Ya){Ya.da.Ja(287,new ac(Ya))}}Object(b.a)(ac,"CatchUpActivityManagerFactory",f.a,[]);var qc=a(245),Oc=a(172),xd=a(323),Md=a(42);class je{}Object(b.a)(je,"LineageBlueDotsInfo",null,[]);class oe extends Error{constructor(Ya,Qb){super(`${oe.f6g}: ${Ya}. With errors: ${P.a.Uc(Qb)}`)}}oe.f6g="BlueDotError";Object(b.a)(oe,"BlueDotError",Error,[]);class Ge extends Md.a{constructor(Ya,
Qb){super();this.blueDotSettings=0;this.q5=this.ILd=null;this.wjf=!1;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.vOj=Ec=>{d.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Ec);this.blueDotSettings=Ec?0:1;this.Obg({});this.gmk()};this.i9i=Ec=>{this.Obg({LineageTaskPaneVisible:Ec})};this.$=Ya;this.blueDotSettings=Qb;this.Vfa=Pa.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.$tb=
new Set;this.e6c=new Set}dispose(){this.$=null}aye(Ya){this.addHandler("cubddek",Ya)}N4f(Ya){this.removeHandler("cubddek",Ya)}aMa(Ya,Qb){V.EwaSettings.isChangeGateEnabled("OfficeVSO:7633322_BlueDotDismissTelemetry")&&d.ULS.sendTraceTag(509167327,0,50,"BlueDotManager::dismissBlueDot: Blue dot dismissed by "+Qb);this.e6c.add(Ya);V.EwaSettings.isChangeGateEnabled("OfficeVSO:7525040_BlueDotDismissal")&&this.raiseEvent("cubddek",Ya)}shouldShowBlueDot(Ya){return this.$tb.has(Ya)&&!this.e6c.has(Ya)}BQa(){return V.EwaSettings.isChangeGateEnabled("OfficeVSO:6633490_BlueDotsServerReload")}hasAnyActiveInGridHighlight(){return V.EwaSettings.isChangeGateEnabled("OfficeVSO:7665355_DisableToggleForEmptyInGridHighlights")?
!this.wjf&&0<this.$tb.size:!0}H4i(){this.wjf=!0}xOi(){return Object(Se.a)(this,void 0,void 0,function*(){return new Promise((Ya,Qb)=>{d.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::loadInGridBlueDots");Ka.b(this.$).Vd(sa.a.lineageLoadInGridBlueDots,{});const Ec=Bd=>{Bd=qa.a.vf(Bd.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${P.a.Uc(Bd)}]`);Qb(new oe("loadInGridBlueDots failed",Bd))},id=Bd=>{if(Bd=Ca.a(Bd)?null:Bd.Result){var Id=
{["CountOfActivities"]:Bd.ActivityList.length};Ka.b(this.$).Vd(sa.a.RNi,Id);var ee=Yc(Bd.ActivityList,this.Vfa);this.BQa()?(this.$9b(ee),this.q5&&V.EwaSettings.isChangeGateEnabled("OfficeVSO:7833821_BlueDotsReapplyFlattenedUids")&&this.U5b(this.q5.FlattenedUids),Ya(ee)):null==this.ILd?this.byi().then(Fe=>{this.ILd=Fe;this.$9b(ee);this.U5b(Fe);Ya(ee)},Fe=>{Qb(Fe)}):(this.$9b(ee),this.U5b(this.ILd),Ya(ee))}else d.ULS.shipAssertTag(512234914,0,!!Bd,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};
this.$.userOperationManager.Bd(new mb.a(1024,0,(Bd,Id,ee)=>tc(this.$.qa.va,va.b(Bd,id),va.a(Id,Ec),ee,null),80),null)})})}yOi(){return Object(Se.a)(this,void 0,void 0,function*(){return new Promise((Ya,Qb)=>{var Ec,id,Bd,Id,ee,Fe;d.ULS.sendTraceTag(509109974,0,50,"BlueDotManager::loadInGridBlueDotsWithReloadHint");Ka.b(this.$).Vd(sa.a.lineageLoadInGridBlueDotsWithReloadHint,{});const La=Sc=>{Sc=qa.a.vf(Sc.data);d.ULS.sendTraceTag(509109973,0,50,`BlueDotManager::LineageLoadInGridBlueDotsWithReloadHint service call failed. Errors: [${P.a.Uc(Sc)}]`);
Qb(new oe("loadInGridBlueDotsWithReloadHint failed",Sc))},Kb=Sc=>{if(Sc=Ca.a(Sc)?null:Sc.Result){var nd={["CountOfActivities"]:Sc.ActivityList.length};Ka.b(this.$).Vd(sa.a.SNi,nd);Sc=Yc(Sc.ActivityList,this.Vfa);this.$9b(Sc);Ya(Sc)}else d.ULS.shipAssertTag(509109971,0,!1,"BlueDotManager LineageLoadInGridBlueDotsWithReloadHint returned null response.")},uc=Object(M.a)(new je,{FlattenedUids:null,ToplevelUids:null===(Ec=this.q5)||void 0===Ec?void 0:Ec.ToplevelUids,XrevidFirst:null===(id=this.q5)||void 0===
id?void 0:id.XrevidFirst,XrevidLast:null===(Bd=this.q5)||void 0===Bd?void 0:Bd.XrevidLast,XrevidLastAccepted:null===(Id=this.q5)||void 0===Id?void 0:Id.XrevidLastAccepted,ApplyToplevelAllowList:null===(ee=this.q5)||void 0===ee?void 0:ee.ApplyToplevelAllowList,DocId:null===(Fe=this.q5)||void 0===Fe?void 0:Fe.DocId});this.$.userOperationManager.Bd(new mb.a(1031,0,(Sc,nd,Jd)=>gc(this.$.qa.va,uc,va.b(Sc,Kb),va.a(nd,La),Jd,null),80),null)})})}iOi(){this.jOi().then(Ya=>{this.q5=Ya;this.U5b(Ya.FlattenedUids)},
()=>{})}jOi(){return Object(Se.a)(this,void 0,void 0,function*(){return new Promise((Ya,Qb)=>{d.ULS.sendTraceTag(509109970,0,50,"BlueDotManager::loadBlueDotsInformationAsync");const Ec=Bd=>{Bd=qa.a.vf(Bd.data);d.ULS.sendTraceTag(509109969,0,50,`BlueDotManager  loadBlueDotsInformation service call failed. Errors: [${P.a.Uc(Bd)}]`);Qb(new oe("loadBlueDotsInformation load failed",Bd))},id=Bd=>{(Bd=Ca.a(Bd)?null:Bd.Result)?Ya(Bd):d.ULS.shipAssertTag(509109967,0,!!Bd,"BlueDotManager loadBlueDotsInformation returned null response.")};
this.$.userOperationManager.Bd(new mb.a(1030,0,(Bd,Id,ee)=>tb(this.$.qa.va,va.b(Bd,id),va.a(Id,Ec),ee,null),80),null)})})}U5b(Ya){Ya&&Ya.forEach(Qb=>{Qb=`{${Qb.toUpperCase()}}`;this.$tb.has(Qb)||this.$tb.add(Qb)})}$9b(Ya){this.$tb=new Set(Ya.map(Qb=>Qb.activityGuid))}Obg(Ya){if(qb.a.rEb(this.$)){var Qb=new Z.a(950288339,0,2,12,null);this.$.Ia.mc(Qb,Ya)}}sFb(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.HideBlueDotBehindLineage",!1)}yVj(){return!this.q5||this.q5.ApplyToplevelAllowList}byi(){return Object(Se.a)(this,
void 0,void 0,function*(){return new Promise((Ya,Qb)=>{d.ULS.sendTraceTag(509645136,0,50,"BlueDotManager::invokeOriginalBlueDotsUidList");const Ec=Bd=>{Bd=qa.a.vf(Bd.data);d.ULS.sendTraceTag(509645135,0,50,`BlueDotManager  LineageGetOriginalBlueDotsUidList service call failed. Errors: [${P.a.Uc(Bd)}]`);Qb("BlueDotUidList load failed")},id=Bd=>{(Bd=Ca.a(Bd)?null:Bd.Result)?Ya(Bd):d.ULS.shipAssertTag(509645133,0,!!Bd,"BlueDotManager LineageGetOriginalBlueDotsUidList returned null response.")};this.$.userOperationManager.Bd(new mb.a(1029,
0,(Bd,Id,ee)=>Pb(this.$.qa.va,va.b(Bd,id),va.a(Id,Ec),ee,null),80),null)})})}gmk(){V.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)&&xd.D(this.$.qa.va,4,this.blueDotSettings.toString(),Ya=>{P.a.ng(Ya.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${P.a.Uc(Ya.Errors)}`):Ya.Result||d.ULS.sendTraceTag(509732677,
0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Ya,Qb,Ec)=>{Ya=qa.a.vf(Ya.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Ec}. Errors: ${P.a.Uc(Ya)}.`)},null,null)}}Object(b.a)(Ge,"BlueDotManager",Md.a,[724,2]);class Ce extends f.a{constructor(Ya){super();this.Hgc=null;this.Y5i=Qb=>{Qb=qa.a.vf(Qb.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${P.a.Uc(Qb)}.`)};
this.$=Ya;this.uc()}create(){this.Hgc||(this.Hgc=this.U0h());this.Hgc.continueWith(()=>{this.$b(Object(ra.a)(this.$.da,501,()=>new Ge(this.$,this.Hgc.result)))})}static la(Ya){Ya.da.Ja(500,new Ce(Ya))}U0h(){if(V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return qc.a.Ua(0);let Ya=new Oc.a;Object(xd.x)(this.$.qa.va,4,Qb=>{this.Z5i(Qb,Ya)},Qb=>{this.Y5i(Qb);Ya.setResult(1)},null,null);return Ya.task}Z5i(Ya,Qb){P.a.ng(Ya.Errors)?(d.ULS.sendTraceTag(509732675,
0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${P.a.Uc(Ya.Errors)}`),Qb.setResult(1)):null==Ya.Result?Qb.setResult(0):(Ya=parseInt(Ya.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Ya}`),Qb.setResult(Ya))}}Object(b.a)(Ce,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");
Type.registerNamespace("_Ewa");c.a.Fa(U.la);c.a.Fa(Va.la);c.a.Fa(m.la);c.a.Fa(x.la);ob.a.sj('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(Ya=>{Vd.la(Ya);eb.la(Ya);Da.la(Ya)})})();Type.registerNamespace("Common.App.CatchUpActivity");fe.main();(()=>{c.a.Fa(Ya=>{Hc("Begin");ac.la(Ya);Te.la(Ya)})})();(()=>{c.a.Fa(Ya=>{Ce.la(Ya)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.catchup.js.map/09be2e630e9df2e0daad15ece7a8b79b/EwaDSOpt.catchup.js.map